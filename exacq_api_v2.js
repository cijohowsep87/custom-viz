!function(e,s){"object"==typeof exports&&"object"==typeof module?module.exports=s():"function"==typeof define&&define.amd?define([],s):"object"==typeof exports?exports.exacq_api_v2=s():e.exacq_api_v2=s()}(window,function(){return function(e){var s={};function t(r){if(s[r])return s[r].exports;var i=s[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,t),i.l=!0,i.exports}return t.m=e,t.c=s,t.d=function(e,s,r){t.o(e,s)||Object.defineProperty(e,s,{enumerable:!0,get:r})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,s){if(1&s&&(e=t(e)),8&s)return e;if(4&s&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(t.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&s&&"string"!=typeof e)for(var i in e)t.d(r,i,function(s){return e[s]}.bind(null,i));return r},t.n=function(e){var s=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(s,"a",s),s},t.o=function(e,s){return Object.prototype.hasOwnProperty.call(e,s)},t.p="",t(t.s=11)}({11:function(e,s){
/*!
 * 
 */
!function(){if(window.loadCamera&&"undefined"==typeof s2){var e=document.createElement("script");e.setAttribute("src",ev_URL+"s2.js"),e.setAttribute("type","text/javascript");var s=!1,t=function(){var t=e.readyState;s||t&&!/loaded|complete/.test(t)||(s=!0,wireUpS2Customizations())};e.onreadystatechange=t,e.onload=t,document.body.appendChild(e)}}(),function(){"use strict";window.EVWEB2={},EVWEB2.config={defaultStreamId:null,triggerPollingRate:1e3,jsonpRequestTimeout:5e3},EVWEB2.errors={config:"invalid session",servers:"{\n\tERROR\n}",login:'<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN">\n<html>\n<head>\n<title>Config</title>\n</head>\n<body>\n<h1>Error</h1>\n</body>\n</html>',triggers:"{\n\tERROR\n}",ptz:"{\n\tERROR\n}",search:"{\n\tERROR\n}",jsonLoginFailed:"Login failed"},EVWEB2.ajax=void 0,EVWEB2.urls={getServerList:"login.web?output=json",getCameraList:"config.web",getViewList:"view.web",login:"login.web",logout:"logout.web",legacyGetFrame:"pull.web",video:"video.web",search:"search.web",searchStatus:"search.web/status",speed:"playspeed.web",step:"step.web",time:"timestamp.web",ptz:"ptz.web",trigger:"trigger.web",metadata:"metadata.web",resourceKey:"key.web",version:"version.web",digitalPtz:"digitalptz.web",service:"service.web",serviceDiscovery:"service.web/discovery",audio:"audio.web",videoexport:"export.web",map:"map.web",status:"status.web",groups:"groups.web",thumbnail:"thumbnail.web",tours:"tour.web",serverUsers:"server.web/users",serverPlugins:"server.web/plugins",health:"health.web",systemInfo:"server.web",videopush:"videopush.web",videopushMessage:"videopush.web/message",devices:"server.web/devices",deviceTypes:"server.web/devices/types",cachedThumbnail:"video.web/thumbnail",camera:"camera.web",configUpdateStatus:"server.web/events/status",users:"users.web",userGroups:"users.web/groups",eventMonitoring:"eventmonitoring.web",eventMonitoringPush:"eventmonitoring.web/push",pushNotification:"pushnotification.web",brokerConfig:"broker.web/config",legacyWebsocketStatus:"status.web/legacywebsocket",legacyWebsocketCamerasOsd:"camera.web/legacywebsocket",auth:"auth.web",authLogout:"auth.web/logout",bookmark:"bookmark.web",bookmarkItems:"bookmark.web/items",bookmarkCases:"bookmark.web/cases",associations:"associations.web",associationsCamera:"associations.web/camera",associationsCameraItem:"associations.web/camera/item",securityIntegrationDevices:"securityintegrations.web",securityIntegrationsDeviceLogin:"securityintegrations.web/login",securityIntegrationsDeviceSensors:"securityintegrations.web/sensors",serverSerialInfo:"server.web/serial",serialDevices:"serial.web",serialData:"serial.web/data",serialStoredData:"serial.web/data/stored",serialProfiles:"serial.web/profile",serialProfileKeywords:"serial.web/profile/keywords",serialProfileLineMasks:"serial.web/profile/masks",serialProfileReplacements:"serial.web/profile/replacements",serialProfileRules:"serial.web/profile/rules",serviceInfo:"service.web/info",serviceConfigToken:"service.web/token",serviceConfigServers:"service.web/servers",serviceConfigServersXdv:"service.web/servers/xdv",serviceConfigRemoteServers:"service.web/remoteservers",serviceConfigRemoteServersListener:"service.web/remoteservers/listener",serviceConfigLogging:"service.web/logging",serviceConfigLoggingFile:"service.web/logging/file",serviceConfigBasic:"service.web/config",serviceConfigUpdates:"service.web/updates",serviceConfigExternalAuth:"service.web/externalauth",serviceConfigAdmin:"service.web/admin",serviceConfigStatus:"service.web/status",serviceConnectivityStatus:"service.web/status/connectivity",serviceServerStatus:"service.web/status/server",serviceSSLConfigType:"service.web/config/ssl",serviceSSLExternalConfig:"service.web/config/ssl/external",serviceSSLAcmeConfig:"service.web/config/ssl/acme",serviceSSLAcmeStatus:"service.web/config/ssl/acme/status",serviceRestoreDefaults:"service.web/reset",events:"events.web",archiveTargets:"server.web/archive",searchVideo:"video.web/search",addresses:"service.web/addresses",analyticRules:"analytics.web/rules",analyticRulePush:"analytics.web/rules/push",searchSnapshot:"video.web/search/snapshot"},EVWEB2.fontStyle={unknown:0,normal:90,italic:93,slant:94},EVWEB2.fontColor={unknown:-1,white:16777215,aqua:65535,fushia:16711935,yellow:16776960,silver:12632256,red:16711680,lime:65280,blue:255,gray:8421504,teal:32896,purple:8388736,olive:8421376,black:0,maroon:8388608,green:32768,navy:128},EVWEB2.fontWeight={unknown:0,light:90,bold:92},EVWEB2.fontFamily={unknown:0,defaultFont:70,decorative:71,roman:72,script:73,swiss:74,modern:75,teletype:76},EVWEB2.FontInfo=function(e,s,t,r,i,n,o){this.font="Sans",this.size=10,this.style=EVWEB2.fontStyle.normal,this.color=EVWEB2.fontColor.white,this.family=EVWEB2.fontFamily.defaultFont,this.weight=EVWEB2.fontWeight.light,this.underline=!1,void 0!==e&&(this.font=e),void 0!==s&&(this.size=s),void 0!==t&&(this.style=t),void 0!==r&&(this.color=r),void 0!==i&&(this.family=i),void 0!==n&&(this.weight=n),void 0!==o&&(this.underline=o)}}(),EVWEB2.ResponseStatus=function(e,s,t){this.success=!1,this.errorText="",this.errorCode=0,void 0!==e&&(this.success=e),void 0!==s&&(this.errorText=s),void 0!==t&&(this.errorCode=t)},function(){"use strict";EVWEB2.LogItem=function(e,s){this.time=e,this.args=s},EVWEB2.Logging=function(){this.enabled=!1,this.recordsToStore=50;var e,s,t={},r=["log","debug","error"],i=this,n=function(s){return function(){!function(s,r){void 0===t[s]&&(t[s]=[]);var n=new EVWEB2.LogItem(new Date,r);t[s].push(n);var o=t[s].length;o>i.recordsToStore&&(t[s]=t[s].slice(o-i.recordsToStore)),i.enabled&&(void 0!==e?e(n):void 0!==console&&void 0!==console[s]&&console[s].apply(console,r))}(s,arguments)}};for(s=0;s<r.length;s++){var o=r[s];i[o]=n(o)}this.applyOverride=function(s){void 0!==e&&EVWEB2.logger.main.debug("Overriding existing logging callback.",e,s),e=s},this.removeOverride=function(){void 0===e&&EVWEB2.logger.main.debug("Removing logging callback with none applied."),e=void 0},this.storedLogs=function(e,s){if(void 0===t[e])return[];void 0===s&&(s=i.recordsToStore),s>i.recordsToStore&&(EVWEB2.logger.main.debug("More records requested than max stored.",s,i.recordsToStore),s=i.recordsToStore);var r=t[e].length-s;return r<0&&(r=0),t[e].slice(r)}},EVWEB2.logger={main:new EVWEB2.Logging},EVWEB2.log=EVWEB2.logger.main.log}(),function(){EVWEB2.util={},EVWEB2.util.Date2IETF=function(e,s){if(s=s||!1,void 0===e||null===e||void 0===e.getHours)return"";var t=e.getUTCFullYear()+"-",r=e.getUTCMonth()+1;r<10&&(t+="0"),t+=r+"-";var i=e.getUTCDate();i<10&&(t+="0"),t+=i+"T";var n=e.getUTCHours();n<10&&(t+="0"),t+=n+":";var o=e.getUTCMinutes();o<10&&(t+="0"),t+=o+":";var a=e.getUTCSeconds();if(a<10&&(t+="0"),t+=a,s){var u=e.getUTCMilliseconds();u>0&&(t+=".",u<100&&(t+="0"),u<10&&(t+="0"),t+=u)}return t+="Z"},EVWEB2.util.IETF2Date=function(e){var s=new Date(0);if("string"!=typeof e)return null;var t=e.split("T");if(2!==t.length)return null;var r=t[0].split("-");if(3!==r.length)return null;s.setUTCFullYear(r[0]),s.setUTCMonth(parseInt(r[1],10)-1),s.setUTCDate(r[2]);var i=t[1].split(":");if(3!==i.length)return null;s.setUTCHours(i[0]),s.setUTCMinutes(i[1]);var n=i[2].split(/[.Z]/);return s.setUTCSeconds(n[0]),n[1].length>1&&s.setUTCMilliseconds(n[1]),s},EVWEB2.util.RGBA=function(e,s){return[255&e,255&e,255&e,s/100]};var e=function(e){var s=$(e.target),t=s.attr("title");t=t.split(";"),"-1"===s.attr("alt")?s.src=e.data.camera.getFrame(parseInt(t[0],10),parseInt(t[1],10),parseInt(t[2],10)):s.src=e.data.camera.getFrame(parseInt(t[0],10),parseInt(t[1],10),parseInt(t[2],10),s.attr("alt"))};EVWEB2.util.attachCamera=function(s,t,r,i,n){s=$(s);var o=$(s);if(!o.is("img")){var a=$("<img/>");a.attr("id","C"+t.id),o.append(a),o=a}o.attr("title",i.toString()+";"+r.toString()+";"+n.toString()),o.on("load",{camera:t},e),o.attr("src",t.getFrame(i,r,n)),o.attr("alt","-1")},EVWEB2.util.generateStreamId=function(){return Math.floor(4294967295*Math.random()).toString(16)},EVWEB2.util.pidToCameraId=function(e,s,t,r){return void 0===r&&(r=0),r<<28|e|t<<8|s},EVWEB2.util.XSSPost=function(e,s){EVWEB2.util.internal.XSSPost(e,s)},EVWEB2.util.updateRequestForXss=function(e,s){return EVWEB2.util.internal.updateRequestForXss(e,s)},EVWEB2.util.notifyOnServiceRestart=function(e,s,t,r,i){return EVWEB2.util.internal.notifyOnServiceRestart(e,s,t,r,i)},EVWEB2.util.processServerPermissions=function(e){return EVWEB2.util.internal.processServerPermissions(e)},EVWEB2.util.parseRtspIpAddress=function(e){return EVWEB2.util.internal.parseRtspIpAddress(e)},EVWEB2.util.getErrorText=function(e){var s="An error occurred.";try{if(void 0===e.responseText)return s;var t=JSON.parse(e.responseText);return 0===t.errorText.length?s:t.errorText}catch(e){return s}},EVWEB2.util.getErrorCode=function(e){try{if(void 0===e.responseText)return;var s=JSON.parse(e.responseText);if(void 0!==s.errorCode)return s.errorCode}catch(e){return}}}(),function(){"use strict";var e;EVWEB2.util.internal={},EVWEB2.util.internal.XSSPost=function(e,s){var t=$('<iframe style="display: none;"><html><body></body></html></iframe>');$("body").append(t);var r,i=$("<form></form>");i.attr("action",e),i.attr("method","post");var n=!1,o=[];for(r in s){var a;if(s.hasOwnProperty(r))s[r]instanceof $?(n="file"===s[r].attr("type"),a=s[r],o.push({input:a,parent:a.parent()})):(a=$('<input type="hidden"/>')).attr("value",s[r]),a.attr("name",r),i.append(a)}n&&i.attr("enctype","multipart/form-data");var u=function(e){$.each(e,function(e,s){s.parent.append(s.input)})};if(0!==t.contents().find("body").length)t.contents().find("body").append(i),i.submit(),t.on("load readystatechange",function(){i.on("submit",function(){u(o),t.remove()})});else{var c=function(){t.off("load readystatechange",c),t.contents().find("body").append(i),i.submit(),u(o),t.remove()};t.on("load readystatechange",c)}},EVWEB2.util.internal.updateRequestForXss=function(e,s){return e.dataType="jsonp",e.timeout=EVWEB2.config.jsonpRequestTimeout,void 0!==e.type&&"GET"!==e.type&&(void 0===e.data&&(e.data={}),e.data.verb=e.type),void 0!==s&&(void 0===e.data&&(e.data={}),e.data.key=s.resourceKey),e},EVWEB2.util.internal.corsSupported=function(){return void 0===e&&(e="withCredentials"in new XMLHttpRequest),e},EVWEB2.util.internal.ajax=function(e,s,t){if(EVWEB2.util.internal.corsSupported()&&s.supportsCors())""===s.auth.token||s.auth.type===EVWEB2.serviceAuthTypes.unknown&&s.auth.type===EVWEB2.serviceAuthTypes.none||(void 0===e.headers&&(e.headers={}),e.headers.Authorization="Bearer "+s.auth.token,void 0===e.xhrFields&&(e.xhrFields={}),e.xhrFields.withCredentials=!0);else if(void 0===t&&(t=!1),s.isXss()){if("POST"===e.type&&t){EVWEB2.util.internal.XSSPost(e.url,e.data);return void(void 0!==e.success&&e.success({success:!0,xssPost:!0}))}EVWEB2.util.internal.updateRequestForXss(e,s)}$.ajax(e)},EVWEB2.ajax=EVWEB2.util.internal.ajax,EVWEB2.util.internal.notifyOnServiceRestart=function(e,s,t,r,i){var n,o=0,a=0,u=function(){if(++o>=i){var t=new EVWEB2.ResponseStatus(!0);e(t,s,!0)}else n()},c=function(){if(o=0,a>=r){var s=new EVWEB2.ResponseStatus(!1,"An error occurred when restarting the web service.");e(s,void 0,!1)}else a++,n()};(n=function(){setTimeout(function(){var e={success:u,error:c,url:s.url()+EVWEB2.urls.version};s.isXss()&&(e.data={output:"json"}),EVWEB2.ajax(e,s)},t)})()},EVWEB2.util.internal.processUserGroupPermissions=function(e){var s=[],t=[EVWEB2.userPermissions.livePermissions,EVWEB2.userPermissions.searchPermissions],r=[EVWEB2.permissionsBitmask.livePermissions,EVWEB2.permissionsBitmask.searchPermissions],i=e.user;$.each(r,function(e,r){$.each(r,function(r,n){(n|i)===i&&t[e].hasOwnProperty(r)&&s.push(t[e][r])})});var n=[EVWEB2.userPermissions.configPermissions],o=[EVWEB2.permissionsBitmask.configPermissions],a=e.admin;$.each(o,function(e,t){$.each(t,function(t,r){(r|a)===a&&n[e].hasOwnProperty(t)&&s.push(n[e][t])})});var u=[EVWEB2.userPermissions.groupPermissions],c=[EVWEB2.permissionsBitmask.groupPermissions],E=e.group;return $.each(c,function(e,t){$.each(t,function(t,r){(r|E)===E&&u[e].hasOwnProperty(t)&&s.push(u[e][t])})}),new EVWEB2.UserGroupPermissions(s)},EVWEB2.util.internal.processServerPermissions=function(e){var s,t,r=e.user_permissions,i=EVWEB2.accessLevelType.unknown;void 0!==r&&(s=new EVWEB2.LiveUserPermissions(r.live,r.live_groups,r.live_maps,r.live_views,r.quick_replay,r.ptz,r.two_way_audio,r.event_monitor,r.live_save_image,r.live_print_image,r.live_cameras,r.video_push),t=new EVWEB2.SearchUserPermissions(r.search,r.search_groups,r.search_maps,r.search_views,r.search_events,r.save_image,r.print_image,r.burn_disc,r.export_video,r.smart_search,r.search_cases,r.search_cameras),i=r.accessLevel);var n,o=e.admin_access_permissions;return void 0!==o&&(n=new EVWEB2.ConfigUserPermissions(o.users,o.views)),new EVWEB2.UserPermissions(s,t,n,i)},EVWEB2.util.internal.parseRtspIpAddress=function(e){if("string"!=typeof e)return null;var s=e.match(/(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)/);if(null!==s&&s.length)return s[0];return null!==(s=e.match(/(?:rtsp|http|https):\/\/([0-9a-zA-Z\.]+)(:[0-9]+)?/))&&s.length>1?s[1]:null},EVWEB2.util.internal.generateGroupPermissions=function(e){var s=[e.livePermissions,e.searchPermissions,e.configPermissions],t=[EVWEB2.userPermissions.livePermissions,EVWEB2.userPermissions.searchPermissions,EVWEB2.userPermissions.configPermissions],r=[];return $.each(s,function(e,s){null!==s&&$.each(s,function(s,i){i&&t[e].hasOwnProperty(s)&&r.push(t[e][s])})}),new EVWEB2.UserGroupPermissions(r)},EVWEB2.util.internal.generateUserPermissions=function(e,s){var t,r=e.permissions,i=[EVWEB2.userPermissions.livePermissions,EVWEB2.userPermissions.searchPermissions,EVWEB2.userPermissions.configPermissions],n=new EVWEB2.LiveUserPermissions,o=new EVWEB2.SearchUserPermissions,a=new EVWEB2.ConfigUserPermissions,u=[n,o,a,void 0];for(t=0;t<r.length;t++){var c=r[t];$.each(i,function(e,s){$.each(s,function(s,t){c===t&&(u[e][s]=!0)})})}return new EVWEB2.UserPermissions(n,o,a,s)},EVWEB2.util.internal.generatePermissionsBitmask=function(e){var s,t=e.permissions,r={user:0,admin:0,group:0},i=[EVWEB2.userPermissions.livePermissions,EVWEB2.userPermissions.searchPermissions],n=[EVWEB2.permissionsBitmask.livePermissions,EVWEB2.permissionsBitmask.searchPermissions],o=[EVWEB2.userPermissions.configPermissions],a=[EVWEB2.permissionsBitmask.configPermissions],u=[EVWEB2.userPermissions.groupPermissions],c=[EVWEB2.permissionsBitmask.groupPermissions];for(s=0;s<t.length;s++)$.each(i,function(e,i){$.each(i,function(i,o){o===t[s]&&n[e].hasOwnProperty(i)&&(r.user=r.user|n[e][i])})}),$.each(o,function(e,i){$.each(i,function(i,n){n===t[s]&&a[e].hasOwnProperty(i)&&(r.admin=r.admin|a[e][i])})}),$.each(u,function(e,i){$.each(i,function(i,n){n===t[s]&&c[e].hasOwnProperty(i)&&(r.group=r.group|c[e][i])})});return r},EVWEB2.util.internal.processServerDetails=function(e){var s;return void 0!==e.address&&(s=new EVWEB2.ServerDetailInfo(e.address,e.port,e.model,e.serial,e.version,e.daysRecordedVideo)),s},EVWEB2.util.internal.processServerLicense=function(e){var s,t=e.licenseInfo;if(void 0!==t){var r=EVWEB2.util.IETF2Date(t.expirationDate);s=new EVWEB2.ServerLicenseInfo(t.macAddress,r,t.expired,t.restricted,t.enterprise,t.maxAnalogCameras,t.maxIpCameras,t.maxBoards,t.licenseType,t.licenseKey)}return s},EVWEB2.util.internal.formatOsdInfo=function(e){var s=new EVWEB2.CameraOsdInfo;return s.position=e.position,s.name=Boolean(e.display&EVWEB2.osdDisplay.name),s.time=Boolean(e.display&EVWEB2.osdDisplay.time),s.date=Boolean(e.display&EVWEB2.osdDisplay.date),s.timezone=Boolean(e.display&EVWEB2.osdDisplay.timezone),s.font=e.fontName,s.fontSize=e.fontSize,s.fontColor=e.evFontColor,s.fontStyle=e.evFontStyle,s.fontFamily=e.evFontFamily,s.fontWeight=e.evFontWeight,s}}(),function(){"use strict";EVWEB2.ServiceVersion=function(e,s,t,r){this.major=0,this.minor=0,this.build=0,this.qfe=0,void 0!==e&&(this.major=e),void 0!==s&&(this.minor=s),void 0!==t&&(this.build=t),void 0!==r&&(this.qfe=r),this.toString=function(){return this.major.toString()+"."+(this.major>=19&&this.minor<10?"0"+this.minor.toString()+".":+this.minor.toString()+".")+this.build.toString()+"."+this.qfe.toString()},this.equals=function(e){return this.major===e.major&&this.minor===e.minor&&this.build===e.build&&this.qfe===e.qfe},this.lessThan=function(e){return this.major<e.major||this.major===e.major&&(this.minor<e.minor||this.minor===e.minor&&(this.build<e.build||this.build===e.build&&this.qfe<e.qfe))},this.greaterThan=function(e){return this.major>e.major||this.major===e.major&&(this.minor>e.minor||this.minor===e.minor&&(this.build>e.build||this.build===e.build&&this.qfe>e.qfe))},this.populateFromString=function(e){var s=e.split("."),t=$.map(s,function(e){var s=parseInt(e,10);if(!isNaN(s))return s});return 4===t.length&&(this.major=t[0],this.minor=t[1],this.build=t[2],this.qfe=t[3],!0)}},EVWEB2.ServiceJpegForwardingSettings=function(e,s,t){this.enabled=!1,this.sizeThreshold=100,this.qualityThreshold=100,void 0!==e&&(this.enabled=e),void 0!==s&&(this.sizeThreshold=s),void 0!==t&&(this.qualityThreshold=t),this.shouldForward=function(e,s,t,r){if(-1===e.formats.indexOf(EVWEB2.cameraFormats.jpeg))return!1;var i=this.sizeThreshold/100;return e.quality*(this.qualityThreshold/100)<r&&(e.resolution.width*i<s||e.resolution.height*i<t)}},EVWEB2.ConfigUpdateStatus=function(e,s){this.sessionId="",this.lastUpdated=new Date,void 0!==e&&(this.sessionId=e),void 0!==s&&(this.lastUpdated=s)};var e={cors:new EVWEB2.ServiceVersion(7,6,0)};EVWEB2.Service=function(s,t,r,i){this.name="Unset",this.hostUrl="",this.effectiveUrl="",this.subdirectory="",this.ignoreXss=!1,this.resourceKey="",this.csrf=!0,this.jpegForwarding=new EVWEB2.ServiceJpegForwardingSettings(!1,100,100),this.videoPush=new EVWEB2.VideoPush(i),this.pushNotification=new EVWEB2.PushNotification(this),this.websocket=new EVWEB2.WebSocketHandler(this),this.auth=new EVWEB2.ServiceAuth(this);var n=!1;this.config=new EVWEB2.ServiceConfig(this);var o=null,a=null,u=[],c="";void 0!==r&&(this.name=r),void 0!==s&&""!==s&&("/"!==s.substr(s.length-1)&&(s+="/"),null===s.match(/^http[s]{0,1}:\/\//)&&(s="http://"+s),this.hostUrl=s),void 0!==t&&""!==t&&(""===this.hostUrl&&"/"!==t.substr(0,1)?t="/"+t:""!==this.hostUrl&&"/"===t.substr(0,1)&&(t=t.substr(1)),t.length>0&&"/"!==t.substr(t.length-1)&&(t+="/"),this.subdirectory=t),this.setVideoPushClientGuid=function(e){this.videoPush=new EVWEB2.VideoPush(e)},this.isXss=function(){return!this.ignoreXss&&""!==this.hostUrl},this.url=function(){return""!==this.effectiveUrl?this.effectiveUrl+this.subdirectory:this.hostUrl+this.subdirectory},this.setUrl=function(e){"/"!==e.substr(e.length-1)&&(e+="/"),null===e.match(/^http[s]{0,1}:\/\//)&&(e="http://"+e),this.effectiveUrl=e},this.resetUrl=function(){this.effectiveUrl=""},this.version=function(e){var s=function(s){o=new EVWEB2.ServiceVersion,a=new EVWEB2.ServiceVersion;var t,r=s;if("string"!=typeof s&&(r=s.version,t=s.availableVersion),o.populateFromString(r)){void 0!==t&&a.populateFromString(t)||(a=new EVWEB2.ServiceVersion);var i=new EVWEB2.ResponseStatus(!0);e(i,o.toString(),o,a)}else{o=null,a=null;var n=new EVWEB2.ResponseStatus(!1,"An error occurred processing the version.");e(n)}};if(null===o||null===a){var t={success:s,error:function(t){if(404===t.status||0===t.status&&"timeout"===t.statusText)s({version:"2.0.0.0"});else{var r=new EVWEB2.ResponseStatus(!1,"An error occurred.");e(r)}},url:this.url()+EVWEB2.urls.version,data:{output:"json"}};n=!0,EVWEB2.ajax(t,this)}else s({version:o.toString(),success:!0,availableVersion:a.toString()})},this.supportsCors=function(){return null!==o?!o.lessThan(e.cors):(n||this.version($.noop),!1)},this.setResourceKey=function(e){this.resourceKey=e},this.getResourceKey=function(e){var s=this,t=function(){var s=new EVWEB2.ResponseStatus(!1,"An error occurred.");e(s)},r={success:function(r){var i="";if(void 0!==(i="string"==typeof r?r.replace(/^key=/,""):r.key)&&"-1"!==i){s.resourceKey=i;var n=new EVWEB2.ResponseStatus(!0);e(n,s.resourceKey)}else t()},error:t,url:this.url()+EVWEB2.urls.resourceKey};this.isXss()&&(r.data={output:"json"}),EVWEB2.ajax(r,this)},this.getServers=function(e){var s=this,t=function(s){var t=new EVWEB2.ResponseStatus(!1,EVWEB2.util.getErrorText(s));void 0!==s&&0===s.status&&"timeout"===s.statusText&&(t.errorText="XSS request timeout."),e(t)},r={success:function(r){if(r!==EVWEB2.errors.servers){if("string"==typeof r)try{r=JSON.parse(r)}catch(e){return void t()}var i=r.list,n=$.map(i,function(e){var t=e.id;void 0!==t&&(t=t.toString());var r,i,n=EVWEB2.util.internal.processServerDetails(e),o=EVWEB2.util.internal.processServerLicense(e);if(void 0!==e.group&&null!==e.group){var a=e.group,u=EVWEB2.util.internal.processUserGroupPermissions(a.permissions);r=new EVWEB2.CustomGroupPermissions(a.cameras,a.audios,a.serials,a.softTriggers),i=new EVWEB2.UserGroup(a.name,a.role,u,a.priorities,a.guid,r)}else i=EVWEB2.util.processServerPermissions(e);return new EVWEB2.Server(s,e.name,t,e.login,e.restricted,void 0,void 0,void 0,n,o,void 0,i,e.managedFeatures,e.canAutoLogin)});void 0!==r.CSRF&&(s.csrf=r.CSRF);var o=new EVWEB2.ResponseStatus(!0);e(o,n)}else t()},error:t,url:this.url()+EVWEB2.urls.getServerList,data:{output:"json"}};EVWEB2.ajax(r,this)};var E=function(e,s,t){var r,i=[];if(void 0===t&&(t=e.id),i.push(new EVWEB2.ViewFolder(e.id,s,t)),null!==e.folders)for(r in e.folders)if(e.folders.hasOwnProperty(r)){var n=E(e.folders[r],r,e.id);i=i.concat(n)}return i},d=function(e){var s;if(void 0!==e){var t=$.map(e.slots,function(e){return new EVWEB2.LayoutSlot(e.y,e.x,e.width,e.height)});s=new EVWEB2.Layout(e.name,e.width,e.height,e.length,t,void 0,e.widescreen)}return s},v=function(e){return function(s){return s.id===e}},h=function(e,s){var t;if(void 0!==e.audioInput&&null!==e.audioInput){var r=$.grep(s,function(s){var t=e.audioInput.server;return"0x"!==t.substr(0,2)&&(t="0x"+parseInt(t,10).toString(16)),e.audioInput.server===s.id||t===s.sessionId})[0];t=new EVWEB2.ViewAudioInputInfo(e.audioInput.id,r)}return t};this.getViews=function(e,s){$.isArray(s)||(s=[s]);var t={s:$.map(s,function(e){return e.sessionId})},r=$.grep(s,function(e){return e.isPassthroughServer()&&e.service.isXss()}),i={success:function(t){var r=E(t.Folders,""),i=$.map(t.Views,function(e){return void 0!==e.items?function(e,s,t){var r=d(e.layout_info),i=$.map(e.items,function(e){var t=$.grep(s,v(e.server))[0],r=null;return e.type===EVWEB2.ViewSlotItemTypes.camera?r=EVWEB2.Camera:e.type===EVWEB2.ViewSlotItemTypes.group?r=EVWEB2.Map:e.type===EVWEB2.ViewSlotItemTypes.audio&&(r=EVWEB2.AudioDevice),new EVWEB2.ViewSlotItem(e.id,t,r,e.slot,e.digitalPtzType)}),n=$.grep(t,function(s){return s.id===e.folder})[0],o=h(e,s);return new EVWEB2.View(e.name,n,i,e.layout,r,e.order,o,e.description,e.id)}(e,s,r):function(e,s,t){var r,i=d(e.layout_info),n=[];for(r=0;r<e.cameras.length;r++){var o=null,a=e.cameras[r];if(null!==a){var u=$.grep(s,v(a.server))[0];o=new EVWEB2.ViewCameraInfo(a.camera,u,a.digitalPtzType)}n.push(o)}var c=$.grep(t,function(s){return s.id===e.folder})[0],E=h(e,s);return new EVWEB2.View(e.name,c,n,e.layout,i,e.order,E,e.description)}(e,s,r)}),n=new EVWEB2.ResponseStatus(!0);e(n,i,r)},error:function(){var s=new EVWEB2.ResponseStatus(!1,"An error occurred.");e(s)},url:s[0].service.url()+EVWEB2.urls.getViewList,data:t,traditional:!0};if(r.length>0){if(""===this.resourceKey)throw new Error("CSRF enforced, passthrough will not work.");i.data.key=this.resourceKey}EVWEB2.ajax(i,this)};this.getMaps=function(e,s){$.isArray(s)||(s=[s]);var t={s:$.map(s,function(e){return e.sessionId}),output:"json"},r={success:function(t){var r=$.map(t.maps,function(e){if(void 0!==e.items)return function(e,s){var t=$.map(e.items,function(e){var s=new EVWEB2.MapItemCaptionInfo(e.caption,e.color);return new EVWEB2.MapItemInfo(e.id,e.server,e.type,e.shape,e.x,e.y,s,e.rotation,e.flags)}),r=$.grep(s,function(s){return s.sessionId.toString()===e.rootServer.toString()})[0];return new EVWEB2.Map(r.service,e.id,r,e.parent,e.name,e.description,t)}(e,s)}),i=new EVWEB2.ResponseStatus(!0);e(i,r)},error:function(){var s=new EVWEB2.ResponseStatus(!1,"An error occurred.");e(s)},url:this.url()+EVWEB2.urls.map,data:t,traditional:!0};EVWEB2.ajax(r,this)};this.getGroups=function(e,s){$.isArray(s)||(s=[s]);var t={s:$.map(s,function(e){return e.sessionId}),output:"json"},r={success:function(s){var t=$.map(s.groups,function(e){if(void 0!==e.items)return function(e){var s=$.map(e.items,function(e){return new EVWEB2.GroupItemInfo(e.id,e.server,e.type)});return new EVWEB2.Group(e.id,e.name,e.description,e.icon,s)}(e)}),r=new EVWEB2.ResponseStatus(!0);e(r,t)},error:function(){var s=new EVWEB2.ResponseStatus(!1,"An error occurred.");e(s)},url:this.url()+EVWEB2.urls.groups,data:t,traditional:!0};EVWEB2.ajax(r,this)};var l=function(e,s,t){var r,i=[];for(void 0===t&&(t=e.id),i.push(new EVWEB2.TourFolder(e.id,s,t)),r=0;r<e.folders.length;r++){var n=l(e.folders[r],e.folders[r].name,e.id);i=i.concat(n)}return i};this.getTours=function(e,s){$.isArray(s)||(s=[s]);var t=this,r={s:$.map(s,function(e){return e.sessionId})},i={success:function(s){var r=l(s.folders,""),i=$.map(s.tours,function(e){var s=$.map(e.views,function(e){return new EVWEB2.TourItem(e.index,e.dwell,e.view)}),i=$.grep(r,function(s){return s.id===e.folder_id})[0];return new EVWEB2.Tour(e.name,i,s,e.description,t)}),n=new EVWEB2.ResponseStatus(!0);e(n,i,r)},error:function(){var s=new EVWEB2.ResponseStatus(!1,"An error occurred.");e(s)},url:s[0].service.url()+EVWEB2.urls.tours,data:r,traditional:!0};EVWEB2.ajax(i,this)},this.audioInputFormatTypes=function(e){if(u.length>0)e(new EVWEB2.ResponseStatus(!0),u);else{var s={success:function(s){if(s.success){u=s.formats;var t=new EVWEB2.ResponseStatus(!0);e(t,u)}else{var r=new EVWEB2.ResponseStatus(!1,s.errorText);e(r)}},error:function(){var s=new EVWEB2.ResponseStatus(!1,"An error occurred.");e(s)},url:this.url()+EVWEB2.urls.audio};EVWEB2.ajax(s,this)}},this.videoExportFormatTypes=function(e){var s={success:function(s){if(s.success){var t=new EVWEB2.ResponseStatus(!0);e(t,s.formatTypes)}else{var r=new EVWEB2.ResponseStatus(!1,s.errorText);e(r)}},error:function(){var s=new EVWEB2.ResponseStatus(!1,"An error occurred.");e(s)},url:this.url()+EVWEB2.urls.videoexport,data:{output:"json"}};EVWEB2.ajax(s,this)},this.getServersStatus=function(e,s){var t={s:$.map(s,function(e){return e.sessionId})},r={success:function(t){if(t.success){var r=$.map(t.statuses,function(e){var t=$.grep(s,function(s){return s.sessionId.toString()===e.sessionId.toString()})[0];return new EVWEB2.ServerStatus(t,e.loss,e.motion,e.alarm,e.serverStatus)}),i=new EVWEB2.ResponseStatus(!0);e(i,r)}else{var n=new EVWEB2.ResponseStatus(!1,t.errorText);e(n)}},error:function(){var s=new EVWEB2.ResponseStatus(!1,"An error occurred.");e(s)},url:this.url()+EVWEB2.urls.status,data:t,traditional:!0};EVWEB2.ajax(r,this)},this.getHealth=function(e){if("function"!=typeof e)throw new Error("Callback required");var s={success:function(s){if(s.success){var t,r,i,n,o,a,u=new EVWEB2.ResponseStatus(s.success,s.errorText);t=$.map(s.servers,function(e){var s=new EVWEB2.ServerHealth(e.serverID,e.serverAddress,e.liveConnections,e.searchConnections,e.passthroughError,e.users);return void 0!==e.streams&&(s.streams=new EVWEB2.ServerHealthStreamInfo(s.serverID,e.streams.compressed,e.streams.uncompressed)),s}),void 0!==s.streams&&(r=new EVWEB2.ServiceHealthStreamInfo(s.streams.compressed,s.streams.uncompressed)),void 0!==s.version&&(i=new EVWEB2.ServiceHealthVersionInfo(s.version.service,s.version.evapi,s.version.webServer)),void 0!==s.os&&(n=new EVWEB2.ServiceHealthOsInfo(s.os.system,s.os.release,s.os.version,s.os.machine,s.os.processor,s.os.node)),void 0!==s.processes&&(o=$.map(s.processes,function(e){return new EVWEB2.ServiceHealthProcessInfo(e.name,e.cpu,e.ram,e.serverId)})),void 0!==s.system&&(a=new EVWEB2.ServiceHealthSystemInfo(s.system.cores,s.system.memory.total,s.system.memory.available,s.system.cpu));var c=new EVWEB2.ServiceHealth(s.uptime,t,i,n,o,a,r);e(u,c)}else{var E=new EVWEB2.ResponseStatus(!1,s.errorText);e(E)}},error:function(){var s=new EVWEB2.ResponseStatus(!1,"An error occurred.");e(s)},url:this.url()+EVWEB2.urls.health,data:{}};EVWEB2.ajax(s,this)},this.getConfigUpdateStatus=function(e,s){if("function"!=typeof e)throw new Error("Callback required");var t={s:$.map(s,function(e){return e.sessionId.toString()})},r={success:function(s){var t=new EVWEB2.ResponseStatus(!0),r=$.map(s.statuses,function(e){var s=EVWEB2.util.IETF2Date(e.config.lastUpdated);return new EVWEB2.ConfigUpdateStatus(e.sessionId,s)});e(t,r)},error:function(){var s=new EVWEB2.ResponseStatus(!1,"An error occurred.");e(s)},url:this.url()+EVWEB2.urls.configUpdateStatus,data:t,traditional:!0};EVWEB2.ajax(r,this)},this.getEventMonitorProfiles=function(e,s){$.isArray(s)||(s=[s]);var t=this,r={s:$.map(s,function(e){return e.sessionId})},i={success:function(s){if(s.success){var r=$.map(s.profiles,function(e){var s=new EVWEB2.EventMonitorProfile(t,e.name,e.type,e.description,e.showEventsList,e.showNewestEvent);return s.events=$.map(e.events,function(e){var r=e.source,i=new EVWEB2.EventMonitorLinkSource;null!==r&&(i=new EVWEB2.EventMonitorLinkSource(r.server,r.id,r.type,r.extra,r.any));var n=e.target,o=new EVWEB2.EventMonitorLinkTarget;return null!==n&&(o=new EVWEB2.EventMonitorLinkTarget(n.server,n.value,n.type,n.extra,n.folders)),new EVWEB2.EventMonitorLink(t,s,e.guid,i,o,e.priority,e.confirm,e.timeout,e.message)}),s}),i=new EVWEB2.ResponseStatus(!0);e(i,r)}else{var n=new EVWEB2.ResponseStatus(!1,s.errorText);e(n)}},error:function(s){var t=new EVWEB2.ResponseStatus(!1,EVWEB2.util.getErrorText(s));e(t)},url:t.url()+EVWEB2.urls.eventMonitoring,data:r,traditional:!0};EVWEB2.ajax(i,this)},this.createEventMonitorProfile=function(e,s){var t=this,r=s.events[0];if(void 0===r){var i=new EVWEB2.ResponseStatus(!1,"No event link specified for profile.");e(i)}var n={name:s.name,description:s.description,type:s.type,showEventsList:s.showEventsList,showNewestEvent:s.showNewest,eventConfirm:r.confirm,eventMessage:r.message,eventTimeout:r.timeout,eventPriority:r.priority};null!==r.source?(n.eventSourceId=r.source.id,n.eventSourceServer=r.source.server,n.eventSourceType=r.source.type,n.eventSourceAny=r.source.any,r.source.extraId.length>0&&(n.eventSourceExtra=r.source.extraId)):(n.eventSourceServer=r.target.server,n.eventSourceType=EVWEB2.EventMonitorLinkSourceTypes.None),null!==r.target?(n.eventTargetValue=r.target.value,n.eventTargetServer=r.target.server,n.eventTargetType=r.target.type,n.eventTargetFolders=r.target.folders,r.target.extraId.length>0&&(n.eventTargetExtra=r.target.extraId)):(n.eventTargetServer=r.source.server,n.eventTargetType=EVWEB2.EventMonitorLinkTargetTypes.None);var o={success:function(r){if(r.success){var i=r.profile;s.name=i.name,s.type=i.type,s.description=i.description,s.showEventsList=i.showEventsList,s.showNewest=i.showNewestEvent,s.events=$.map(i.events,function(e){var r=e.source,i=new EVWEB2.EventMonitorLinkSource;null!==r&&(i=new EVWEB2.EventMonitorLinkSource(r.server,r.id,r.type,r.extra,r.any));var n=e.target,o=new EVWEB2.EventMonitorLinkTarget;return null!==n&&(o=new EVWEB2.EventMonitorLinkTarget(n.server,n.value,n.type,n.extra,n.folders)),new EVWEB2.EventMonitorLink(t,s,e.guid,i,o,e.priority,e.confirm,e.timeout,e.message)});var n=new EVWEB2.ResponseStatus(!0);e(n,s)}else{var o=new EVWEB2.ResponseStatus(!1,r.errorText);e(o)}},error:function(s){var t=new EVWEB2.ResponseStatus(!1,EVWEB2.util.getErrorText(s));e(t)},url:t.url()+EVWEB2.urls.eventMonitoring,type:"POST",data:n};EVWEB2.ajax(o,this)},this.getCases=function(e,s){var t={s:$.map(s,function(e){return e.sessionId})},r={success:function(t){if(t.success){var r=$.map(t.cases,function(e){var t=$.grep(s,function(s){return-1!==$.inArray(s.sessionId.toString(),e.servers)});return new EVWEB2.Case(t,e.guid,e.name,e.description,e.bookmarks)}),i=new EVWEB2.ResponseStatus(!0);e(i,r)}else{var n=new EVWEB2.ResponseStatus(!1,t.errorText);e(n)}},error:function(s){var t=new EVWEB2.ResponseStatus(!1,EVWEB2.util.getErrorText(s));e(t)},url:this.url()+EVWEB2.urls.bookmarkCases,type:"GET",data:t,traditional:!0};this.isXss()&&EVWEB2.util.updateRequestForXss(r,this),$.ajax(r)},this.createCase=function(e,s){var t={s:$.map(s.servers,function(e){return e.sessionId}),name:s.name};void 0!==s.description&&(t.description=s.description);var r={success:function(t){if(t.success){var r=t.case,i=$.grep(s.servers,function(e){return-1!==$.inArray(e.sessionId.toString(),r.servers)}),n=new EVWEB2.Case(i,r.guid,r.name,r.description,r.bookmarks),o=new EVWEB2.ResponseStatus(!0);e(o,n)}else{var a=new EVWEB2.ResponseStatus(!1,t.errorText);e(a)}},error:function(s){var t=new EVWEB2.ResponseStatus(!1,EVWEB2.util.getErrorText(s));e(t)},url:this.url()+EVWEB2.urls.bookmarkCases,type:"POST",data:t,traditional:!0};this.isXss()&&EVWEB2.util.updateRequestForXss(r,this),$.ajax(r)},this.getBookmarks=function(e,s){var t={s:$.map(s,function(e){return e.sessionId})},r={success:function(t){if(t.success){var r={};$.each(s,function(e,s){r[s.sessionId]=s});var i=$.map(t.bookmarks,function(e){var s=$.map(e.items,function(e){return new EVWEB2.BookmarkItem(r[e.server],e.id,e.type)}),t=EVWEB2.util.IETF2Date(e.start),i=EVWEB2.util.IETF2Date(e.end);return new EVWEB2.Bookmark(e.name,e.guid,t,i,s,e.description,e.size,e.case)}),n=new EVWEB2.ResponseStatus(!0);e(n,i)}else{var o=new EVWEB2.ResponseStatus(!1,t.errorText);e(o)}},error:function(s){var t=new EVWEB2.ResponseStatus(!1,EVWEB2.util.getErrorText(s));e(t)},url:this.url()+EVWEB2.urls.bookmark,type:"GET",data:t,traditional:!0};this.isXss()&&EVWEB2.util.updateRequestForXss(r,this),$.ajax(r)},this.createBookmark=function(e,s){if(0!==s.items.length){var t={s:s.items[0].server.sessionId,name:s.name,description:s.description,start:EVWEB2.util.Date2IETF(s.start),end:EVWEB2.util.Date2IETF(s.end),itemId:s.items[0].id,itemType:s.items[0].type};null!==s.caseId&&(t.case=s.caseId);var r={success:function(t){if(t.success){var r={};$.each(s.items,function(e,s){r[s.server.sessionId]=s.server});var i=$.map(t.bookmark.items,function(e){return new EVWEB2.BookmarkItem(r[e.server],e.id,e.type)}),n=EVWEB2.util.IETF2Date(t.bookmark.start),o=EVWEB2.util.IETF2Date(t.bookmark.end),a=new EVWEB2.Bookmark(t.bookmark.name,t.bookmark.guid,n,o,i,t.bookmark.description,t.bookmark.size,t.bookmark.case),u=s.items.length-1,c=!1,E=function(s){if(u--,s.success||(c=!0),u<=0){var t;c&&(t="Not all items were added to the bookmark.");var r=new EVWEB2.ResponseStatus(!0,t);e(r,a)}};if(u>0){var d;for(d=1;d<s.items.length;d++)a.addItem(E,s.items[d])}else{var v=new EVWEB2.ResponseStatus(!0);e(v,a)}}else{var h=new EVWEB2.ResponseStatus(!1,t.errorText);e(h)}},error:function(s){var t=new EVWEB2.ResponseStatus(!1,EVWEB2.util.getErrorText(s));e(t)},url:this.url()+EVWEB2.urls.bookmark,type:"POST",data:t};this.isXss()&&EVWEB2.util.updateRequestForXss(r,this),$.ajax(r)}else{var i=new EVWEB2.ResponseStatus(!1,"A bookmark must have at least one item.");e(i)}},this.friendlyName=function(e){if(""===c){var s={success:function(s){c=s.name;var t=new EVWEB2.ResponseStatus(!0);e(t,c)},error:function(s){var t=new EVWEB2.ResponseStatus(!1,EVWEB2.util.getErrorText(s));e(t)},url:this.url()+EVWEB2.urls.serviceInfo};this.isXss()&&EVWEB2.util.updateRequestForXss(s,this),$.ajax(s)}else{var t=new EVWEB2.ResponseStatus(!0);e(t,c)}},this.getAddresses=function(e){EVWEB2.ajax({url:this.url()+EVWEB2.urls.addresses,success:function(s){var t,r,i,n;s.addresses.internal&&(t=s.addresses.internal.map(function(e){return new EVWEB2.NetworkAddress(e.protocol,e.host,e.port)})),s.addresses.detected&&(r=s.addresses.detected.map(function(e){return new EVWEB2.NetworkAddress(e.protocol,e.host,e.port)})),s.addresses.external&&(i=new EVWEB2.NetworkAddress(s.addresses.external.protocol,s.addresses.external.host,s.addresses.external.port));var o=[];s.addresses.relay&&(n=new EVWEB2.NetworkAddress(s.addresses.relay.address.protocol,s.addresses.relay.address.host,s.addresses.relay.address.port),o=s.addresses.relay.throttled);var a=new EVWEB2.ServiceAddresses(t,r,i,n);e(new EVWEB2.ResponseStatus(!0),a,o)},error:function(s){e(new EVWEB2.ResponseStatus(!1,EVWEB2.util.getErrorText(s)))}},this)}},EVWEB2.NetworkAddress=function(e,s,t){this.protocol=e||"http",this.hostname=s||"",this.port=t||("https"===this.protocol?443:80)},EVWEB2.ServiceAddresses=function(e,s,t,r){this.internal=e||[],this.detected=s||[],this.external=t||null,this.relay=r||null}}(),function(){"use strict";EVWEB2.httpPolicy={none:0,redirect:1,disable:2},EVWEB2.BasicSSLConfig=function(e,s,t,r){this.commonName="",this.domains=[],this.valid=!1,this.expiration=null,void 0!==e&&(this.commonName=e),void 0!==s&&(this.domains=s),void 0!==t&&(this.valid=t),void 0!==r&&(this.expiration=r)},EVWEB2.ExternalSSLConfig=function(e,s){this.enabled=e,this.basic=s},EVWEB2.sslConfigType={none:0,external:1,acme:2},EVWEB2.acmeSSLRequestStatus={pending:1,success:2,httpChallengeFailed:-1,localDomainVerifyFailed:-2,networkError:-3,rateLimited:-4,accountDataCorrupt:-5,invalidDomain:-6,protocolError:-7,unknownError:-8},EVWEB2.AcmeSSLConfig=function(e,s,t,r){this.enabled=e,this.basic=s,this.autoRenew=!1,this.acmeServer=null,void 0!==t&&(this.autoRenew=t),void 0!==r&&(this.acmeServer=r)},EVWEB2.ServiceServerConfiguration=function(e,s,t,r,i,n,o,a,u,c,E,d){this.id=0,this.address="",this.port=0,this.timeout=0,this.passthrough=!1,this.username="",this.password="",this.autopopulate=!1,this.powerUser=!1,this.powerUserUsername="",this.powerUserPassword="",this.name="",void 0!==e&&(this.id=e),void 0!==s&&(this.address=s),void 0!==t&&(this.port=t),void 0!==r&&(this.timeout=r),void 0!==i&&(this.passthrough=i),void 0!==n&&(this.username=n),void 0!==o&&(this.password=o),void 0!==a&&(this.autopopulate=a),void 0!==u&&(this.powerUser=u),void 0!==c&&(this.powerUserUsername=c),void 0!==E&&(this.powerUserPassword=E),void 0!==d&&(this.name=d)},EVWEB2.ServiceRemoteServerConfiguration=function(e,s,t,r,i,n,o,a,u,c,E){this.id=0,this.identifier="",this.timeout=0,this.passthrough=!1,this.username="",this.password="",this.autopopulate=!1,this.powerUser=!1,this.powerUserUsername="",this.powerUserPassword="",this.name="",void 0!==e&&(this.id=e),void 0!==s&&(this.identifier=s),void 0!==t&&(this.timeout=t),void 0!==r&&(this.passthrough=r),void 0!==i&&(this.username=i),void 0!==n&&(this.password=n),void 0!==o&&(this.autopopulate=o),void 0!==a&&(this.powerUser=a),void 0!==u&&(this.powerUserUsername=u),void 0!==c&&(this.powerUserPassword=c),void 0!==E&&(this.name=E)},EVWEB2.ServiceRemoteServerSettingsConfiguration=function(e,s){this.enabled=!1,this.port=35111,void 0!==e&&(this.enabled=e),void 0!==s&&(this.port=s)},EVWEB2.serviceLoggingLevels={NOTSET:-1,ERROR:0,WARNING:1,INFO:2,DEBUG:3},EVWEB2.serviceLogFileIntervalTypes={none:"",minute:"M",hour:"H",day:"D",week:"W"},EVWEB2.ServiceLogFileConfiguration=function(e,s,t,r){this.interval=0,this.type=EVWEB2.serviceLogFileIntervalTypes.none,this.count=0,this.level=EVWEB2.serviceLoggingLevels.NOTSET,void 0!==e&&(this.interval=e),void 0!==s&&(this.type=s),void 0!==t&&(this.count=t),void 0!==r&&(this.level=r)},EVWEB2.ServicePortsConfiguration=function(e,s,t,r,i){this.http=e||80,this.https=s||443,this.ws=t||8082,this.wss=r||8083,this.httpPolicy=i||EVWEB2.httpPolicy.none},EVWEB2.ServiceUpdateConfiguration=function(e,s){this.url="",this.timeout=0,void 0!==e&&(this.url=e),void 0!==s&&(this.timeout=s)},EVWEB2.ServiceBasicConfiguration=function(e,s,t,r,i,n,o,a){this.name="",this.url="",this.ports=null,this.csrf=!0,this.loginExpiration=30,this.inactivityTimeout=0,this.autocomplete=o||!1,this.relay=a||!1,void 0!==e&&(this.name=e),void 0!==s&&(this.url=s),void 0!==t&&(this.ports=t),void 0!==r&&(this.csrf=r),void 0!==i&&(this.loginExpiration=i),void 0!==n&&(this.inactivityTimeout=n)},EVWEB2.serviceExternalAuthTypes={none:0,esm:1},EVWEB2.ServiceExternalAuthConfiguration=function(e,s){this.type=EVWEB2.serviceExternalAuthTypes.none,this.url="",this.user="",this.password="",void 0!==e&&(this.type=e),void 0!==s&&this.type===EVWEB2.serviceExternalAuthTypes.esm&&(void 0!==s.url&&(this.url=s.url),void 0!==s.user&&(this.user=s.user),void 0!==s.password&&(this.password=s.password))},EVWEB2.configAccessLevel={all:0,noRelay:1,localhostOnly:2},EVWEB2.ServiceAdminConfiguration=function(e,s,t){this.username=e,this.password="",this.accessLevel=EVWEB2.configAccessLevel.noRelay,this.localhostRestriction=!1,void 0!==s&&(this.password=s),void 0!==t&&("boolean"!=typeof t?(this.accessLevel=t,this.localhostRestriction=t===EVWEB2.configAccessLevel.localhostOnly):(this.localhostRestriction=t,this.accessLevel=t?EVWEB2.configAccessLevel.localhostOnly:EVWEB2.configAccessLevel.noRelay))},EVWEB2.ServiceConfig=function(e){this.service=e,this.authToken=null,this.status=new EVWEB2.ServiceStatus(this);var s,t=null;this.getAuthorization=function(e,s,t){var r=this,i={success:function(s){if(s.success){r.authToken=s.auth;var t=new EVWEB2.ResponseStatus(!0);e(t,r)}else{var i=new EVWEB2.ResponseStatus(!1,s.errorText);e(i)}},error:function(){var s=new EVWEB2.ResponseStatus(!1,"An error occurred.");e(s)},url:r.service.url()+EVWEB2.urls.serviceConfigToken,type:"POST",dataType:"json",data:{u:s,p:t}};EVWEB2.ajax(i,r.service)},this.destroyAuthorization=function(e){var s=this;if(null!==s.authToken){var t={success:function(t){if(t.success){s.authToken=null;var r=new EVWEB2.ResponseStatus(!0);e(r,s)}else{var i=new EVWEB2.ResponseStatus(!1,t.errorText);e(i)}},error:function(){var s=new EVWEB2.ResponseStatus(!1,"An error occurred.");e(s)},url:s.service.url()+EVWEB2.urls.serviceConfigToken,type:"DELETE",data:{auth:s.authToken}};EVWEB2.ajax(t,s.service)}else{var r=new EVWEB2.ResponseStatus(!1,"No authorization to destroy.");e(r)}},this.getServers=function(e){if(null!==this.authToken){var s={success:function(s){if(s.success){var t=$.map(s.servers,function(e){return new EVWEB2.ServiceServerConfiguration(e.id,e.address,e.port,e.timeout,e.passthrough,e.user,e.password,!1,e.powerUser,e.powerUserUsername,e.powerUserPassword,e.friendlyName)}),r=new EVWEB2.ResponseStatus(!0);e(r,t)}else{var i=new EVWEB2.ResponseStatus(!1,s.errorText);e(i)}},error:function(){var s=new EVWEB2.ResponseStatus(!1,"An error occurred.");e(s)},url:this.service.url()+EVWEB2.urls.serviceConfigServers,type:"GET",dataType:"json",data:{auth:this.authToken}};EVWEB2.ajax(s,this.service)}else{var t=new EVWEB2.ResponseStatus(!1,"No authorization.");e(t)}},this.addServer=function(e,s){if(null!==this.authToken){var t={success:function(t){if(t.success){s.id=t.id;var r=new EVWEB2.ResponseStatus(!0);e(r,t.restart,s)}else{var i=new EVWEB2.ResponseStatus(!1,t.errorText);e(i)}},error:function(){var s=new EVWEB2.ResponseStatus(!1,"An error occurred.");e(s)},url:this.service.url()+EVWEB2.urls.serviceConfigServers,type:"POST",dataType:"json",data:{auth:this.authToken,address:s.address,port:s.port,passthrough:s.passthrough,user:s.username,password:s.password,timeout:s.timeout,powerUser:s.powerUser,powerUserUsername:s.powerUserUsername,powerUserPassword:s.powerUserPassword}};EVWEB2.ajax(t,this.service)}else{var r=new EVWEB2.ResponseStatus(!1,"No authorization.");e(r)}},this.updateServer=function(e,s){if(null!==this.authToken){var t={success:function(t){if(t.success){var r=new EVWEB2.ResponseStatus(!0);e(r,t.restart,s)}else{var i=new EVWEB2.ResponseStatus(!1,t.errorText);e(i)}},error:function(){var s=new EVWEB2.ResponseStatus(!1,"An error occurred.");e(s)},url:this.service.url()+EVWEB2.urls.serviceConfigServers,type:"PUT",dataType:"json",data:{auth:this.authToken,id:s.id,address:s.address,port:s.port,passthrough:s.passthrough,user:s.username,password:s.password,timeout:s.timeout,powerUser:s.powerUser,powerUserUsername:s.powerUserUsername,powerUserPassword:s.powerUserPassword}};EVWEB2.ajax(t,this.service)}else{var r=new EVWEB2.ResponseStatus(!1,"No authorization.");e(r)}},this.deleteServer=function(e,s){if(null!==this.authToken){var t={success:function(t){if(t.success){var r=new EVWEB2.ResponseStatus(!0);e(r,t.restart,s)}else{var i=new EVWEB2.ResponseStatus(!1,t.errorText);e(i)}},error:function(){var s=new EVWEB2.ResponseStatus(!1,"An error occurred.");e(s)},url:this.service.url()+EVWEB2.urls.serviceConfigServers,type:"DELETE",dataType:"json",data:{auth:this.authToken,id:s.id}};EVWEB2.ajax(t,this.service)}else{var r=new EVWEB2.ResponseStatus(!1,"No authorization.");e(r)}},this.importXdv=function(s,t,r){if(null!==this.authToken){void 0===r&&(r=!1);var i={auth:this.authToken};if(r?i.url=t:i.ini=t,i.ini instanceof $){if(EVWEB2.util.internal.XSSPost(e.url()+EVWEB2.urls.serviceConfigServersXdv,i),void 0!==s){e.config.getServers(function(e,t){s(e,!0,t)})}}else{var n={success:function(e){if(e.success){var t=$.map(e.servers,function(e){return new EVWEB2.ServiceServerConfiguration(e.id,e.address,e.port,e.timeout,e.passthrough,e.user,e.password,!1,e.powerUser,e.powerUserUsername,e.powerUserPassword)}),r=new EVWEB2.ResponseStatus(!0);s(r,e.restart,t)}else{var i=new EVWEB2.ResponseStatus(!1,e.errorText);s(i)}},error:function(){var e=new EVWEB2.ResponseStatus(!1,"An error occurred.");s(e)},url:this.service.url()+EVWEB2.urls.serviceConfigServersXdv,type:"POST",dataType:"json",data:i};EVWEB2.ajax(n,this.service)}}else{var o=new EVWEB2.ResponseStatus(!1,"No authorization.");s(o)}},this.exportXdv=function(e,s){if(null!==this.authToken){var t=function(s){if(s.success){var t=new EVWEB2.ResponseStatus(!0);e(t,s.ini)}else{var r=new EVWEB2.ResponseStatus(!1,s.errorText);e(r)}},r={auth:this.authToken},i=this.service.url()+EVWEB2.urls.serviceConfigServersXdv;if(void 0!==s){r.filename=s;var n=$.map(r,function(e,s){return s+"="+e});window.location=i+"?"+n.join("&"),t(new EVWEB2.ResponseStatus(!0))}else{var o={success:t,error:function(){var s=new EVWEB2.ResponseStatus(!1,"An error occurred.");e(s)},url:i,type:"GET",dataType:"json",data:r};EVWEB2.ajax(o,this.service)}}else{var a=new EVWEB2.ResponseStatus(!1,"No authorization.");e(a)}},this.getRemoteServers=function(e){if(null!==this.authToken){var s={success:function(s){if(s.success){var t=$.map(s.remoteServers,function(e){return new EVWEB2.ServiceRemoteServerConfiguration(e.id,e.identifier,e.timeout,e.passthrough,e.user,e.password,!1,e.powerUser,e.powerUserUsername,e.powerUserPassword,e.friendlyName)}),r=new EVWEB2.ResponseStatus(!0);e(r,t)}else{var i=new EVWEB2.ResponseStatus(!1,s.errorText);e(i)}},error:function(){var s=new EVWEB2.ResponseStatus(!1,"An error occurred.");e(s)},url:this.service.url()+EVWEB2.urls.serviceConfigRemoteServers,type:"GET",dataType:"json",data:{auth:this.authToken}};EVWEB2.ajax(s,this.service)}else{var t=new EVWEB2.ResponseStatus(!1,"No authorization.");e(t)}},this.addRemoteServer=function(e,s){if(null!==this.authToken){var t={success:function(t){if(t.success){s.id=t.id;var r=new EVWEB2.ResponseStatus(!0);e(r,t.restart,s)}else{var i=new EVWEB2.ResponseStatus(!1,t.errorText);e(i)}},error:function(){var s=new EVWEB2.ResponseStatus(!1,"An error occurred.");e(s)},url:this.service.url()+EVWEB2.urls.serviceConfigRemoteServers,type:"POST",dataType:"json",data:{auth:this.authToken,identifier:s.identifier,passthrough:s.passthrough,user:s.username,password:s.password,timeout:s.timeout,powerUser:s.powerUser,powerUserUsername:s.powerUserUsername,powerUserPassword:s.powerUserPassword}};EVWEB2.ajax(t,this.service)}else{var r=new EVWEB2.ResponseStatus(!1,"No authorization.");e(r)}},this.updateRemoteServer=function(e,s){if(null!==this.authToken){var t={success:function(t){if(t.success){var r=new EVWEB2.ResponseStatus(!0);e(r,t.restart,s)}else{var i=new EVWEB2.ResponseStatus(!1,t.errorText);e(i)}},error:function(){var s=new EVWEB2.ResponseStatus(!1,"An error occurred.");e(s)},url:this.service.url()+EVWEB2.urls.serviceConfigRemoteServers,type:"PUT",dataType:"json",data:{auth:this.authToken,id:s.id,identifier:s.identifier,passthrough:s.passthrough,user:s.username,password:s.password,timeout:s.timeout,powerUser:s.powerUser,powerUserUsername:s.powerUserUsername,powerUserPassword:s.powerUserPassword}};EVWEB2.ajax(t,this.service)}else{var r=new EVWEB2.ResponseStatus(!1,"No authorization.");e(r)}},this.deleteRemoteServer=function(e,s){if(null!==this.authToken){var t={success:function(t){if(t.success){var r=new EVWEB2.ResponseStatus(!0);e(r,t.restart,s)}else{var i=new EVWEB2.ResponseStatus(!1,t.errorText);e(i)}},error:function(){var s=new EVWEB2.ResponseStatus(!1,"An error occurred.");e(s)},url:this.service.url()+EVWEB2.urls.serviceConfigRemoteServers,type:"DELETE",dataType:"json",data:{auth:this.authToken,id:s.id}};EVWEB2.ajax(t,this.service)}else{var r=new EVWEB2.ResponseStatus(!1,"No authorization.");e(r)}},this.getRemoteServersSettings=function(e){if(null!==this.authToken){var s={success:function(s){if(s.success){var t=new EVWEB2.ServiceRemoteServerSettingsConfiguration(s.enabled,s.port),r=new EVWEB2.ResponseStatus(!0);e(r,t)}else{var i=new EVWEB2.ResponseStatus(!1,s.errorText);e(i)}},error:function(){var s=new EVWEB2.ResponseStatus(!1,"An error occurred.");e(s)},url:this.service.url()+EVWEB2.urls.serviceConfigRemoteServersListener,type:"GET",dataType:"json",data:{auth:this.authToken}};EVWEB2.ajax(s,this.service)}else{var t=new EVWEB2.ResponseStatus(!1,"No authorization.");e(t)}},this.setRemoteServersSettings=function(e,s){if(null!==this.authToken){var t={success:function(t){if(t.success){var r=new EVWEB2.ResponseStatus(!0);e(r,t.restart,s)}else{var i=new EVWEB2.ResponseStatus(!1,t.errorText);e(i)}},error:function(){var s=new EVWEB2.ResponseStatus(!1,"An error occurred.");e(s)},url:this.service.url()+EVWEB2.urls.serviceConfigRemoteServersListener,type:"POST",dataType:"json",data:{auth:this.authToken,enabled:s.enabled,port:s.port}};EVWEB2.ajax(t,this.service)}else{var r=new EVWEB2.ResponseStatus(!1,"No authorization.");e(r)}},this.getLoggingSettings=function(e){if(null!==this.authToken){var s={success:function(s){if(s.success){var t=new EVWEB2.ServiceLogFileConfiguration(s.interval,s.type,s.count,s.level),r=new EVWEB2.ResponseStatus(!0);e(r,t)}else{var i=new EVWEB2.ResponseStatus(!1,s.errorText);e(i)}},error:function(){var s=new EVWEB2.ResponseStatus(!1,"An error occurred.");e(s)},url:this.service.url()+EVWEB2.urls.serviceConfigLogging,type:"GET",dataType:"json",data:{auth:this.authToken}};EVWEB2.ajax(s,this.service)}else{var t=new EVWEB2.ResponseStatus(!1,"No authorization.");e(t)}},this.setLoggingSettings=function(e,s){if(null!==this.authToken){var t={success:function(t){if(t.success){var r=new EVWEB2.ResponseStatus(!0);e(r,t.restart,s)}else{var i=new EVWEB2.ResponseStatus(!1,t.errorText);e(i)}},error:function(){var s=new EVWEB2.ResponseStatus(!1,"An error occurred.");e(s)},url:this.service.url()+EVWEB2.urls.serviceConfigLogging,type:"POST",dataType:"json",data:{auth:this.authToken,level:s.level,type:s.type,interval:s.interval,count:s.count}};EVWEB2.ajax(t,this.service)}else{var r=new EVWEB2.ResponseStatus(!1,"No authorization.");e(r)}},this.getLog=function(e,s){if(null!==this.authToken){var t={auth:this.authToken};void 0!==s&&(t.lines=s);var r={success:function(s){if(s.success){var t=new EVWEB2.ResponseStatus(!0);e(t,s.log)}else{var r=new EVWEB2.ResponseStatus(!1,s.errorText);e(r)}},error:function(){var s=new EVWEB2.ResponseStatus(!1,"An error occurred.");e(s)},url:this.service.url()+EVWEB2.urls.serviceConfigLoggingFile,type:"GET",dataType:"json",data:t};EVWEB2.ajax(r,this.service)}else{var i=new EVWEB2.ResponseStatus(!1,"No authorization.");e(i)}},this.getLogDownloadUrl=function(){if(null===this.authToken)return null;var e=this.service.url()+EVWEB2.urls.serviceConfigLoggingFile,s={format:"text",download:!0,auth:this.authToken};return e+="?"+$.map(s,function(e,s){return s+"="+e}).join("&")},this.getBasicSettings=function(e){var s=this;if(null!==s.authToken){var t={success:function(t){if(t.success){var r=new EVWEB2.ServicePortsConfiguration(t.ports.http,t.ports.https,t.ports.ws,t.ports.wss,t.ports.httpPolicy);s.markPortsUpdated(r);var i=new EVWEB2.ServiceBasicConfiguration(t.name,t.url,r,t.csrf,t.loginExpiration,t.inactivityTimeout,t.autocomplete,t.relay),n=new EVWEB2.ResponseStatus(!0);e(n,i)}else{var o=new EVWEB2.ResponseStatus(!1,t.errorText);e(o)}},error:function(){var s=new EVWEB2.ResponseStatus(!1,"An error occurred.");e(s)},url:s.service.url()+EVWEB2.urls.serviceConfigBasic,type:"GET",dataType:"json",data:{auth:s.authToken}};EVWEB2.ajax(t,s.service)}else{var r=new EVWEB2.ResponseStatus(!1,"No authorization.");e(r)}},this.setBasicSettings=function(e,s){var t=this;if(null!==t.authToken){var r={success:function(r){if(r.success){t.markPortsUpdated(s.ports);var i=new EVWEB2.ResponseStatus(!0);e(i,r.restart,s)}else{var n=new EVWEB2.ResponseStatus(!1,r.errorText);e(n)}},error:function(t){var r=JSON.parse(t.responseText),i=new EVWEB2.ResponseStatus(!1,"An error occurred.");e(i,r.restart,s,r.conflicts)},url:t.service.url()+EVWEB2.urls.serviceConfigBasic,type:"POST",dataType:"json",data:{auth:t.authToken,name:s.name,url:s.url,http:s.ports.http,https:s.ports.https,ws:s.ports.ws,wss:s.ports.wss,csrf:s.csrf,loginExpiration:s.loginExpiration,inactivityTimeout:s.inactivityTimeout,autocomplete:s.autocomplete,relay:s.relay,httpPolicy:s.ports.httpPolicy}};EVWEB2.ajax(r,t.service)}else{var i=new EVWEB2.ResponseStatus(!1,"No authorization.");e(i)}},this.getUpdateSettings=function(e){if(null!==this.authToken){var s={success:function(s){if(s.success){var t=new EVWEB2.ServiceUpdateConfiguration(s.url,s.timeout),r=new EVWEB2.ResponseStatus(!0);e(r,t)}else{var i=new EVWEB2.ResponseStatus(!1,s.errorText);e(i)}},error:function(){var s=new EVWEB2.ResponseStatus(!1,"An error occurred.");e(s)},url:this.service.url()+EVWEB2.urls.serviceConfigUpdates,type:"GET",dataType:"json",data:{auth:this.authToken}};EVWEB2.ajax(s,this.service)}else{var t=new EVWEB2.ResponseStatus(!1,"No authorization.");e(t)}},this.setUpdateSettings=function(e,s){if(null!==this.authToken){var t={success:function(t){if(t.success){var r=new EVWEB2.ResponseStatus(!0);e(r,t.restart,s)}else{var i=new EVWEB2.ResponseStatus(!1,t.errorText);e(i)}},error:function(){var s=new EVWEB2.ResponseStatus(!1,"An error occurred.");e(s)},url:this.service.url()+EVWEB2.urls.serviceConfigUpdates,type:"POST",dataType:"json",data:{auth:this.authToken,url:s.url,timeout:s.timeout}};EVWEB2.ajax(t,this.service)}else{var r=new EVWEB2.ResponseStatus(!1,"No authorization.");e(r)}},this.getExternalAuthSettings=function(e){if(null!==this.authToken){var s={success:function(s){if(s.success){var t={};s.type===EVWEB2.serviceExternalAuthTypes.esm&&(t.url=s.url,t.user=s.username,t.password=s.password);var r=new EVWEB2.ServiceExternalAuthConfiguration(s.type,t),i=new EVWEB2.ResponseStatus(!0);e(i,r)}else{var n=new EVWEB2.ResponseStatus(!1,s.errorText);e(n)}},error:function(){var s=new EVWEB2.ResponseStatus(!1,"An error occurred.");e(s)},url:this.service.url()+EVWEB2.urls.serviceConfigExternalAuth,type:"GET",dataType:"json",data:{auth:this.authToken}};EVWEB2.ajax(s,this.service)}else{var t=new EVWEB2.ResponseStatus(!1,"No authorization.");e(t)}},this.setExternalAuthSettings=function(e,s){if(null!==this.authToken){var t={auth:this.authToken,type:s.type};s.type===EVWEB2.serviceExternalAuthTypes.esm&&(t.url=s.url,t.username=s.user,""!==t.password&&(t.password=s.password));var r={success:function(t){if(t.success){var r={};t.type===EVWEB2.serviceExternalAuthTypes.esm&&(r.url=t.url,r.username=t.username),s.password="";var i=new EVWEB2.ResponseStatus(!0);e(i,t.restart,s)}else{var n=new EVWEB2.ResponseStatus(!1,t.errorText);e(n)}},error:function(){var s=new EVWEB2.ResponseStatus(!1,"An error occurred.");e(s)},url:this.service.url()+EVWEB2.urls.serviceConfigExternalAuth,type:"POST",dataType:"json",data:t};EVWEB2.ajax(r,this.service)}else{var i=new EVWEB2.ResponseStatus(!1,"No authorization.");e(i)}},this.getAdminSettings=function(e){if(null!==this.authToken){var s={success:function(s){if(s.success){var t=s.accessLevel;void 0===t&&(t=s.localhostRestriction);var r=new EVWEB2.ServiceAdminConfiguration(s.username,void 0,t),i=new EVWEB2.ResponseStatus(!0);e(i,r)}else{var n=new EVWEB2.ResponseStatus(!1,s.errorText);e(n)}},error:function(){var s=new EVWEB2.ResponseStatus(!1,"An error occurred.");e(s)},url:this.service.url()+EVWEB2.urls.serviceConfigAdmin,type:"GET",dataType:"json",data:{auth:this.authToken}};EVWEB2.ajax(s,this.service)}else{var t=new EVWEB2.ResponseStatus(!1,"No authorization.");e(t)}},this.setAdminSettings=function(e,s){if(null!==this.authToken){var t={auth:this.authToken,username:s.username,localhostRestriction:s.localhostRestriction,accessLevel:s.accessLevel};""!==s.password&&(t.password=s.password);var r={success:function(t){if(t.success){s.password="";var r=new EVWEB2.ResponseStatus(!0);e(r,t.restart,s)}else{var i=new EVWEB2.ResponseStatus(!1,t.errorText);e(i)}},error:function(){var s=new EVWEB2.ResponseStatus(!1,"An error occurred.");e(s)},url:this.service.url()+EVWEB2.urls.serviceConfigAdmin,type:"POST",dataType:"json",data:t};EVWEB2.ajax(r,this.service)}else{var i=new EVWEB2.ResponseStatus(!1,"No authorization.");e(i)}},this.markPortsUpdated=function(e){t=e},this.restart=function(r,i){var n=this;if(void 0===i&&(i=!0),null!==n.authToken){var o={auth:n.authToken,action:"restart"},a={url:n.service.url()+EVWEB2.urls.service,success:function(o){if(o.success)if(o.xssPost){if(void 0!==r){var a=new EVWEB2.ResponseStatus(!0);r(a,e,!1)}}else{var u=window.location;if(null!==t){var c="http:"===u.protocol||"http"===s,E=c?80:443,d=c?t.http:t.https,v=e.hostUrl;""===v&&(v=u.protocol+"//"+u.hostname,""!==u.port&&u.port!==E.toString()&&(v+=":"+u.port),v+="/"),v=v.replace(/(:\d+)?[\/]?$/,""),d!==E&&(v+=":"+d),v+="/",n.service.hostUrl=v}if("https:"===u.protocol&&void 0!==s&&"https"!==s&&(n.service.hostUrl=n.service.hostUrl.replace("https","http"),i=!1),i)EVWEB2.util.notifyOnServiceRestart(r,n.service,3e3,10,5);else{var h=new EVWEB2.ResponseStatus(!0);r(h,n.service,!1)}}else{var l=new EVWEB2.ResponseStatus(!1,o.errorText);r(l)}},error:function(){var e=new EVWEB2.ResponseStatus(!1,"An error occurred.");r(e)},type:"POST",data:o};EVWEB2.ajax(a,n.service,!0)}else{var u=new EVWEB2.ResponseStatus(!1,"No authorization.");r(u)}},this.checkForUpdates=function(s,t){if(null!==this.authToken){var r={success:function(t){if(t.success){var r=$.map(t.update_info,function(s){var t="Recommended"===s.update_type;return new EVWEB2.ServiceUpdate(e,s.version,s.link,t,s.total_file_size)}),i=new EVWEB2.ResponseStatus(!0);s(i,r)}else{var n=new EVWEB2.ResponseStatus(!1,t.errorText);s(n)}},error:function(){var e=new EVWEB2.ResponseStatus(!1,"An error occurred.");s(e)},url:this.service.url()+EVWEB2.urls.service,data:{auth:this.authToken,action:"updatecheck",updates_file:t}};EVWEB2.ajax(r,this.service)}else{var i=new EVWEB2.ResponseStatus(!1,"No authorization.");s(i)}},this.getDiscoveredServers=function(e){if(null!==this.authToken){var s={success:function(s){if(s.success){var t=$.map(s.servers,function(e){return new EVWEB2.DiscoveryServer(e.address,e.port,e.name,e.macAddress,e.model,e.serial)}),r=new EVWEB2.ResponseStatus(!0);e(r,t)}else{var i=new EVWEB2.ResponseStatus(!1,s.errorText);e(i)}},error:function(s){var t=new EVWEB2.ResponseStatus(!1,EVWEB2.util.getErrorText(s));e(t)},url:this.service.url()+EVWEB2.urls.serviceDiscovery,data:{auth:this.authToken}};EVWEB2.ajax(s,this.service)}else{var t=new EVWEB2.ResponseStatus(!1,"No authorization.");e(t)}},this.getSSLConfigType=function(e){if(null!==this.authToken){var s={success:function(s){if(s.success){var t=new EVWEB2.ResponseStatus(!0);e(t,s.type)}else{var r=new EVWEB2.ResponseStatus(!1,s.errorText,s.errorCode);e(r)}},error:function(s){var t=new EVWEB2.ResponseStatus(!1,EVWEB2.util.getErrorText(s),EVWEB2.util.getErrorCode(s));e(t)},url:this.service.url()+EVWEB2.urls.serviceSSLConfigType,data:{auth:this.authToken}};EVWEB2.ajax(s,this.service)}else{var t=new EVWEB2.ResponseStatus(!1,"No authorization.");e(t)}},this.getExternalSSLConfig=function(e){if(null!==this.authToken){var t={success:function(t){if(t.success){var r=new EVWEB2.ResponseStatus(!0),i=EVWEB2.util.IETF2Date(t.sslConfig.expires),n=t.sslConfig.enabled,o=null;n&&(o=new EVWEB2.BasicSSLConfig(t.sslConfig.commonName,t.sslConfig.domains,t.sslConfig.valid,i),s="https");var a=new EVWEB2.ExternalSSLConfig(n,o);e(r,a)}else{var u=new EVWEB2.ResponseStatus(!1,t.errorText,t.errorCode);e(u)}},error:function(s){var t=new EVWEB2.ResponseStatus(!1,EVWEB2.util.getErrorText(s),EVWEB2.util.getErrorCode(s));e(t)},url:this.service.url()+EVWEB2.urls.serviceSSLExternalConfig,data:{auth:this.authToken}};EVWEB2.ajax(t,this.service)}else{var r=new EVWEB2.ResponseStatus(!1,"No authorization.");e(r)}},this.getAcmeSSLConfig=function(e){if(null!==this.authToken){var t={success:function(t){if(t.success){var r=new EVWEB2.ResponseStatus(!0),i=EVWEB2.util.IETF2Date(t.sslConfig.expires),n=t.sslConfig.enabled,o=null;n&&(o=new EVWEB2.BasicSSLConfig(t.sslConfig.commonName,t.sslConfig.domains,t.sslConfig.valid,i),s="https");var a=new EVWEB2.AcmeSSLConfig(n,o,t.autoRenew,t.acmeServer);e(r,a)}else{var u=new EVWEB2.ResponseStatus(!1,t.errorText,t.errorCode);e(u)}},error:function(s){var t=new EVWEB2.ResponseStatus(!1,EVWEB2.util.getErrorText(s),EVWEB2.util.getErrorCode(s));e(t)},url:this.service.url()+EVWEB2.urls.serviceSSLAcmeConfig,data:{auth:this.authToken}};EVWEB2.ajax(t,this.service)}else{var r=new EVWEB2.ResponseStatus(!1,"No authorization.");e(r)}},this.configureExtSSL=function(e,t,r,i){if(null!==this.authToken){var n={auth:this.authToken,privateKey:t,certificate:r};void 0!==i&&(n.chain=i);var o={success:function(t){if(t.success){s="https";var r=new EVWEB2.ResponseStatus(!0);e(r,t.restart)}else{var i=new EVWEB2.ResponseStatus(!1,t.errorText,t.errorCode);e(i)}},error:function(s){var t=new EVWEB2.ResponseStatus(!1,EVWEB2.util.getErrorText(s),EVWEB2.util.getErrorCode(s));e(t)},url:this.service.url()+EVWEB2.urls.serviceSSLExternalConfig,type:"POST",data:n};EVWEB2.ajax(o,this.service)}else{var a=new EVWEB2.ResponseStatus(!1,"No authorization.");e(a)}},this.configureAcmeSSL=function(e,s,t,r,i,n){if(null!==this.authToken){var o={auth:this.authToken,autoRenew:void 0===t||t};void 0!==s&&(o.domain=s),void 0!==i&&(o.acmeServer=i),void 0!==n&&(o.privateKey=n),void 0!==r&&(o.sans=r);var a={success:function(s){if(s.success){var t=new EVWEB2.ResponseStatus(!0);e(t,s.token)}else{var r=new EVWEB2.ResponseStatus(!1,s.errorText,s.errorCode);e(r)}},error:function(s){var t=new EVWEB2.ResponseStatus(!1,EVWEB2.util.getErrorText(s),EVWEB2.util.getErrorCode(s));e(t)},url:this.service.url()+EVWEB2.urls.serviceSSLAcmeConfig,type:"POST",data:o,traditional:!0};EVWEB2.ajax(a,this.service)}else{var u=new EVWEB2.ResponseStatus(!1,"No authorization.");e(u)}},this.checkAcmeSSLStatus=function(e,t){if(null!==this.authToken){var r={success:function(t){if(t.success){var r=new EVWEB2.ResponseStatus(!0),i=void 0!==t.restart&&t.restart;t.status===EVWEB2.acmeSSLRequestStatus.success&&(s="https"),e(r,i,t.status)}else{var n=new EVWEB2.ResponseStatus(!1,t.errorText,t.errorCode);e(n)}},error:function(s){var t=new EVWEB2.ResponseStatus(!1,EVWEB2.util.getErrorText(s),EVWEB2.util.getErrorCode(s));e(t)},url:this.service.url()+EVWEB2.urls.serviceSSLAcmeStatus,data:{auth:this.authToken,token:t}};EVWEB2.ajax(r,this.service)}else{var i=new EVWEB2.ResponseStatus(!1,"No authorization.");e(i)}},this.deleteSSLConfig=function(e){if(null!==this.authToken){var t={success:function(t){if(t.success){s="http";var r=new EVWEB2.ResponseStatus(!0),i=void 0!==t.restart&&t.restart;e(r,i)}else{var n=new EVWEB2.ResponseStatus(!1,t.errorText,t.errorCode);e(n)}},error:function(s){var t=new EVWEB2.ResponseStatus(!1,EVWEB2.util.getErrorText(s),EVWEB2.util.getErrorCode(s));e(t)},url:this.service.url()+EVWEB2.urls.serviceSSLConfigType,type:"DELETE",data:{auth:this.authToken}};EVWEB2.ajax(t,this.service)}else{var r=new EVWEB2.ResponseStatus(!1,"No authorization.");e(r)}},this.restoreDefaults=function(e,t){t=t||!1,this.authToken||e(new EVWEB2.ResponseStatus(!1,"No authorization."));var r={url:this.service.url()+EVWEB2.urls.serviceRestoreDefaults,type:"POST",error:function(s){var t=JSON.parse(s.responseText),r=new EVWEB2.ResponseStatus(!1,"An error occured.");e(r,t.restart,t.conflicts)},success:function(t){var r=new EVWEB2.ResponseStatus(!0);s="http",e(r,t.restart)},data:{auth:this.authToken,excludePorts:t}};EVWEB2.ajax(r,this.service)}}}(),function(){"use strict";EVWEB2.serverPassthroughErrors={none:0,loginError:1,connectError:2},EVWEB2.ServerHealthStreamInfo=function(e,s,t){this.serverID=-1,this.numCompressed=0,this.numUncompressed=0,void 0!==e&&(this.serverID=e),void 0!==s&&(this.numCompressed=s),void 0!==t&&(this.numUncompressed=t)},EVWEB2.ServiceHealthStreamInfo=function(e,s){this.numCompressed=0,this.numUncompressed=0,void 0!==e&&(this.numCompressed=e),void 0!==s&&(this.numUncompressed=s)},EVWEB2.ServerHealth=function(e,s,t,r,i,n,o){this.serverID=-1,this.serverAddress="",this.liveConnections=0,this.searchConnections=0,this.passthroughError=EVWEB2.serverPassthroughErrors.none,this.users=[],this.streams=null,void 0!==e&&(this.serverID=e),void 0!==s&&(this.serverAddress=s),void 0!==t&&(this.liveConnections=t),void 0!==r&&(this.searchConnections=r),void 0!==i&&(this.passthroughError=i),void 0!==n&&(this.users=n),void 0!==o&&(this.streams=o)},EVWEB2.ServiceHealthVersionInfo=function(e,s,t){this.version="",this.evapiVersion="",this.webServerVersion="",void 0!==e&&(this.version=e),void 0!==s&&(this.evapiVersion=s),void 0!==t&&(this.webServerVersion=t)},EVWEB2.ServiceHealthOsInfo=function(e,s,t,r,i,n){this.system="",this.release="",this.version="",this.machine="",this.processor="",this.node="",void 0!==e&&(this.system=e),void 0!==s&&(this.release=s),void 0!==t&&(this.version=t),void 0!==r&&(this.machine=r),void 0!==i&&(this.processor=i),void 0!==n&&(this.node=n)},EVWEB2.ServiceHealthProcessInfo=function(e,s,t,r){this.name="",this.cpu=0,this.ram=0,this.serverId=null,void 0!==e&&(this.name=e),void 0!==s&&(this.cpu=s),void 0!==t&&(this.ram=t),void 0!==r&&(this.serverId=r)},EVWEB2.ServiceHealthSystemInfo=function(e,s,t,r){this.cores=0,this.totalMemory=0,this.availableMemory=0,this.cpu=0,void 0!==e&&(this.cores=e),void 0!==s&&(this.totalMemory=s),void 0!==t&&(this.availableMemory=t),void 0!==r&&(this.cpu=r)},EVWEB2.ServiceHealth=function(e,s,t,r,i,n,o){this.uptime=0,this.servers=[],this.versionInfo=null,this.osInfo=null,this.processInfo=[],this.systemInfo=null,this.streamInfo=null,void 0!==e&&(this.uptime=e),void 0!==s&&(this.servers=s),void 0!==t&&(this.versionInfo=t),void 0!==r&&(this.osInfo=r),void 0!==i&&(this.processInfo=i),void 0!==n&&(this.systemInfo=n),void 0!==o&&(this.streamInfo=o)}}(),function(){"use strict";EVWEB2.relayErrors={none:0,internal:1,connect:2,getAddr:3,request:4,license:5,login:6,proxy:7},EVWEB2.ServiceIPAddress=function(e,s){this.address=e,this.mac="",void 0!==s&&(this.mac=s)},EVWEB2.ServiceNetworkConfig=function(e,s){this.internalIp=[],this.externalIp=null,void 0!==e&&(this.internalIp=e),void 0!==s&&(this.externalIp=s)},EVWEB2.ServiceRelayInfo=function(e,s){this.error=EVWEB2.relayErrors.none,this.address="",void 0!==e&&(this.error=e),void 0!==s&&(this.address=s)},EVWEB2.ServiceConnectivity=function(e,s,t,r,i,n,o){this.networkConfig=e,this.outbound=!1,this.http=!1,this.https=!1,this.ws=!1,this.wss=!1,this.relayInfo=null,void 0!==s&&(this.outbound=s),void 0!==t&&(this.http=t),void 0!==r&&(this.https=r),void 0!==i&&(this.ws=i),void 0!==n&&(this.wss=n),void 0!==o&&(this.relayInfo=o)},EVWEB2.ServiceSSLStatus=function(e,s){this.https=!1,this.wss=!1,void 0!==e&&(this.https=e),void 0!==s&&(this.wss=s)},EVWEB2.ServicePushNotificationStatus=function(e){this.certificates=!1,void 0!==e&&(this.certificates=e)},EVWEB2.ServiceUpdatesStatus=function(e){this.reachable=!1,void 0!==e&&(this.reachable=e)},EVWEB2.ServiceConfigStatus=function(e,s,t){this.ssl=e,this.pushNotifications=s,this.updates=t},EVWEB2.ServerConfigStatus=function(e,s,t,r,i){this.id=e,this.reachable=!1,this.passthrough=!1,this.powerUser=!1,this.remote=!1,void 0!==s&&(this.reachable=s),void 0!==t&&(this.passthrough=t),void 0!==r&&(this.powerUser=r),void 0!==i&&(this.remote=i)},EVWEB2.ServiceStatus=function(e){this.config=e,this.checkConnectivity=function(e,s){var t=this.config;if(null!==t.authToken){var r=t.service.url()+EVWEB2.urls.serviceConnectivityStatus,i={auth:t.authToken};!0===s&&(i.force=!0);var n={success:function(s){if(s.success){var t=$.map(s.internalIp,function(e){return new EVWEB2.ServiceIPAddress(e.address,e.mac)}),r=new EVWEB2.ServiceIPAddress(s.externalIp),i=new EVWEB2.ServiceNetworkConfig(t,r),n=new EVWEB2.ServiceRelayInfo(s.relay.error,s.relay.address),o=new EVWEB2.ServiceConnectivity(i,s.connectivity.outbound,s.connectivity.http,s.connectivity.https,s.connectivity.ws,s.connectivity.wss,n),a=EVWEB2.util.IETF2Date(s.lastUpdated),u=new EVWEB2.ResponseStatus(!0);e(u,o,a)}else{var c=new EVWEB2.ResponseStatus(!1,s.errorText);e(c)}},error:function(){var s=new EVWEB2.ResponseStatus(!1,"An error occurred.");e(s)},url:r,type:"GET",dataType:"json",data:i};EVWEB2.ajax(n,t.service)}else{var o=new EVWEB2.ResponseStatus(!1,"No authorization.");e(o)}},this.getConfigStatus=function(e){var s=this.config;if(null!==s.authToken){var t={success:function(s){if(s.success){var t=new EVWEB2.ServiceSSLStatus(s.ssl.http,s.ssl.ws),r=new EVWEB2.ServicePushNotificationStatus(s.pushNotifications.certificates),i=new EVWEB2.ServiceUpdatesStatus(s.updates),n=new EVWEB2.ServiceConfigStatus(t,r,i),o=new EVWEB2.ResponseStatus(!0);e(o,n)}else{var a=new EVWEB2.ResponseStatus(!1,s.errorText);e(a)}},error:function(){var s=new EVWEB2.ResponseStatus(!1,"An error occurred.");e(s)},url:s.service.url()+EVWEB2.urls.serviceConfigStatus,type:"GET",dataType:"json",data:{auth:s.authToken}};EVWEB2.ajax(t,s.service)}else{var r=new EVWEB2.ResponseStatus(!1,"No authorization.");e(r)}},this.getServerStatus=function(e){var s=this.config;if(null!==s.authToken){var t={success:function(s){if(s.success){var t=new EVWEB2.ResponseStatus(!0),r=$.map(s.servers,function(e){return new EVWEB2.ServerConfigStatus(e.id,e.reachable,e.passthrough,e.poweruser)}),i=$.map(s.remoteServers,function(e){return new EVWEB2.ServerConfigStatus(e.id,e.connected,e.passthrough,e.poweruser,!0)}),n=$.merge(r,i);e(t,n)}else{var o=new EVWEB2.ResponseStatus(!1,s.errorText);e(o)}},error:function(){var s=new EVWEB2.ResponseStatus(!1,"An error occurred.");e(s)},url:s.service.url()+EVWEB2.urls.serviceServerStatus,type:"GET",dataType:"json",data:{auth:s.authToken}};EVWEB2.ajax(t,s.service)}else{var r=new EVWEB2.ResponseStatus(!1,"No authorization.");e(r)}}}}(),EVWEB2.downloadUpdateStatusTypes={notStarted:0,downloading:1,completed:2,error:3},EVWEB2.ServiceUpdateDownloadStatus=function(e,s,t,r){this.status=EVWEB2.downloadUpdateStatusTypes.notStarted,this.currentFileSize=0,this.totalFileSize=0,this.update=null,void 0!==e&&(this.status=e),void 0!==s&&(this.currentFileSize=s),void 0!==t&&(this.totalFileSize=t),void 0!==r&&(this.update=r)},EVWEB2.ServiceUpdate=function(e,s,t,r,i){this.service=null,this.version="",this.updateUrl="",this.recommended=!1,this.totalFileSize=0,void 0!==e&&(this.service=e),void 0!==s&&(this.version=s),void 0!==t&&(this.updateUrl=t),void 0!==r&&(this.recommended=r),void 0!==i&&(this.totalFileSize=i),this.downloadUpdate=function(e,s,t){if(void 0===t&&(t=!1),t||!this.service.isXss()){var r={success:function(s){if(s.success){var t=new EVWEB2.ResponseStatus(!0);e(t)}else{var r=new EVWEB2.ResponseStatus(!1,s.errorText);e(r)}},error:function(){var s=new EVWEB2.ResponseStatus(!1,"An error occurred.");e(s)},url:this.service.url()+EVWEB2.urls.service,type:t?"GET":"POST",data:{auth:s,action:"downloadupdate",version:this.version}};EVWEB2.ajax(r,this.service)}else{var i=new EVWEB2.ResponseStatus(!1,"This call can not be performed via POST in XSS situations.");e(i)}},this.downloadUpdateStatus=function(e,s){var t=this,r={success:function(s){if(s.success){var r=new EVWEB2.ResponseStatus(!0),i=new EVWEB2.ServiceUpdateDownloadStatus(s.status,s.current_file_size,s.total_file_size,t);e(r,i)}else{var n=new EVWEB2.ResponseStatus(!1,s.errorText);e(n)}},error:function(){var s=new EVWEB2.ResponseStatus(!1,"An error occurred.");e(s)},url:this.service.url()+EVWEB2.urls.service,data:{auth:s,action:"downloadupdatestatus",version:this.version}};EVWEB2.ajax(r,this.service)},this.applyUpdate=function(s,t,r){if(void 0===r&&(r=!1),r||!this.service.isXss()){var i={success:function(t){if(t.success)EVWEB2.util.notifyOnServiceRestart(s,e,3e3,120,10);else{var r=new EVWEB2.ResponseStatus(!1,t.errorText);s(r)}},error:function(){var e=new EVWEB2.ResponseStatus(!1,"An error occurred.");s(e)},url:this.service.url()+EVWEB2.urls.service,type:r?"GET":"POST",data:{auth:t,action:"update",version:this.version}};EVWEB2.ajax(i,this.service)}else{var n=new EVWEB2.ResponseStatus(!1,"This call can not be performed via POST in XSS situations.");s(n)}}},function(){"use strict";EVWEB2.serviceAuthTypes={unknown:"",none:"none",esm:"esm"},EVWEB2.ServiceAuth=function(e,s,t,r,i){this.service=null,this.type=EVWEB2.serviceAuthTypes.unknown,this.info={},this.token="",this.expirationDate=null,void 0!==e&&(this.service=e),void 0!==s&&(this.type=s),void 0!==t&&(this.info=t),void 0!==r&&(this.token=r),void 0!==i&&(this.expirationDate=i);var n=this;if(void 0!==document&&void 0!==document.cookie){var o=document.cookie.split(";");$.each(o,function(e,s){var t=$.trim(s).split("=");"token"===t[0]&&(n.token=t[1])})}this.getType=function(e){var s=this;if(s.type===EVWEB2.serviceAuthTypes.unknown){var t={success:function(t){if(t.success){s.type=t.type,s.info=t.info;var r=new EVWEB2.ResponseStatus(!0);e(r,s.type,s.info)}else{var i=new EVWEB2.ResponseStatus(!1,t.errorText);e(i)}},error:function(){var s=new EVWEB2.ResponseStatus(!1,"An error occurred.");e(s)},url:s.service.url()+EVWEB2.urls.auth,type:"GET",data:{output:"json"}};EVWEB2.ajax(t,s.service)}else{var r=new EVWEB2.ResponseStatus(!0);e(r,s.type,s.info)}},this.authenticate=function(e,s,t){var r=this,i=new Date;if(""!==r.token&&null!==r.expirationDate&&r.expirationDate>i){var n=new EVWEB2.ResponseStatus(!0);e(n,r.token,r.expirationDate)}else{var o={success:function(s){if(s.success){r.token=s.token,r.expirationDate=EVWEB2.util.IETF2Date(s.expiration);var t=new EVWEB2.ResponseStatus(!0);e(t,r.token,r.expirationDate)}else{var i=new EVWEB2.ResponseStatus(!1,s.errorText);e(i)}},error:function(){var s=new EVWEB2.ResponseStatus(!1,"An error occurred.");e(s)},url:r.service.url()+EVWEB2.urls.auth,type:"POST",data:{username:s,password:t}};EVWEB2.ajax(o,r.service)}},this.logout=function(e){var s=this,t={success:function(t){if(t.success){if(s.token="",s.expirationDate=null,s.info={},void 0!==e){var r=new EVWEB2.ResponseStatus(!0);e(r)}}else{var i=new EVWEB2.ResponseStatus(!1,t.errorText);void 0!==e&&e(i)}},error:function(){if(void 0!==e){var s=new EVWEB2.ResponseStatus(!1,"An error occurred.");e(s)}},url:s.service.url()+EVWEB2.urls.authLogout,type:"POST"};EVWEB2.ajax(t,s.service)},this.isAuthenticated=function(){return""!==this.token&&(null===this.expirationDate||this.expirationDate>new Date)}}}(),function(){"use strict";EVWEB2.DiscoveryServer=function(e,s,t,r,i,n){this.address=e,this.port=s,this.name="",this.macAddress="",this.model="",this.serial="",void 0!==t&&(this.name=t),void 0!==r&&(this.macAddress=r),void 0!==i&&(this.model=i),void 0!==n&&(this.serial=n)}}(),function(){"use strict";EVWEB2.serverLicenseTypes={unknown:-3,bad:-2,unlicensed:-1,evaluation:0,licensed:1,trial:2,restricted:3,enterprise:4,enterpriseEx:5},EVWEB2.accessLevelType={unknown:-2,deleteType:-1,none:3,powerUser:4,fullAdmin:5,userAdmin:6,liveOnly:10,searchOnly:11,liveAndSearch:12},EVWEB2.serverManagementFeatures={users:1,failover:2},EVWEB2.userPermissionsLive={base:0,groups:1,maps:2,views:3,quickReplay:4,ptz:5,twoWayAudio:6,eventMonitor:7,saveImage:8,printImage:9,cameras:10,videoPush:11},EVWEB2.userPermissionsSearch={base:12,groups:13,maps:14,views:15,events:16,saveImage:17,printImage:18,burnDisc:19,exportVideo:20,smartSearch:21,cases:22,cameras:23},EVWEB2.userPermissionsConfig={userAdmin:24,viewAdmin:25,caseAdmin:26,userViewAdmin:27},EVWEB2.userPermissionsGroup={groupVideo:28,groupAudio:29,groupSerial:30,groupSoftTrigger:31},EVWEB2.userPermissions={livePermissions:EVWEB2.userPermissionsLive,searchPermissions:EVWEB2.userPermissionsSearch,configPermissions:EVWEB2.userPermissionsConfig,groupPermissions:EVWEB2.userPermissionsGroup},EVWEB2.permissionsBitmask={livePermissions:{base:1,groups:2,maps:4,views:8,quickReplay:16,ptz:32,twoWayAudio:64,eventMonitor:128,saveImage:524288,printImage:1048576,cameras:2097152,videoPush:8388608},searchPermissions:{base:256,groups:512,maps:1024,views:2048,events:4096,saveImage:8192,printImage:16384,burnDisc:32768,exportVideo:65536,smartSearch:131072,cases:262144,cameras:4194304},configPermissions:{userAdmin:1,viewAdmin:2,caseAdmin:4,userViewAdmin:8},groupPermissions:{groupVideo:1,groupAudio:2,groupSerial:4,groupSoftTrigger:8}},EVWEB2.serverLoginError={unknown:0,invalidCredentials:1,restrictedLimitReached:2},EVWEB2.ServerLicenseInfo=function(e,s,t,r,i,n,o,a,u,c){this.isExpired=!0,this.isRestricted=!1,this.isEnterprise=!1,this.expiration=null,this.macAddress="",this.maxAnalogCameras=0,this.maxIpCameras=0,this.maxBoards=0,this.licenseType=EVWEB2.serverLicenseTypes.unknown,this.licenseKey="",void 0!==e&&(this.macAddress=e),void 0!==s&&(this.expiration=s),void 0!==t&&(this.isExpired=t),void 0!==r&&(this.isRestricted=r),void 0!==i&&(this.isEnterprise=i),void 0!==n&&(this.maxAnalogCameras=n),void 0!==o&&(this.maxIpCameras=o),void 0!==a&&(this.maxBoards=a),void 0!==u&&(this.licenseType=u),void 0!==c&&(this.licenseKey=c)},EVWEB2.ServerDetailInfo=function(e,s,t,r,i,n){this.address="",this.port=0,this.modelNo="",this.serialNo="",this.version="",this.daysRecordedVideo=0,void 0!==e&&(this.address=e),void 0!==s&&(this.port=s),void 0!==t&&(this.modelNo=t),void 0!==r&&(this.serialNo=r),void 0!==i&&(this.version=i),void 0!==n&&(this.daysRecordedVideo=n)},EVWEB2.SystemUsageInfo=function(e,s,t,r,i,n){this.username="",this.level=EVWEB2.accessLevelType.unknown,this.address="",this.streams=0,this.audit=!1,this.instanceName="",void 0!==e&&(this.username=e),void 0!==s&&(this.level=s),void 0!==t&&(this.address=t),void 0!==r&&(this.streams=r),void 0!==i&&(this.audit=i),void 0!==n&&(this.instanceName=n)},EVWEB2.SystemPluginInfo=function(e,s,t,r,i){this.name="",this.filename="",this.version="",this.status=!1,this.errorCode=-1,void 0!==e&&(this.name=e),void 0!==s&&(this.filename=s),void 0!==t&&(this.version=t),void 0!==i&&(this.errorCode=i),void 0!==r&&(this.status=r,this.status&&(this.errorCode=0))},EVWEB2.Server=function(e,s,t,r,i,n,o,a,u,c,E,d,v,h){this.service=null,this.name="Unset",this.id="",this.sessionId="",this.loginRequired=!1,this.restricted=!1,this.gmtOffset=0,this.osd=!1,this.username="",this.detailInfo=null,this.licenseInfo=null,this.userGroup=null,this.passthroughGroup=null,this.userPermissions=null,this.passthroughPermissions=null,this.configuration=new EVWEB2.ServerConfig(this),this.canAutoLogin=!1,this.managedFeatures=[];var l=this;if(void 0!==e&&(this.service=e),void 0!==s&&(this.name=s),void 0!==t&&(this.id=t),void 0!==r&&(this.loginRequired=r),void 0!==i&&(this.restricted=i),void 0!==n?this.sessionId=n:this.loginRequired||(this.sessionId=this.id),void 0!==o&&(this.gmtOffset=o),void 0!==a&&(this.osd=a),void 0!==u&&(this.detailInfo=u),void 0!==c&&(this.licenseInfo=c),void 0!==E)if(E instanceof EVWEB2.UserPermissions){this.userPermissions=E;var p=EVWEB2.util.internal.generateGroupPermissions(this.userPermissions);this.userGroup=new EVWEB2.UserGroup("",void 0,p,void 0,"",void 0)}else E instanceof EVWEB2.UserGroup&&(this.userGroup=E,this.userPermissions=EVWEB2.util.internal.generateUserPermissions(this.userGroup.permissions,this.userGroup.accessLevel));if(void 0!==d)if(d instanceof EVWEB2.UserPermissions){this.passthroughPermissions=d;var f=EVWEB2.util.internal.generateGroupPermissions(this.passthroughPermissions);this.passthroughGroup=new EVWEB2.UserGroup("",void 0,f,void 0,"",void 0)}else d instanceof EVWEB2.UserGroup&&(this.passthroughGroup=d,this.passthroughPermissions=EVWEB2.util.internal.generateUserPermissions(this.passthroughGroup.permissions,this.passthroughGroup.accessLevel));void 0!==v&&(this.managedFeatures=v),void 0!==h&&(this.canAutoLogin=h),this.isPassthroughServer=function(){return!this.loginRequired&&this.id===this.sessionId},this.isLoggedIn=function(){return this.id!==this.sessionId&&""!==this.sessionId},this.getCurrentPermissions=function(){return this.isLoggedIn()?this.userPermissions:this.passthroughPermissions};this.getCurrentGroupPermissions=function(){return this.isLoggedIn()?this.userGroup?this.userGroup.permissions:function(e){var s=[];return e.livePermissions&&Object.keys(EVWEB2.userPermissionsLive).forEach(function(t){e.livePermissions[t]&&s.push(EVWEB2.userPermissionsLive[t])}),e.searchPermissions&&Object.keys(EVWEB2.userPermissionsSearch).forEach(function(t){e.searchPermissions[t]&&s.push(EVWEB2.userPermissionsSearch[t])}),e.configPermissions&&Object.keys(EVWEB2.userPermissionsConfig).forEach(function(t){e.configPermissions[t]&&s.push(EVWEB2.userPermissionsConfig[t])}),new EVWEB2.UserGroupPermissions(s)}(this.userPermissions):this.passthroughGroup.permissions},this.getCurrentGroup=function(){return this.isLoggedIn()?this.userGroup:this.passthroughGroup};var m=function(e,s){l.sessionId=e.sessionId,l.username=s,void 0!==e.name&&(l.name=e.name),l.detailInfo=new EVWEB2.ServerDetailInfo(e.address,e.port,e.model,e.serial,e.version,e.daysRecordedVideo);var t,r,i=e.licenseInfo;if(void 0!==i){var n=EVWEB2.util.IETF2Date(i.expirationDate);l.licenseInfo=new EVWEB2.ServerLicenseInfo(i.macAddress,n,i.expired,i.restricted,i.enterprise,i.maxAnalogCameras,i.maxIpCameras,i.maxBoards,i.licenseType,i.licenseKey)}if(void 0!==e.group&&null!==e.group){var o=e.group;t=EVWEB2.util.internal.processUserGroupPermissions(o.permissions),r=new EVWEB2.CustomGroupPermissions(o.cameras,o.audios,o.serials,o.softTriggers),l.userGroup=new EVWEB2.UserGroup(o.name,o.role,t,o.priorities,o.guid,r),l.userPermissions=EVWEB2.util.internal.generateUserPermissions(l.userGroup.permissions,l.userGroup.accessLevel)}else{t=EVWEB2.util.processServerPermissions(e),l.userPermissions=t;var a=EVWEB2.util.internal.generateGroupPermissions(l.userPermissions);l.userGroup=new EVWEB2.UserGroup("",void 0,a,void 0,"",void 0)}};this.login=function(e,s,t,r){var i,n=this;void 0===r&&(r=!1);var o=function(s){var t=new EVWEB2.ResponseStatus(!1,"An error occurred."),r=!1;try{JSON.parse(s.responseText),r=!0}catch(e){r=!1}200!==s.status||r||s.responseText===EVWEB2.errors.login||-1!==s.responseText.search("<body>")?(200===s.status||403===s.status?(t.errorText="Incorrect Username/Password.",t.errorCode=EVWEB2.serverLoginError.invalidCredentials):409===s.status?(t.errorText="Restricted server limit reached.",t.errorCode=EVWEB2.serverLoginError.restrictedLimitReached):500===s.status&&(t.errorText="Internal Server Error."),e(t,n)):i(s.responseText,s)};i=function(t,r){if(t!==EVWEB2.errors.login&&-1===t.search("<body>")){n.sessionId=t,n.username=s;var i=new EVWEB2.ResponseStatus(!0);e(i,n)}else o(r)};var a={success:function(t,r,o){if("string"!=typeof t){if(!t.success){var a=new EVWEB2.ResponseStatus(!1,t.errorText);return a.errorText===EVWEB2.errors.jsonLoginFailed&&(a.errorText="Incorrect Username/Password."),void e(a,n)}void 0===t.address&&void 0===t.name?function(e,s){n.sessionId=e.sessionId,n.username=s}(t,s):m(t,s);var u=new EVWEB2.ResponseStatus(!0);e(u,n,t.token)}else i(t,o)},error:o,url:this.service.url()+EVWEB2.urls.login,type:"POST",dataType:"json",data:{u:s,p:t,l:1,s:this.id,output:"json",responseVersion:2}};r&&(a.data.save="1"),EVWEB2.ajax(a,this.service)},this.loginToken=function(e,s,t){var r=this,i={success:function(t){if(t.success){m(t,s);var i=new EVWEB2.ResponseStatus(!0);e(i,r,t.token)}else{var n=new EVWEB2.ResponseStatus(!1,t.errorText);e(n,r)}},error:function(){var s=new EVWEB2.ResponseStatus(!1,"An error occurred.");e(s,r)},url:this.service.url()+EVWEB2.urls.login,type:"POST",dataType:"json",data:{u:s,token:t,s:this.id}};EVWEB2.ajax(i,r.service)},this.loginStoredCredentials=function(e){var s=this;if(s.canAutoLogin){var t={success:function(t){if(t.success){m(t,"");var r=new EVWEB2.ResponseStatus(!0);e(r,s)}else{var i=new EVWEB2.ResponseStatus(!1,t.errorText);e(i,s)}},error:function(){var t=new EVWEB2.ResponseStatus(!1,"An error occurred.");e(t,s)},url:this.service.url()+EVWEB2.urls.login,type:"POST",dataType:"json",data:{s:this.id,auto_login:!0,output:"json"}};EVWEB2.ajax(t,s.service)}else{var r=new EVWEB2.ResponseStatus(!1,"No stored credentials available.");e(r,s)}},this.logout=function(e){var s=this,t=function(){s.username="",s.sessionId=s.id,null!==s.userPermissions&&(s.userPermissions=null),s.loginRequired&&(null!==s.detailInfo&&(s.detailInfo.version="",s.detailInfo.daysRecordedVideo=0),null!==s.licenseInfo&&(s.licenseInfo=null))},r={success:function(){var s=new EVWEB2.ResponseStatus(!0);t(),"function"==typeof e&&e(s)},error:function(){var s=new EVWEB2.ResponseStatus(!1,"An error occurred.");t(),"function"==typeof e&&e(s)},url:this.service.url()+EVWEB2.urls.logout,data:{s:this.sessionId}};EVWEB2.ajax(r,s.service)};this.getCameras=function(e,s){void 0===s&&(s=!1);var t=function(){var s=new EVWEB2.ResponseStatus(!1,"An error occurred.");e(s)},r=this,i={s:this.sessionId,output:"json",showAll:s?1:0},n={success:function(s){if(s!==EVWEB2.errors.config){if("string"==typeof s)try{s=JSON.parse(s)}catch(e){return void t()}var i=s.Cameras,n=$.map(i,function(e){return function(e,s){var t=0!==e.disabled,r=0===e.state;void 0===e.state&&0===e.disabled&&(r=!0);var i,n=1===e.ptz,o=EVWEB2.ptzTypes.none;return n&&(o=EVWEB2.ptzTypes.standard),void 0===e.id&&(e.id=EVWEB2.util.pidToCameraId(e.p,e.i,e.d,e.ctx)),void 0!==e.resolution&&(i=new EVWEB2.CameraResolution(e.resolution.width,e.resolution.height)),new EVWEB2.Camera(s,e.id,e.ctx,e.name,n,t,r,e.OSD,o,e.digitalPtz,e.formats,i,e.quality,e.frameRate,e.parentId,e.rotation,e.streamFormats)}(e,r)});void 0!==s.timezone&&(r.gmtOffset=s.timezone,r.osd=!0),void 0!==s.restricted&&(r.restricted=s.restricted);var o=new EVWEB2.ResponseStatus(!0);e(o,n,r)}else t()},error:t,url:this.service.url()+EVWEB2.urls.getCameraList,data:i};EVWEB2.ajax(n,r.service)},this.getAudioDevices=function(e){var s=function(){var s=new EVWEB2.ResponseStatus(!1,"An error occurred.");e(s)},t=this,r={s:this.sessionId,output:"json"},i={success:function(r){if(r.success&&r!==EVWEB2.errors.config){var i=r.audio,n=$.map(i,function(e){return new EVWEB2.AudioDevice(t,e.id,e.name,e.enabled,e.input,e.output,e.format,e.frequency)}),o=new EVWEB2.ResponseStatus(!0);e(o,n)}else s()},error:s,url:this.service.url()+EVWEB2.urls.audio,data:r};EVWEB2.ajax(i,t.service)},this.videoExport=function(e,s,t,r,i,n){var o,a=this,u="";for(o=0;o<s.length;o++){var c;if(void 0!==s[o].id)0===u.length?u+="?":u+="&",s[o]instanceof EVWEB2.Camera?c="camera":s[o]instanceof EVWEB2.AudioDevice?c="audio":s[o]instanceof EVWEB2.SerialDevice&&(c="serial"),u+=c+"="+s[o].id}void 0===n&&(n="Export");var E={s:a.sessionId,start:EVWEB2.util.Date2IETF(r),end:EVWEB2.util.Date2IETF(i),name:n,format:t},d={success:function(n){if(n.success){var o=new EVWEB2.ResponseStatus(!0),u=new EVWEB2.VideoExport(a,n.export_id,s,t,r,i,n.filenames);"function"==typeof e&&e(o,u)}else{var c=new EVWEB2.ResponseStatus(!1,n.errorText);e(c)}},error:function(){var s=new EVWEB2.ResponseStatus(!1,"An error occurred.");e(s)},url:a.service.url()+EVWEB2.urls.videoexport+u,data:E};EVWEB2.ajax(d,a.service)},this.requiresResourceKey=function(){return this.isPassthroughServer()&&this.service.csrf},this.getStatus=function(e,s){var t=this,r=function(r){if(r.success){var i=new EVWEB2.ResponseStatus(!0),n=$.map(r.camera,function(e){var t=$.grep(s,function(s){return s instanceof EVWEB2.Camera&&e.id.toString()===s.id.toString()})[0];return new EVWEB2.StatusCameraItem(t,e.status.motion,e.status.loss)}),o=$.map(r.trigger,function(e){var t=$.grep(s,function(s){return s instanceof EVWEB2.Trigger&&e.id.toString()===s.id.toString()})[0];return new EVWEB2.StatusTriggerItem(t,e.status.state)}),a=$.map(r.map,function(e){var t=$.grep(s,function(s){return s instanceof EVWEB2.Map&&e.id.toString()===s.id.toString()})[0];return new EVWEB2.StatusMapItem(t,e.status.motion,e.status.loss)}),u=new EVWEB2.Status(t,n,o,a);e(i,u)}else{var c=new EVWEB2.ResponseStatus(!1,r.errorText);e(c)}};if(0!==s.length){var i=$.map(s,function(e){return e instanceof EVWEB2.Camera?"camera="+e.id.toString():e instanceof EVWEB2.Trigger?"trigger="+e.id.toString():e instanceof EVWEB2.Map?"map="+e.id.toString():void 0}).join("&"),n={s:this.sessionId},o={success:r,error:function(){var s=new EVWEB2.ResponseStatus(!1,"An error occurred.");e(s)},url:this.service.url()+EVWEB2.urls.status+"?"+i,data:n};EVWEB2.ajax(o,this.service)}else{r({success:!0,camera:[],trigger:[],map:[]})}},this.getServerStatus=function(e){this.service.getServersStatus(function(s,t){var r;s.success&&(r=t[0]),e(s,r)},[this])},this.notifyUse=function(e){var s=function(s){void 0!==e&&e(s)};if(this.isLoggedIn()||this.isPassthroughServer()){var t={success:function(e){var t=new EVWEB2.ResponseStatus(e.success,e.errorText);s(t)},error:function(){var e=new EVWEB2.ResponseStatus(!1,"An error occurred.");s(e)},url:this.service.url()+EVWEB2.urls.login,data:{s:this.sessionId,action:"notify"}};EVWEB2.ajax(t,this.service)}else{var r=new EVWEB2.ResponseStatus(!1,"Non-logged in servers do not need notification.");s(r)}},this.checkSession=function(e){if("function"!=typeof e)throw new Error("Callback required");var s={success:function(s){var t=new EVWEB2.ResponseStatus(s.success,s.errorText);e(t,s.isValid)},error:function(){var s=new EVWEB2.ResponseStatus(!1,"An error occurred.");e(s)},url:this.service.url()+EVWEB2.urls.login,data:{s:this.sessionId,action:"verify"}};EVWEB2.ajax(s,this.service)},this.getSystemUsageInfo=function(e){if("function"!=typeof e)throw new Error("Callback required");var s={success:function(s){var t=s.users,r=$.map(t,function(e){return new EVWEB2.SystemUsageInfo(e.username,e.level,e.address,e.streams,e.audit,e.instanceName)}),i=new EVWEB2.ResponseStatus(!0);e(i,r)},error:function(){var s=new EVWEB2.ResponseStatus(!1,"An error occurred.");e(s)},url:this.service.url()+EVWEB2.urls.serverUsers,data:{s:this.sessionId}};EVWEB2.ajax(s,this.service)},this.getSystemPluginInfo=function(e){if("function"!=typeof e)throw new Error("Callback required");var s={success:function(s){var t=s.plugins,r=$.map(t,function(e){return new EVWEB2.SystemPluginInfo(e.name,e.filename,e.version,e.isOpen,e.openCode)}),i=new EVWEB2.ResponseStatus(!0);e(i,r)},error:function(){var s=new EVWEB2.ResponseStatus(!1,"An error occurred.");e(s)},url:this.service.url()+EVWEB2.urls.serverPlugins,data:{s:this.sessionId}};EVWEB2.ajax(s,this.service)},this.getSystemInformation=function(e){var s=this;if("function"!=typeof e)throw new Error("Callback required");var t={success:function(t){var r=t.utf8Enabled,i=t.systemName,n=new EVWEB2.SystemHardwareInfo(t.serialNumber,t.modelNumber,t.motherboard,t.bios,t.processor,t.totalMemory,t.os,t.runningSince),o=new EVWEB2.SystemConfig(s,i,n,r),a=new EVWEB2.ResponseStatus(!0);e(a,o)},error:function(){var s=new EVWEB2.ResponseStatus(!1,"An error occurred.");e(s)},url:this.service.url()+EVWEB2.urls.systemInfo,data:{s:this.sessionId}};EVWEB2.ajax(t,this.service)},this.getUserGroups=function(e){var s=this;if("function"!=typeof e)throw new Error("Callback required");var t={success:function(t){if(t.success){var r=t.groups,i=$.map(r,function(e){var s=e.role,t=EVWEB2.util.internal.processUserGroupPermissions(e.permissions),r=$.map(e.priorities,function(e){return new EVWEB2.UserGroupPriority(e.priority,e.value)}),i=new EVWEB2.CustomGroupPermissions(e.cameras,e.audios,e.serials,e.softTriggers);return new EVWEB2.UserGroup(e.name,s,t,r,e.guid,i,e.managed)}),n=new EVWEB2.ResponseStatus(!0);e(n,i,s)}else{var o=new EVWEB2.ResponseStatus(!1,t.errorText);e(o)}},error:function(){var s=new EVWEB2.ResponseStatus(!1,"An error occurred.");e(s)},url:this.service.url()+EVWEB2.urls.userGroups,data:{s:this.sessionId}};EVWEB2.ajax(t,this.service)},this.getUsers=function(e){var s=this;if("function"!=typeof e)throw new Error("Callback required");var t={success:function(t){if(t.success){var r=t.users,i=$.map(r,function(e){return new EVWEB2.User(s,e.name,e.groupName,e.accountType,e.isOrphaned,e.managed)}),n=new EVWEB2.ResponseStatus(!0);e(n,i,s)}else{var o=new EVWEB2.ResponseStatus(!1,t.errorText);e(o)}},error:function(){var s=new EVWEB2.ResponseStatus(!1,"An error occurred.");e(s)},url:this.service.url()+EVWEB2.urls.users,data:{s:this.sessionId}};EVWEB2.ajax(t,this.service)},this.addUser=function(e,s,t,r){if("function"!=typeof e)throw new Error("Callback required");var i=EVWEB2.util.internal.generatePermissionsBitmask(s.permissions),n={s:this.sessionId,name:t.username,password:r,role:s.accessLevel,accountType:t.accountType,guid:s.guid,grpName:s.name,grpGroupPermission:i.group,grpUserPermission:i.user,grpAdminPermission:i.admin,grpCameras:s.customGroupPermissions.cameras.join(","),grpAudios:s.customGroupPermissions.audios.join(","),grpSerials:s.customGroupPermissions.serials.join(","),grpSoftTriggers:s.customGroupPermissions.softTriggers.join(",")},o=s.getPriority(EVWEB2.groupPriorityTypes.ptz);void 0!==o&&(n.grpPtzPriority=o.value),void 0!==(o=s.getPriority(EVWEB2.groupPriorityTypes.twoWayAudio))&&(n.grpAudioPriority=o.value),void 0!==(o=s.getPriority(EVWEB2.groupPriorityTypes.client))&&(n.grpRemotePriority=o.value);var a={success:function(i){if(i.success){var n=new EVWEB2.ResponseStatus(!0);e(n,t,s,r)}else{var o=new EVWEB2.ResponseStatus(!1,i.errorText);e(o)}},error:function(){var s=new EVWEB2.ResponseStatus(!1,"An error occurred.");e(s)},url:this.service.url()+EVWEB2.urls.users,type:"POST",data:n};EVWEB2.ajax(a,this.service)},this.getSecurityIntegrationsDevices=function(e){var s=this,t={success:function(t){if(t.success){var r=new EVWEB2.ResponseStatus(!0),i=$.map(t.devices,function(e){return new EVWEB2.SecurityIntegrationsDevice(s,e.id,e.name,e.host,e.port,e.type,e.enabled,e.connectionStatus,e.firmware,e.serial,e.user,e.auth)});e(r,i)}else{var n=new EVWEB2.ResponseStatus(!1,t.errorText);e(n)}},error:function(){var s=new EVWEB2.ResponseStatus(!1,"An error occurred.");e(s)},url:s.service.url()+EVWEB2.urls.securityIntegrationDevices,data:{s:s.sessionId}};s.service.isXss()&&EVWEB2.util.updateRequestForXss(t),$.ajax(t)},this.getSerialInfo=function(e){var s=this,t={success:function(t){if(t.success){var r=new EVWEB2.ResponseStatus(!0),i=t.serial.supports,n=new EVWEB2.ServerSerialFunctionality(i.advancedLineEnding,i.sotMarkers,i.xmlFormatting,i.replace,i.rules),o=new EVWEB2.ServerSerialSupport(s,n,t.serial.uart,t.serial.ip,t.serial.uses,t.serial.ipTypes);e(r,o)}else{var a=new EVWEB2.ResponseStatus(!1,t.errorText);e(a)}},error:function(){var s=new EVWEB2.ResponseStatus(!1,"An error occurred.");e(s)},url:s.service.url()+EVWEB2.urls.serverSerialInfo,data:{s:s.sessionId}};s.service.isXss()&&EVWEB2.util.updateRequestForXss(t),$.ajax(t)},this.getSerialDevices=function(e){var s=this,t=function(e,t){return $.map(e,function(e){var r;t===EVWEB2.SerialDeviceTypes.Uart?r=new EVWEB2.UartSerialDeviceConnectionInfo(e.port,e.baudRate,e.dataBits,e.stopBits,e.parity,e.flowControl):t===EVWEB2.SerialDeviceTypes.Ip&&(r=new EVWEB2.IpSerialDeviceConnectionInfo(e.address,e.type,e.ipPort,e.remotePort));var i=new EVWEB2.SerialDeviceLineInfo(e.maxLineLength,e.lineEnding,e.timeout);return new EVWEB2.SerialDevice(s,e.id,e.name,r,i,e.use,t,e.profile)})},r={success:function(s){if(s.success){var r=new EVWEB2.ResponseStatus(!0),i=t(s.uart,EVWEB2.SerialDeviceTypes.Uart);i=i.concat(t(s.ip,EVWEB2.SerialDeviceTypes.Ip)),e(r,i)}else{var n=new EVWEB2.ResponseStatus(!1,s.errorText);e(n)}},error:function(){var s=new EVWEB2.ResponseStatus(!1,"An error occurred.");e(s)},url:s.service.url()+EVWEB2.urls.serialDevices,data:{s:s.sessionId}};s.service.isXss()&&EVWEB2.util.updateRequestForXss(r),$.ajax(r)},this.getSerialProfiles=function(e){var s=this,t={success:function(t){if(t.success){var r=new EVWEB2.ResponseStatus(!0),i=$.map(t.profiles,function(e){var t=e.display,r=new EVWEB2.FontInfo(t.fontName,t.fontSize,t.fontStyle,t.fontColor,t.fontFamily,t.fontWeight,t.underline),i=e.caseSensitivity,n=new EVWEB2.SerialCaseSensitivity(i.transmissionMarkers,i.keywords,i.masks,i.replacements,i.rules),o=e.markers,a=new EVWEB2.SerialProfileMarkers(o.type,o.start,o.end);return new EVWEB2.SerialProfile(s,e.id,e.name,r,n,a,e.retention)});e(r,i)}else{var n=new EVWEB2.ResponseStatus(!1,t.errorText);e(n)}},error:function(){var s=new EVWEB2.ResponseStatus(!1,"An error occurred.");e(s)},url:s.service.url()+EVWEB2.urls.serialProfiles,data:{s:s.sessionId}};s.service.isXss()&&EVWEB2.util.updateRequestForXss(t),$.ajax(t)},this.getEvents=function(e,s){var t=this,r={s:t.sessionId};void 0!==s&&(r.filter=s);var i={success:function(s){if(s.success){var r=new EVWEB2.ResponseStatus(!0),i=$.map(s.events,function(e){var s;return void 0!==e.extra&&(s=new EVWEB2.EventExtraInfo(t,e.extra.item,e.extra.type)),new EVWEB2.Event(t,e.event,EVWEB2.util.IETF2Date(e.time),e.device,s)});e(r,i)}else{var n=new EVWEB2.ResponseStatus(!1,s.errorText);e(n)}},error:function(){var s=new EVWEB2.ResponseStatus(!1,"An error occurred.");e(s)},url:t.service.url()+EVWEB2.urls.events,data:r,traditional:!0};t.service.isXss()&&EVWEB2.util.updateRequestForXss(i),$.ajax(i)},this.getAnalyticRules=function(e){var s=this;EVWEB2.ajax({method:"GET",url:this.service.url()+EVWEB2.urls.analyticRules,data:{s:this.sessionId},success:function(t){if(t.success){var r=t.rules.map(function(e){var t,r,i=new EVWEB2.AnalyticRuleOSDConfig(EVWEB2.util.RGBA(e.osdInfo.bgColor,e.osdInfo.bgOpacity),EVWEB2.util.RGBA(e.osdInfo.borderColor,e.osdInfo.borderOpacity));return e.metadataTemplates&&(t=e.metadataTemplates.map(function(e){return new EVWEB2.EventMetadataTemplate(e.key,e.valueType)})),e.sourceType===EVWEB2.analyticRuleSourceType.camera?r=new EVWEB2.AssociatedCameraSource(e.sourceId.id):e.sourceType===EVWEB2.analyticRuleSourceType.audio&&(r=new EVWEB2.AssociatedAudioSource(e.sourceId.id)),new EVWEB2.AnalyticRule(s,e.ruleId,e.deviceId,r,e.name,i,e.metadataEnabled,t)});e(new EVWEB2.ResponseStatus(!0),r)}else e(new EVWEB2.ResponseStatus(!1,t.errorText))},error:function(s){e(new EVWEB2.ResponseStatus(!1,EVWEB2.util.getErrorText(s)))}},this.service)}}}(),EVWEB2.triggerState={off:0,on:1,unknown:-1},EVWEB2.Trigger=function(e,s,t,r){this.server=null,this.id="",this.name="Unnamed Trigger",this.state=EVWEB2.triggerState.unknown;var i=-1,n=this;void 0!==e&&(this.server=e),void 0!==s&&(this.id=s),void 0!==t&&(this.name=t),void 0!==r&&(this.state=r);var o=function(){n.toggle(EVWEB2.triggerState.on)};this.toggle=function(e){void 0===e?this.state===EVWEB2.triggerState.off?this.state=EVWEB2.triggerState.on:this.state=EVWEB2.triggerState.off:this.state=e,this.state===EVWEB2.triggerState.off?(clearInterval(i),i=-1):-1===i&&(i=setInterval(o,EVWEB2.config.triggerPollingRate));var s={s:this.server.sessionId,tid:this.id,state:this.state===EVWEB2.triggerState.off?"off":"on"};if(this.server.requiresResourceKey()){if(""===this.server.service.resourceKey)throw clearInterval(i),new Error("CSRF enforced, passthrough will not work.");s.key=this.server.service.resourceKey}var t={url:this.server.service.url()+EVWEB2.urls.trigger,type:"POST",dataType:"text",data:s};return EVWEB2.ajax(t,this.server.service,!0),this.state}},EVWEB2.getTriggers=function(e,s){var t=function(){var s=new EVWEB2.ResponseStatus(!1,"An error occurred.");e(s)},r={success:function(r){if(r!==EVWEB2.errors.triggers){var i=r.Triggers,n=$.map(i,function(e){return new EVWEB2.Trigger(s,e.id,e.name,e.state)}),o=new EVWEB2.ResponseStatus(!0);e(o,n,s)}else t()},error:t,url:s.service.url()+EVWEB2.urls.trigger,data:{s:s.sessionId}};EVWEB2.ajax(r,s.service)},function(){"use strict";EVWEB2.ViewSlotItemTypes={none:0,camera:1,audio:2,serial:3,group:4,softTrigger:5,ioTrigger:6,timeTrigger:7},EVWEB2.ViewFolder=function(e,s,t){this.id="",this.name="",this.parentId="",void 0!==e&&(this.id=e),void 0!==s&&(this.name=s),void 0!==t&&(this.parentId=t)},EVWEB2.ViewSlotItem=function(e,s,t,r,i){this.id="",this.server="",this.serverInstance=null,this.type=null,this.slotIndex=0,this.digitalPtzType=null,void 0!==e&&(this.id=e),void 0!==s&&(this.server=s.id,this.serverInstance=s),void 0!==t&&(this.type=t),void 0!==r&&(this.slotIndex=r),void 0!==i&&(this.digitalPtzType=i)},EVWEB2.ViewCameraInfo=function(e,s,t){this.camera="",this.server="",this.serverInstance=null,this.digitalPtzType=null,void 0!==e&&(this.camera=e),void 0!==s&&(this.server=s.id,this.serverInstance=s),void 0!==t&&(this.digitalPtzType=t)},EVWEB2.ViewAudioInputInfo=function(e,s){this.id="",this.server="",this.serverInstance=null,void 0!==e&&(this.id=e),void 0!==s&&(this.server=s.id,this.serverInstance=s)},EVWEB2.View=function(e,s,t,r,i,n,o,a,u){if(this.id="",this.name="Unnamed",this.folder=null,this.items=[],this.cameras=[],this.layout=-1,this.layoutInfo=null,this.order=-1,this.audioInput=null,this.description="",void 0!==u&&(this.id=u),void 0!==e&&(this.name=e),void 0!==s&&(this.folder=s),void 0!==r&&(this.layout=r),void 0!==i&&(this.layoutInfo=i),void 0!==t)if($.grep(t,function(e){return e instanceof EVWEB2.ViewCameraInfo}).length>0)this.items=$.map(t,function(e,s){if(null!==e)return new EVWEB2.ViewSlotItem(e.camera,e.serverInstance,EVWEB2.Camera,s,e.digitalPtzType)}),this.cameras=t;else{this.items=t,this.cameras=[];var c,E=$.grep(this.items,function(e){return e.type===EVWEB2.Camera}),d=E.length;for(-1!==this.layout&&(d=this.layout),c=0;c<d;c++)this.cameras[c]=null;var v=this;$.each(E,function(e,s){v.cameras[s.slotIndex]=new EVWEB2.ViewCameraInfo(parseInt(s.id,10),s.serverInstance,s.digitalPtzType)});var h=$.grep(this.items,function(e){return e.type===EVWEB2.AudioDevice})[0];void 0!==h&&(this.audioInput=new EVWEB2.ViewAudioInputInfo(h.id,h.serverInstance))}(void 0!==n&&(this.order=n),void 0!==o)&&(this.audioInput=o,void 0===$.grep(this.items,function(e){return e.type===EVWEB2.AudioDevice})[0]&&this.items.push(new EVWEB2.ViewSlotItem(o.id,o.serverInstance,EVWEB2.AudioDevice,0)));void 0!==a&&(this.description=a),this.applyDigitalPtzSettingsForSlot=function(e,s,t){var r,i=this.cameras[s];if(void 0===i||null===i||null===i.digitalPtzType?r="This view slot does not support digital PTZ.":t.ptzType!==EVWEB2.ptzTypes.digital?r="The provided camera is not a digital PTZ camera.":t.sourceCamera.id!==i.camera?r="The provided digital PTZ camera is not derived from the camera for this slot.":t.digitalPtzType!==i.digitalPtzType&&(r="The provided digital PTZ camera is not the correct type for this slot."),void 0===r){var n={success:function(s){var r=new EVWEB2.ResponseStatus(s.success,s.errorText);e(r,t)},error:function(){var s=new EVWEB2.ResponseStatus(!1,"An error occurred.");e(s)},url:i.serverInstance.service.url()+EVWEB2.urls.digitalPtz,data:{s:i.serverInstance.sessionId,ptz:t.id,folder:this.folder.name,slot:s}};this.id?n.data.viewid=this.id:n.data.view=this.name,EVWEB2.ajax(n,i.serverInstance.service)}else{var o=new EVWEB2.ResponseStatus(!1,r);e(o)}}},EVWEB2.getViews=function(e,s){($.isArray(s)||(s=[s]),0===s.length)&&e(new EVWEB2.ResponseStatus(!1,"No servers defined"));s[0].service.getViews(e,s)}}(),function(){EVWEB2.metadataFlags={freeRun:"freeRun",alarm:"alarm",motion:"motion"};EVWEB2.MetadataItem=function(e,s,t){this.start=new Date,this.end=new Date,this.flags=[],this.activeFlag="",void 0!==e&&(this.start=e),void 0!==s&&(this.end=s),void 0!==t&&("number"==typeof t?(0===t&&this.flags.push(EVWEB2.metadataFlags.freeRun),64==(64&t)&&this.flags.push(EVWEB2.metadataFlags.alarm),128==(128&t)&&this.flags.push(EVWEB2.metadataFlags.motion)):this.flags=t,-1!==$.inArray(EVWEB2.metadataFlags.alarm,this.flags)?this.activeFlag=EVWEB2.metadataFlags.alarm:-1!==$.inArray(EVWEB2.metadataFlags.motion,this.flags)?this.activeFlag=EVWEB2.metadataFlags.motion:-1!==$.inArray(EVWEB2.metadataFlags.freeRun,this.flags)&&(this.activeFlag=EVWEB2.metadataFlags.freeRun))},EVWEB2.MetadataInformation=function(e,s,t,r){this.instance=null,this.metadata=[],this.start=new Date,this.end=new Date,void 0!==e&&(this.instance=e),void 0!==s&&(this.metadata=s),void 0!==t&&(this.start=t),void 0!==r&&(this.end=r)},EVWEB2.Metadata=function(e,s,t,r,i){this.server=null,this.sessionId="",this.cameras=[],this.audioInputs=[],this.start=new Date,this.end=new Date,void 0!==e&&(this.cameras=e,e.length>0&&(this.server=e[0].instance.server)),void 0!==s&&(this.audioInputs=s,s.length>0&&(this.server=s[0].instance.server)),void 0!==t&&(this.start=t),void 0!==r&&(this.end=r),void 0!==i&&(this.sessionId=i),this.getFrameAtTime=function(e,s,t,r,i){if(""===this.sessionId||!e.supportsGetFrame())return"";var n=this.server.service.url()+EVWEB2.urls.metadata,o=["s="+this.sessionId,"action=frame","time="+EVWEB2.util.Date2IETF(s)],a=!1;if(e.ptzType===EVWEB2.ptzTypes.digital)o.push("camera="+e.sourceCamera.id),o.push("session="+e.server.sessionId),o.push("digitalptz="+e.id);else{o.push("camera="+e.id);var u=this.server.service.jpegForwarding;u.enabled&&-1!==$.inArray(EVWEB2.cameraFormats.jpeg,e.formats)&&(a=e.quality*(u.qualityThreshold/100)<i&&(e.resolution.width*(u.sizeThreshold/100)<t||e.resolution.height*(u.sizeThreshold/100)<r))}var c=EVWEB2.cameraFormats.transcodedJpeg;return(a||-1===$.inArray(EVWEB2.cameraFormats.transcodedJpeg,e.formats))&&(c=EVWEB2.cameraFormats.jpeg),c!==EVWEB2.cameraFormats.jpeg&&(o.push("w="+t),o.push("h="+r),o.push("q="+i)),o.push("format="+c),n+="?"+o.join(";")+";",n+=(new Date).getTime()},this.notifyUse=function(e){""!==this.sessionId?new EVWEB2.Server(this.server.service,"",this.server.id,!0,!1,this.sessionId).notifyUse(e):"function"==typeof e&&e(new EVWEB2.ResponseStatus(!1,"Metadata instance is not avaialble."))},this.logout=function(e){if(""!==this.sessionId){var s={success:function(){var s=new EVWEB2.ResponseStatus(!0);"function"==typeof e&&e(s)},error:function(){var s=new EVWEB2.ResponseStatus(!1,"An error occurred.");"function"==typeof e&&e(s)},url:this.server.service.url()+EVWEB2.urls.logout,data:{s:this.sessionId}};EVWEB2.ajax(s,this.server.service)}else if("function"==typeof e){var t=new EVWEB2.ResponseStatus(!1,"Metadata instance is not avaialble.");e(t)}}},EVWEB2.getMetadata=function(e,s,t,r){var i,n=$.grep(s,function(e){return e instanceof EVWEB2.Camera}),o=$.grep(s,function(e){return e instanceof EVWEB2.AudioDevice}),a=function(s){var t=new EVWEB2.ResponseStatus(!1,"An error occurred.");408!==s.status&&504!==s.status||(t.errorText="A timeout has occurred requesting metadata."),403===s.status&&(t.errorText="No permission to search."),e(t)},u=function(e){var s=EVWEB2.util.IETF2Date(e.start),t=EVWEB2.util.IETF2Date(e.end);return new EVWEB2.MetadataItem(s,t,e.flags)},c=function(e){return $.map(e,function(e,s){var t=$.map(e.metadata,u),r=$.grep(n,function(e){return e.id.toString()===s})[0];return new EVWEB2.MetadataInformation(r,t,e.start,e.end)})},E=function(s){s===EVWEB2.errors.servers&&a();var i=c(s),n=new EVWEB2.Metadata(i,void 0,t,r),o=new EVWEB2.ResponseStatus(!0);e(o,n)},d=function(s){s===EVWEB2.errors.servers&&a();var i=c(s.cameras),n=function(e){return $.map(e,function(e,s){var t=$.map(e.metadata,u),r=$.grep(o,function(e){return e.id.toString()===s})[0];return new EVWEB2.MetadataInformation(r,t,e.start,e.end)})}(s.audio),E=new EVWEB2.Metadata(i,n,t,r,s.sessionId),d=new EVWEB2.ResponseStatus(!0);e(d,E)};if(n.length>0)i=n[0].server;else{if(!(o.length>0)){var v=new EVWEB2.ResponseStatus(!1,"No items to search.");return void e(v)}i=o[0].server}i.service.version(function(e,s){var u=!1;if(e.success)if("0.0.0.0"===s)u=!0;else{var c=s.split("."),v=0,h=0;c.length>2&&(v=parseInt(c[0],10),h=parseInt(c[1],10)),u=v>2||2===v&&h>10}var l,p=i.service.url()+EVWEB2.urls.metadata+"?s="+i.sessionId;for(u&&(p+=";responseVersion=2"),l=0;l<n.length;l++)void 0!==n[l].id&&(p+=";camera="+n[l].id);for(l=0;l<o.length;l++)void 0!==o[l].id&&(p+=";audio="+o[l].id);p+=";start="+EVWEB2.util.Date2IETF(t)+";end="+EVWEB2.util.Date2IETF(r);var f={success:E,error:a,url:p,dataType:"json"};u&&(f.success=d),EVWEB2.ajax(f,i.service)})},EVWEB2.metadata=function(e,s,t,r){EVWEB2.getMetadata(function(s,t){var r={};$.each(t.cameras,function(e,s){var t={start:s.start,end:s.end,metadata:{}};$.each(s.metadata,function(e,s){var r,i=0;for(r=0;r<s.flags.length;r++)s.flags[r]===EVWEB2.metadataFlags.freeRun?i|=0:s.flags[r]===EVWEB2.metadataFlags.motion?i|=128:s.flags[r]===EVWEB2.metadataFlags.alarm&&(i|=64);t.metadata[e]={start:EVWEB2.util.Date2IETF(s.start),end:EVWEB2.util.Date2IETF(s.end),flags:i}}),r[s.instance.id]=t}),e(s,r)},s,t,r)}}(),EVWEB2.SearchAudioClipInfo=function(e,s,t,r,i,n){this.start=new Date,this.end=new Date,this.nativeFormat=EVWEB2.audioDeviceNativeFormatTypes.none,this.frequency=0,this.frames=0,this.samplesPerFrame=0,void 0!==e&&(this.start=e),void 0!==s&&(this.end=s),void 0!==t&&(this.nativeFormat=t),void 0!==r&&(this.frequency=r),void 0!==i&&(this.frames=i),void 0!==n&&(this.samplesPerFrame=n)},EVWEB2.SearchAudioInfo=function(e,s,t){this.audioInput=null,this.audioClipsInformation=[],this.frames=0,void 0!==e&&(this.audioInput=e),void 0!==s&&(this.audioClipsInformation=s),void 0!==t&&(this.frames=t)},EVWEB2.SearchVideoClipInfo=function(e,s){this.start=e||null,this.end=s||null},EVWEB2.SearchVideoInfo=function(e,s){this.camera=e||null,this.clips=s||[]},EVWEB2.SearchStatusType={unknown:0,notStarted:1,started:2,complete:3,errorSpace:4,errorUnknown:5},EVWEB2.SearchStatus=function(e,s,t){this.status=e,this.frames=s,this.totalFrames=t},EVWEB2.SearchFrameCounts=function(e,s){this.video=e,this.audio=s},EVWEB2.Search=function(e,s,t,r,i,n,o){this.searchId="",this.cameras=[],this.audioInputs=[],this.serialDevices=[],this.server=null,this.start=new Date,this.end=new Date,this.frames=0,this.frameInfo=null,this.audioInformation=[],this.videoInformation=[],void 0!==e&&(this.searchId=e),void 0!==s&&(this.cameras=$.grep(s,function(e){return e instanceof EVWEB2.Camera}),this.audioInputs=$.grep(s,function(e){return e instanceof EVWEB2.AudioDevice}),this.serialDevices=$.grep(s,function(e){return e instanceof EVWEB2.SerialDevice}),s.length>0&&(this.server=s[0].server)),void 0!==t&&(this.start=t),void 0!==r&&(this.end=r),void 0!==i&&(i instanceof EVWEB2.SearchFrameCounts?(this.frames=i.video+i.audio,this.frameInfo=i):(this.frames=i,this.frameInfo=new EVWEB2.SearchFrameCounts(i,0))),void 0!==n&&(this.audioInformation=n),void 0!==o&&(this.videoInformation=o),this.setSpeed=function(e,s){var t={success:function(s){var t=parseInt(s,10),r=new EVWEB2.ResponseStatus(!0);e(r,t)},error:function(){var s=new EVWEB2.ResponseStatus(!1,"An error occurred.");e(s)},url:this.server.service.url()+EVWEB2.urls.speed+"/"+s,dataType:"text",data:{search_id:this.searchId}};EVWEB2.ajax(t,this.server.service)},this.playing=function(e){var s={success:function(s){var t=parseInt(s,10),r=new EVWEB2.ResponseStatus(!0),i=!0;-1!==t&&0!==t||(i=!1),e(r,i)},error:function(){var s=new EVWEB2.ResponseStatus(!1,"An error occurred.");e(s)},url:this.server.service.url()+EVWEB2.urls.speed,dataType:"text",data:{search_id:this.searchId}};EVWEB2.ajax(s,this.server.service)},this.step=function(e,s){var t={success:function(s){var t;t="string"==typeof s?parseInt(s,10):parseInt(s.frame,10);var r=new EVWEB2.ResponseStatus(!0);e(r,t)},error:function(){var s=new EVWEB2.ResponseStatus(!1,"An error occurred.");e(s)},url:this.server.service.url()+EVWEB2.urls.step+"/",data:{search_id:this.searchId,output:"json"}};void 0!==s&&(t.url+=s.toString()),EVWEB2.ajax(t,this.server.service)},this.getTime=function(e){var s={success:function(s,t,r){var i;try{i=(s=JSON.parse(s)).timeWithMs||s.time}catch(e){i=s}var n=r.getResponseHeader("X-Duration"),o=r.getResponseHeader("X-Server-Time"),a=null!==n?parseInt(n,10):0,u=null!==o?Math.abs(Date.now()-Date.parse(o)):0,c=EVWEB2.util.IETF2Date(i),E=new EVWEB2.ResponseStatus(!0);e(E,c,a,u)},error:function(){var s=new EVWEB2.ResponseStatus(!1,"An error occurred.");e(s)},url:this.server.service.url()+EVWEB2.urls.time,dataType:"text",data:{search_id:this.searchId,output:"json"}};EVWEB2.ajax(s,this.server.service)},this.logout=function(e){var s=this.server,t={success:function(){var s=new EVWEB2.ResponseStatus(!0);"function"==typeof e&&e(s)},error:function(){var s=new EVWEB2.ResponseStatus(!1,"An error occurred.");"function"==typeof e&&e(s)},url:s.service.url()+EVWEB2.urls.logout,data:{s:this.searchId}};EVWEB2.ajax(t,s.service)},this.notifyUse=function(e){new EVWEB2.Server(this.server.service,"",this.server.id,!0,!1,this.searchId).notifyUse(e)},this.getStatus=function(e){var s={success:function(s){if(s.success){var t=new EVWEB2.SearchStatus(s.status.status,s.status.frames.retrieved,s.status.frames.total),r=new EVWEB2.ResponseStatus(!0);e(r,t)}else{var i=new EVWEB2.ResponseStatus(!1,s.errorText);e(i)}},error:function(){var s=new EVWEB2.ResponseStatus(!1,"An error occurred.");e(s)},url:this.server.service.url()+EVWEB2.urls.searchStatus,data:{s:this.searchId}};EVWEB2.ajax(s,this.server.service)},this.getFrame=function(e,s,t,r,i,n){if(!e.supportsGetFrame())return"";var o=this.server.service.url()+EVWEB2.urls.searchVideo,a=["s="+this.server.sessionId,"search_id="+this.searchId,"camera="+e.id,"time="+EVWEB2.util.Date2IETF(s,!0),"stream="+function(e){return void 0===e&&(null===EVWEB2.config.defaultStreamId&&(EVWEB2.config.defaultStreamId=EVWEB2.util.generateStreamId()),e=EVWEB2.config.defaultStreamId),e}(n)],u=!1,c=this.server.service.jpegForwarding;c.enabled&&-1!==$.inArray(EVWEB2.cameraFormats.jpeg,e.formats)&&(u=e.quality*(c.qualityThreshold/100)<i&&(e.resolution.width*(c.sizeThreshold/100)<t||e.resolution.height*(c.sizeThreshold/100)<r));var E=EVWEB2.cameraFormats.transcodedJpeg;return(u||-1===$.inArray(EVWEB2.cameraFormats.transcodedJpeg,e.formats))&&(E=EVWEB2.cameraFormats.jpeg),E!==EVWEB2.cameraFormats.jpeg&&(a.push("w="+t),a.push("h="+r),a.push("q="+i)),a.push("format="+E),o+="?"+a.join(";")+";",o+=(new Date).getTime()}},EVWEB2.getSearch=function(e,s,t,r,i){var n,o=function(s,t){if(200!==s.status||"parsererror"!==t){var r=new EVWEB2.ResponseStatus(!1,"An error occurred.");408===s.status&&(r.errorText="A timeout has occurred requesting the search."),e(r)}else n(s.responseText)};if(n=function(t,r,i){if(t===EVWEB2.errors.search&&o(i),"string"==typeof t){var n=t;t={};var a,u=n.split("&");for(a=0;a<u.length;a++){var c=u[a].split("=");2===c.length&&("frames"===c[0]?t.frames=parseInt(c[1],10):"start"===c[0]?t.start_time=decodeURIComponent(c[1]):"end"===c[0]?t.end_time=decodeURIComponent(c[1]):"search_id"===c[0]&&(t.search_id=c[1]))}}var E,d,v;void 0!==t.start_time&&(E=EVWEB2.util.IETF2Date(t.start_time)),void 0!==t.end_time&&(d=EVWEB2.util.IETF2Date(t.end_time)),void 0!==t.audioInfo&&(v=$.map(t.audioInfo,function(e){var t=$.map(e.audioClips,function(e){var s=EVWEB2.util.IETF2Date(e.startTime),t=EVWEB2.util.IETF2Date(e.endTime);return new EVWEB2.SearchAudioClipInfo(s,t,e.format,e.frequency,e.frames,e.samplesPerFrame)}),r=$.grep(s,function(s){return s.id===e.deviceId})[0];return new EVWEB2.SearchAudioInfo(r,t,e.frames)}));var h,l=t.frames;void 0!==t.frameCounts&&(l=new EVWEB2.SearchFrameCounts(t.frameCounts.video,t.frameCounts.audio)),t.videoInfo&&(h=$.map(t.videoInfo,function(e){var t=$.map(e.clips,function(e){return new EVWEB2.SearchVideoClipInfo(EVWEB2.util.IETF2Date(e.startTime),EVWEB2.util.IETF2Date(e.endTime))}),r=$.grep(s,function(s){return s.id.toString()===e.deviceId})[0];return new EVWEB2.SearchVideoInfo(r,t)}));var p=new EVWEB2.Search(t.search_id,s,E,d,l,v,h),f=new EVWEB2.ResponseStatus(!0);e(f,p)},void 0===i&&(i=!1),0!==s.length){var a,u=$.grep(s,function(e){return e instanceof EVWEB2.Camera}),c=$.grep(s,function(e){return e instanceof EVWEB2.AudioDevice}),E=$.grep(s,function(e){return e instanceof EVWEB2.SerialDevice}),d=s[0].server,v=d.service.url()+EVWEB2.urls.search+"?s="+d.sessionId;for(a=0;a<u.length;a++)void 0!==u[a].id&&(v+="&camera="+u[a].id);for(a=0;a<c.length;a++)void 0!==c[a].id&&(v+="&audio="+c[a].id);for(a=0;a<E.length;a++)void 0!==E[a].id&&(v+="&serial="+E[a].id);if(v+="&start="+EVWEB2.util.Date2IETF(t)+"&end="+EVWEB2.util.Date2IETF(r)+"&output=json",i&&(v+="&start_paused=1"),d.requiresResourceKey()){if(""===d.service.resourceKey)throw new Error("CSRF enforced, passthrough will not work.");v+="&key="+d.service.resourceKey}var h={success:n,error:o,url:v,dataType:"json"};EVWEB2.ajax(h,d.service)}else{var l=new EVWEB2.ResponseStatus(!1,"No search inputs provided.");e(l)}},EVWEB2.LayoutSlot=function(e,s,t,r){this.top=0,this.left=0,this.width=0,this.height=0,void 0!==e&&(this.top=e),void 0!==s&&(this.left=s),void 0!==t&&(this.width=t),void 0!==r&&(this.height=r)},EVWEB2.Layout=function(e,s,t,r,i,n,o){this.name="Unnamed",this.width=0,this.height=0,this.length=0,this.slots=[],this.aspectRatio=4/3,this.ws=!1,void 0!==e&&(this.name=e),void 0!==s&&(this.width=s),void 0!==t&&(this.height=t),void 0!==r&&(this.length=r),void 0!==i&&(this.slots=i),void 0!==n&&(this.aspectRatio=n),void 0!==o&&(this.ws=o)},function(){"use strict";EVWEB2.audioInputStreamFormatTypes={raw:"raw",native:"native"},EVWEB2.audioOutputStreamFormatTypes={raw:"raw",native:"native"},EVWEB2.audioDeviceNativeFormatTypes={none:-1,pcm:0,adpcm:1,mp2:2,mp3:3,aac:4,g726:5},EVWEB2.AudioDevice=function(e,s,t,r,i,n,o,a){this.id="",this.name="Undefined",this.server=null,this.enabled=!1,this.supportsInput=!1,this.supportsOutput=!1,this.nativeFormat=EVWEB2.audioDeviceNativeFormatTypes.none,this.frequency=0,void 0!==e&&(this.server=e),void 0!==s&&(this.id=s),void 0!==t&&(this.name=t),void 0!==r&&(this.enabled=r),void 0!==i&&(this.supportsInput=i),void 0!==n&&(this.supportsOutput=n),void 0!==o&&(this.nativeFormat=o),void 0!==a&&(this.frequency=a),this.getAudio=function(e,s,t,r){if(!this.enabled||!this.supportsInput)throw new Error("Audio device is not enabled or does not support audio input.");var i=this.server.service.url()+EVWEB2.urls.audio,n=[];return void 0!==s?(n.push("s="+s),void 0!==t&&n.push("startFrame="+t),void 0!==r&&n.push("endFrame="+r)):n.push("s="+this.server.sessionId),n.push("a="+this.id),n.push("type="+e),i+="?"+n.join(";")+";",i+=(new Date).getTime()},this.getAudioOutput=function(e){void 0===e&&(e=EVWEB2.audioOutputStreamFormatTypes.native);var s=["s="+this.server.sessionId,"a="+this.id,"type="+e];return this.server.service.url()+EVWEB2.urls.audio+"?"+s.join("&")},this.sendAudio=function(e,s,t){if(!this.enabled||!this.supportsOutput)throw new Error("Audio device is not enabled or does not support audio output.");var r=this.server.service.url()+EVWEB2.urls.audio,i=["s="+this.server.sessionId,"a="+this.id];void 0!==t&&i.push("type="+t);var n=this,o={success:function(s){e(s,n)},error:function(){var s=new EVWEB2.ResponseStatus(!1,"An error occurred.");e(s,n)},url:r+="?"+i.join(";")+";",data:s,type:"POST",contentType:"application/octet-stream",processData:!1};EVWEB2.ajax(o,this.server.service)}}}(),EVWEB2.videoExportFormatTypes={ps:"ps",avi:"avi",eplayer:"eplayer",psZip:"ps_zip",mp4:"mp4",psx:"psx",mov:"mov"},EVWEB2.videoExportStatusTypes={notStarted:0,pending:1,exporting:2,completed:3},EVWEB2.VideoExportStatus=function(e,s,t,r){this.videoExport=null,this.status=EVWEB2.videoExportStatusTypes.notStarted,this.percentComplete=0,this.totalSize=0,void 0!==e&&(this.videoExport=e),void 0!==s&&(this.status=s),void 0!==t&&(this.percentComplete=t),void 0!==r&&(this.totalSize=r)},EVWEB2.VideoExport=function(e,s,t,r,i,n,o){this.server=null,this.id="",this.cameras=[],this.inputs=[],this.format=EVWEB2.videoExportFormatTypes.ps,this.start=null,this.end=null,this.filenames=[],void 0!==e&&(this.server=e),void 0!==s&&(this.id=s),void 0!==t&&(this.inputs=t,this.cameras=$.grep(t,function(e){return e instanceof EVWEB2.Camera})),void 0!==r&&(this.format=r),void 0!==i&&(this.start=i),void 0!==n&&(this.end=n),void 0!==o&&(this.filenames=o),this.getStatus=function(s){var t=this,r=function(){var e=new EVWEB2.ResponseStatus(!1,"An error occurred.");s(e)},i={success:function(e){if(e.success){var i=new EVWEB2.ResponseStatus(!0),n=new EVWEB2.VideoExportStatus(t,e.status,e.progress,e.size);s(i,n)}else r()},error:r,url:this.server.service.url()+EVWEB2.urls.videoexport,data:{export:this.id.toString()}};EVWEB2.ajax(i,e.service)},this.getDownloadUri=function(e){if(void 0===this.filenames[e])throw new Error("File index is not generated for this export.");var s=this.server.service.url()+EVWEB2.urls.videoexport;return s+="?export="+this.id.toString()+"&action=download&file="+e},this.endExport=function(s){var t=function(){var e=new EVWEB2.ResponseStatus(!1,"An error occurred.");s(e)},r={success:function(e){e.success||t();var r=new EVWEB2.ResponseStatus(!0);s(r)},error:t,url:this.server.service.url()+EVWEB2.urls.videoexport,data:{export:this.id.toString(),action:"finish"}};EVWEB2.ajax(r,e.service)}},EVWEB2.mapItemShapeTypes={none:0,unknown:1,balloon:2,square:3,pin:4},EVWEB2.mapItemCaptionPositionTypes={none:0,right:1,left:2,top:3,bottom:4},EVWEB2.mapItemTypes={none:0,camera:1,audio:2,serial:3,group:4,softTrigger:5,inputTrigger:6},EVWEB2.mapItemFlagTypes={autocontext:1,mirror:2,outputHint:4},EVWEB2.MapItemCaptionInfo=function(e,s){this.position=EVWEB2.mapItemCaptionPositionTypes.none,this.color="#FFFFFF",void 0!==e&&(this.position=e),void 0!==s&&(this.color=s)},EVWEB2.MapItemInfo=function(e,s,t,r,i,n,o,a,u){this.id="",this.serverId="",this.type=EVWEB2.mapItemTypes.none,this.shape=EVWEB2.mapItemShapeTypes.none,this.x=0,this.y=0,this.caption=null,this.rotation=0,this.flags=[],void 0!==e&&(this.id=e),void 0!==s&&(this.serverId=s),void 0!==t&&(this.type=t),void 0!==r&&(this.shape=r),void 0!==i&&(this.x=i),void 0!==n&&(this.y=n),void 0!==o&&(this.caption=o),void 0!==a&&(this.rotation=a),void 0!==u&&((u&EVWEB2.mapItemFlagTypes.autocontext)===EVWEB2.mapItemFlagTypes.autocontext&&this.flags.push(EVWEB2.mapItemFlagTypes.autocontext),(u&EVWEB2.mapItemFlagTypes.mirror)===EVWEB2.mapItemFlagTypes.mirror&&this.flags.push(EVWEB2.mapItemFlagTypes.mirror),(u&EVWEB2.mapItemFlagTypes.outputHint)===EVWEB2.mapItemFlagTypes.outputHint&&this.flags.push(EVWEB2.mapItemFlagTypes.outputHint))},EVWEB2.Map=function(e,s,t,r,i,n,o){this.service=null,this.id="",this.server=null,this.parentId="0",this.name="Unnamed",this.description="",this.items=[],void 0!==e&&(this.service=e),void 0!==s&&(this.id=s),void 0!==t&&(this.server=t),void 0!==r&&(this.parentId=r),void 0!==i&&(this.name=i),void 0!==n&&(this.description=n),void 0!==o&&(this.items=o),this.getImageUrl=function(){if(void 0!==this.id){var e=this.service.url()+EVWEB2.urls.map;return e+="?map="+this.id}}},function(){"use strict";EVWEB2.serverStatus={normal:0,alarm:1,motion:2},EVWEB2.StatusCameraItem=function(e,s,t){this.instance=null,this.motion=!1,this.loss=!1,void 0!==e&&(this.instance=e),void 0!==s&&(this.motion=s),void 0!==t&&(this.loss=t)},EVWEB2.StatusTriggerItem=function(e,s){this.instance=null,this.triggerState=EVWEB2.triggerState.unknown,void 0!==e&&(this.instance=e),void 0!==s&&(this.triggerState=s)},EVWEB2.StatusMapItem=function(e,s,t){this.instance=null,this.motion=!1,this.loss=!1,void 0!==e&&(this.instance=e),void 0!==s&&(this.motion=s),void 0!==t&&(this.loss=t)},EVWEB2.Status=function(e,s,t,r){this.server=null,this.cameras=[],this.triggers=[],this.maps=[],void 0!==e&&(this.server=e),void 0!==s&&(this.cameras=s),void 0!==t&&(this.triggers=t),void 0!==r&&(this.maps=r)},EVWEB2.ServerStatus=function(e,s,t,r,i){this.server=null,this.lossCameras=[],this.motionCameras=[],this.alarmTriggers=[],this.serverStatus=EVWEB2.serverStatus.normal,void 0!==e&&(this.server=e),void 0!==s&&(this.lossCameras=s),void 0!==t&&(this.motionCameras=t),void 0!==r&&(this.alarmTriggers=r),void 0!==i&&(this.serverStatus=i)}}(),EVWEB2.groupIconTypes={none:0,factory:1,court:2,house:3,skyscraper:4,station:5,office:6},EVWEB2.groupItemTypes=EVWEB2.mapItemTypes,EVWEB2.GroupItemInfo=function(e,s,t){this.id="",this.serverId="",this.type=EVWEB2.groupItemTypes.none,void 0!==e&&(this.id=e),void 0!==s&&(this.serverId=s),void 0!==t&&(this.type=t)},EVWEB2.Group=function(e,s,t,r,i){this.id="",this.name="Unnamed",this.description="",this.icon=EVWEB2.groupIconTypes.none,this.items=[],void 0!==e&&(this.id=e),void 0!==s&&(this.name=s),void 0!==t&&(this.description=t),void 0!==r&&(this.icon=r),void 0!==i&&(this.items=i)},EVWEB2.ThumbnailSearchInfo=function(e,s,t,r){this.sessionId="",this.camera=null,this.frameTimestamp=new Date,this.frameIndex=-1,void 0!==e&&(this.sessionId=e),void 0!==s&&(this.camera=s),void 0!==t&&(this.frameTimestamp=t),void 0!==r&&(this.frameIndex=r),this.getThumbnailImageUrl=function(s,t,r){if(!this.camera.supportsGetFrame())return"";var i=this.camera,n=i.server,o=n.service.url()+EVWEB2.urls.thumbnail,a=["s="+e,"frame="+this.frameIndex],u=!1,c=n.service.jpegForwarding;c.enabled&&-1!==$.inArray(EVWEB2.cameraFormats.jpeg,i.formats)&&(u=i.quality*(c.qualityThreshold/100)<r&&(i.resolution.width*(c.sizeThreshold/100)<s||i.resolution.height*(c.sizeThreshold/100)<t));var E=EVWEB2.cameraFormats.transcodedJpeg;return(u||-1===$.inArray(EVWEB2.cameraFormats.transcodedJpeg,i.formats))&&(E=EVWEB2.cameraFormats.jpeg),E!==EVWEB2.cameraFormats.jpeg&&(a.push("w="+s),a.push("h="+t),a.push("q="+r)),a.push("format="+E),o+="?"+a.join(";")}},EVWEB2.ThumbnailSearch=function(e,s,t,r,i){this.sessionId="",this.camera=null,this.start=new Date,this.end=new Date,this.framesInfo=[],void 0!==e&&(this.sessionId=e),void 0!==s&&(this.camera=s),void 0!==t&&(this.start=t),void 0!==r&&(this.end=r),void 0!==i&&(this.framesInfo=i),this.logout=function(e){var s=this.camera.server,t={success:function(){var s=new EVWEB2.ResponseStatus(!0);"function"==typeof e&&e(s)},error:function(){var s=new EVWEB2.ResponseStatus(!1,"An error occurred.");"function"==typeof e&&e(s)},url:s.service.url()+EVWEB2.urls.logout,data:{s:this.sessionId}};EVWEB2.ajax(t,s.service)},this.notifyUse=function(e){new EVWEB2.Server(this.camera.server.service,"",this.camera.server.id,!0,!1,this.sessionId).notifyUse(e)}},EVWEB2.TourFolder=function(e,s,t){this.id="",this.name="",this.parentId="",void 0!==e&&(this.id=e),void 0!==s&&(this.name=s),void 0!==t&&(this.parentId=t)},EVWEB2.TourItem=function(e,s,t){this.index=0,this.dwell=0,this.view="",void 0!==e&&(this.index=e),void 0!==s&&(this.dwell=s),void 0!==t&&(this.view=t)},EVWEB2.Tour=function(e,s,t,r,i){this.name="",this.folder=null,this.items=[],this.description="",this.service=null,void 0!==e&&(this.name=e),void 0!==s&&(this.folder=s),void 0!==t&&(this.items=t),void 0!==r&&(this.description=r),void 0!==i&&(this.service=i)},function(){"use strict";EVWEB2.associationLabel={unknown:-1,none:0,customFont:1},EVWEB2.overlayStyle={unknown:-1,persistent:0,hover:1},EVWEB2.overlayPosition={unknown:-1,none:0,right:1,left:2,top:3,bottom:4},EVWEB2.associationType={none:0,recordVideo:1,videoOutput:2,audioInput:3,audioOutput:4,serialPort:5,inputTrigger:6,outputTrigger:7,softTrigger:8,analytics:9,securityIntegrations:10,digitalPtz:11,replay:12,autoExport:13,autoFocus:14,suspectTracking:15},EVWEB2.associationPtzType={mechanicalPreset:0,digitalPreset:1,listMechanicalPresets:2,listDigitalPresets:3,toggleDigitalPtz:4},EVWEB2.AssociationItem=function(e,s,t,r,i){this.id=e,this.type=EVWEB2.associationType.none,this.position=0,this.statusOnly=!1,this.extra=null,void 0!==s&&(this.type=s),void 0!==t&&(this.position=t),void 0!==r&&(this.statusOnly=r),void 0!==i&&(this.extra=i)},EVWEB2.Association=function(e,s,t,r,i,n,o,a,u,c){this.server=e,this.camera=s,this.guid="",this.items=[],this.label=EVWEB2.associationLabel.unknown,this.style=EVWEB2.overlayStyle.unknown,this.position=EVWEB2.overlayPosition.unknown,this.bgColor=EVWEB2.fontColor.unknown,this.opacity=50,this.fontInfo=new EVWEB2.FontInfo,void 0!==t&&(this.guid=t),void 0!==r&&(this.items=r),void 0!==i&&(this.label=i),void 0!==n&&(this.style=n),void 0!==o&&(this.position=o),void 0!==a&&(this.bgColor=a),void 0!==u&&(this.opacity=u),void 0!==c&&(this.fontInfo=c)}}(),function(){"use strict";EVWEB2.securityIntegrationsDeviceConnectionStatus={badMessageFormat:-13,commandNotSupported:-12,internalError:-11,operatorError:-6,commandFailed:-5,authenticationError:-4,connectionError:-3,uninitialized:0,notConnected:1,connecting:2,connectionSuccessful:3,authenticating:4,commandRequest:5},EVWEB2.securityIntegrationsSensorAction={none:0,lock:1,unlock:2,arm:3,disarm:4,activate:5,deactivate:6,enableReader:7,disableReader:8,cardPresented:9,inputSupervised:10,inputUnsupervised:11,inputNormal:12,armAway:13,armStay:14,armNoEntryDelay:15},EVWEB2.securityIntegrationsSensorType={none:-1,relay:0,input:1,lock:2,rex:3,reader:4,door:5,partition:6,zone:7},EVWEB2.securityIntegrationsSensorDirection={none:-1,directionIn:0,directionOut:1,directionInOut:2},EVWEB2.securityIntegrationsSensorState={invalid:0,inputNormal:1,inputAlarmed:2,locked:3,unlocked:4,armed:5,disarmed:6,activated:7,deactivated:8,readerEnabled:9,readerDisabled:10,open:11,openTooLong:12,closed:13,doorForcedOpen:14,accessGranted:15,accessDenied:16,rexGranted:17,rexDenied:18,lockFailure:19,inputSupervised:20,inputNotSupervised:21,partitionPreAlarm:22,partitionPreDisarm:23,partitionAlarm:24,partitionArmedStay:25,partitionArmedAway:26,partitionArmedNoEntryDelay:27,partitionNotReady:28,zoneOpen:29,zoneAlarm:30,notMonitoring:998,error:999},EVWEB2.securityIntegrationsSensorAlarm={alert:1,alarm:2},EVWEB2.securityIntegrationsAuthType={none:0,userPass:1,accessCode:2},EVWEB2.securityIntegrationsSensorErrorType={permissionError:-10,invalidCommand:-9,commandTimeout:-8,invalidSession:-7,other:-6,commandOk:0},EVWEB2.SecurityIntegrationsDeviceCredsTraditional=function(e,s){this.authType=EVWEB2.securityIntegrationsAuthType.userPass,this.username=e,this.password=null,void 0!==s&&(this.password=s)},EVWEB2.SecurityIntegrationsDeviceCredsAccessCode=function(e){this.authType=EVWEB2.securityIntegrationsAuthType.accessCode,this.accessCode=e},EVWEB2.SecurityIntegrationsDevice=function(e,s,t,r,i,n,o,a,u,c,E,d){this.server=e,this.id=s,this.name="",this.host="",this.port=0,this.type="",this.enabled=!1,this.connectionStatus=EVWEB2.securityIntegrationsDeviceConnectionStatus.uninitialized,this.firmware="",this.serial="",this.user="",this.token=null,this.tokenExpiration=null,this.authType=EVWEB2.securityIntegrationsAuthType.userPass,void 0!==t&&(this.name=t),void 0!==r&&(this.host=r),void 0!==i&&(this.port=i),void 0!==n&&(this.type=n),void 0!==o&&(this.enabled=o),void 0!==a&&(this.connectionStatus=a),void 0!==u&&(this.firmware=u),void 0!==c&&(this.serial=c),void 0!==E&&(this.user=E),void 0!==d&&(this.authType=d),this.getSensors=function(e){var s=this,t={success:function(t){if(t.success){var r=new EVWEB2.ResponseStatus(!0),i=$.map(t.sensors,function(e){var t=e.statusTimestamp?EVWEB2.util.IETF2Date(e.statusTimestamp):void 0,r=e.persistedStatus?e.persistedStatus.map(function(e){return e.statusTimestamp=EVWEB2.util.IETF2Date(e.statusTimestamp),e}):void 0;return new EVWEB2.SecurityIntegrationsDeviceSensor(s,e.sensorId,e.name,e.type,e.direction,e.availableActions,e.inputs,e.defaultActionTimeout,e.maxActionTimeout,e.status,e.alarm,t,e.statusMessage,r)});e(r,i)}else{var n=new EVWEB2.ResponseStatus(!1,t.errorText);e(n)}},error:function(){var s=new EVWEB2.ResponseStatus(!1,"An error occurred.");e(s)},url:s.server.service.url()+EVWEB2.urls.securityIntegrationsDeviceSensors,data:{s:s.server.sessionId,device:s.id}};s.server.service.isXss()&&EVWEB2.util.updateRequestForXss(t),$.ajax(t)},this.login=function(e,s,t){var r=this,i={s:r.server.sessionId,device:r.id,username:s.username,password:s.password,expiration:EVWEB2.util.Date2IETF(t)};s.authType===EVWEB2.securityIntegrationsAuthType.userPass?(i.username=s.username,i.password=s.password):s.authType===EVWEB2.securityIntegrationsAuthType.accessCode&&(i.accessCode=s.accessCode);var n={success:function(s){if(s.success){var t=new EVWEB2.ResponseStatus(!0);r.token=s.token,r.tokenExpiration=EVWEB2.util.IETF2Date(s.expiration),e(t,r.token,r.tokenExpiration,s.sensors)}else{var i=new EVWEB2.ResponseStatus(!1,s.errorText);e(i)}},error:function(){var s=new EVWEB2.ResponseStatus(!1,"An error occurred.");e(s)},url:r.server.service.url()+EVWEB2.urls.securityIntegrationsDeviceLogin,type:"POST",data:i};r.server.service.isXss()&&EVWEB2.util.updateRequestForXss(n),$.ajax(n)},this.isLoggedIn=function(){return this.authType===EVWEB2.securityIntegrationsAuthType.none||null!==this.token&&this.tokenExpiration>new Date},this.logout=function(e){var s=this;if(null!==s.token){var t={success:function(t){if(t.success){s.token=null,s.tokenExpiration=null;var r=new EVWEB2.ResponseStatus(!0);e(r)}else{var i=new EVWEB2.ResponseStatus(!1,t.errorText);e(i)}},error:function(){var s=new EVWEB2.ResponseStatus(!1,"An error occurred.");e(s)},url:s.server.service.url()+EVWEB2.urls.securityIntegrationsDeviceLogin,type:"DELETE",data:{s:s.server.sessionId,device:s.id,token:s.token}};s.server.service.isXss()&&EVWEB2.util.updateRequestForXss(t),$.ajax(t)}else{var r=new EVWEB2.ResponseStatus(!1,"Not logged in.");e(r)}}},EVWEB2.SecurityIntegrationsDeviceSensor=function(e,s,t,r,i,n,o,a,u,c,E,d,v,h){this.device=e,this.id=s,this.name="",this.type=EVWEB2.securityIntegrationsSensorType.none,this.direction=EVWEB2.securityIntegrationsSensorDirection.none,this.availableActions=[],this.inputs=[],this.defaultActionTimeout=0,this.maxActionTimeout=0,this.status=[],this.alarm=[],this.statusTimestamp=null,this.statusMessage="",this.persistedStatus=[],void 0!==t&&(this.name=t),void 0!==r&&(this.type=r),void 0!==i&&(this.direction=i),void 0!==n&&(this.availableActions=n),void 0!==o&&(this.inputs=o),void 0!==a&&(this.defaultActionTimeout=a),void 0!==u&&(this.maxActionTimeout=u),void 0!==c&&(this.status=c),void 0!==E&&(this.alarm=E),void 0!==d&&(this.statusTimestamp=d),void 0!==v&&(this.statusMessage=v),void 0!==h&&(this.persistedStatus=h),this.performAction=function(e,s,t){if(this.device.isLoggedIn()){void 0===t&&(t=this.defaultActionTimeout);var r={success:function(s){if(s.success){var t=new EVWEB2.ResponseStatus(!0);e(t,s.actionSuccessful,s.operationStatus)}else{var r=new EVWEB2.ResponseStatus(!1,s.errorText);e(r,!1)}},error:function(){var s=new EVWEB2.ResponseStatus(!1,"An error occurred.");e(s,!1)},url:this.device.server.service.url()+EVWEB2.urls.securityIntegrationsDeviceSensors,type:"POST",data:{s:this.device.server.sessionId,token:this.device.token,device:this.device.id,sensor:this.id,action:s,timeout:t}};this.device.server.service.isXss()&&EVWEB2.util.updateRequestForXss(r),$.ajax(r)}else{var i=new EVWEB2.ResponseStatus(!1,"Not logged in");e(i)}}}}(),function(){"use strict";EVWEB2.osdPosition={none:0,topLeft:1,topCenter:2,topRight:3,bottomLeft:7,bottomCenter:8,bottomRight:9},EVWEB2.osdDisplay={name:8,time:4,timezone:2,date:1},EVWEB2.CameraOsdInfo=function(e,s,t,r,i,n,o,a,u,c,E){this.position=EVWEB2.osdPosition.none,this.name=!1,this.time=!1,this.date=!1,this.timezone=!1,this.font="Sans",this.fontSize=10,this.fontColor=EVWEB2.fontColor.white,this.fontStyle=EVWEB2.fontStyle.normal,this.fontFamily=EVWEB2.fontFamily.defaultFont,this.fontWeight=EVWEB2.fontWeight.light,void 0!==e&&(this.position=e),void 0!==s&&(this.name=s),void 0!==t&&(this.time=t),void 0!==r&&(this.date=r),void 0!==i&&(this.timezone=i),void 0!==n&&(this.font=n),void 0!==o&&(this.fontSize=o),void 0!==a&&(this.fontColor=a),void 0!==u&&(this.fontStyle=u),void 0!==c&&(this.fontFamily=c),void 0!==E&&(this.fontWeight=E),this.getDisplayBitmask=function(){var e=0;return this.name&&(e|=EVWEB2.osdDisplay.name),this.date&&(e|=EVWEB2.osdDisplay.date),this.time&&(e|=EVWEB2.osdDisplay.time),this.timezone&&(e|=EVWEB2.osdDisplay.timezone),e}},EVWEB2.CameraConfig=function(e){if(void 0===e)throw new Error("Camera required");this.camera=e;var s=null,t=0;this.setOsdInfo=function(e,s){if("function"!=typeof e)throw new Error("Callback required");if(void 0===s)throw new Error("CameraOsdInfo required");var t={s:this.camera.server.sessionId,camera:this.camera.id,position:s.position,display:s.getDisplayBitmask(),fontName:s.font,fontSize:s.fontSize,evFontColor:s.fontColor,evFontFamily:s.fontFamily,evFontStyle:s.fontStyle,evFontWeight:s.fontWeight},r={success:function(s){if(s.success){var t=new EVWEB2.ResponseStatus(!0);e(t)}else{var r=new EVWEB2.ResponseStatus(!1,s.errorText);e(r)}},error:function(){var s=new EVWEB2.ResponseStatus(!1,"An error occurred.");e(s)},url:this.camera.server.service.url()+EVWEB2.urls.camera,data:t,type:"POST"};EVWEB2.ajax(r,this.camera.server.service,!0)};this.getOsdInfo=function(e,t){if("function"!=typeof e)throw new Error("Callback required");void 0===t&&(t=!1);var r=this;if(null===s||t){var i={s:this.camera.server.sessionId,camera:this.camera.id},n={success:function(t){if(t.success){null===s&&(s=new EVWEB2.CameraOsdInfo),s.position=t.camera.osdInfo.position,s.name=Boolean(t.camera.osdInfo.display&EVWEB2.osdDisplay.name),s.time=Boolean(t.camera.osdInfo.display&EVWEB2.osdDisplay.time),s.date=Boolean(t.camera.osdInfo.display&EVWEB2.osdDisplay.date),s.timezone=Boolean(t.camera.osdInfo.display&EVWEB2.osdDisplay.timezone),s.font=t.camera.osdInfo.fontName,s.fontSize=t.camera.osdInfo.fontSize,s.fontColor=t.camera.osdInfo.evFontColor,s.fontStyle=t.camera.osdInfo.evFontStyle,s.fontFamily=t.camera.osdInfo.evFontFamily,s.fontWeight=t.camera.osdInfo.evFontWeight,r.camera.osd.position=function(e){var s;switch(e){case EVWEB2.osdPosition.bottomLeft:s="bottom-left";break;case EVWEB2.osdPosition.bottomCenter:s="bottom-center";break;case EVWEB2.osdPosition.bottomRight:s="bottom-right";break;case EVWEB2.osdPosition.topLeft:s="top-left";break;case EVWEB2.osdPosition.topCenter:s="top-center";break;case EVWEB2.osdPosition.topRight:s="top-right";break;default:s="none"}return s}(s.position),r.camera.osd.name=s.name,r.camera.osd.time=s.time,r.camera.osd.date=s.date,r.camera.osd.timezone=s.timezone;var i=new EVWEB2.ResponseStatus(!0);e(i,s,r.camera)}else{var n=new EVWEB2.ResponseStatus(!1,t.errorText);e(n)}},error:function(){var s=new EVWEB2.ResponseStatus(!1,"An error occurred.");e(s)},url:this.camera.server.service.url()+EVWEB2.urls.camera,data:i};EVWEB2.ajax(n,this.camera.server.service)}else{var o=new EVWEB2.ResponseStatus(!0);e(o,s,r.camera)}},this.getAverageFrameSize=function(e){if("function"!=typeof e)throw new Error("Callback required");var s=this,r={s:this.camera.server.sessionId,camera:this.camera.id},i={success:function(r){if(r.success){t=r.camera.averageFrameSize;var i=new EVWEB2.ResponseStatus(!0);e(i,t,s.camera)}else{var n=new EVWEB2.ResponseStatus(!1,r.errorText);e(n)}},error:function(){var s=new EVWEB2.ResponseStatus(!1,"An error occurred.");e(s)},url:this.camera.server.service.url()+EVWEB2.urls.camera,data:r};EVWEB2.ajax(i,this.camera.server.service)}},EVWEB2.digitalPtzTypes={normal:1,dewarp:2,panorama:4,dualView:8},EVWEB2.ptzTypes={none:"none",standard:"standard",digital:"digital"},EVWEB2.ptzDirections={upLeft:"ul",up:"u",upRight:"ur",left:"l",none:"n",right:"r",downLeft:"dl",down:"d",downRight:"dr",zoomIn:"i",zoomOut:"o"},EVWEB2.cameraFormats={jpeg:0,mpeg1:1,mpeg2:2,h263:3,mpeg4:4,h264:5,transcodedJpeg:6,h265:7},EVWEB2.streamFormat={native:"native",transcode:"transcode"},EVWEB2.cameraThumbnailSizes={size80x80:0,size128x128:1,size200x200:2},EVWEB2.DigitalPtzRectangle=function(e,s,t,r){this.x=0,this.y=0,this.width=0,this.height=0,void 0!==e&&(this.x=e),void 0!==s&&(this.y=s),void 0!==t&&(this.width=t),void 0!==r&&(this.height=r)},EVWEB2.PtzPreset=function(e,s){this.id="",this.name="Undefined",void 0!==e&&(this.id=e),void 0!==s&&(this.name=s)},EVWEB2.CameraResolution=function(e,s){this.width=0,this.height=0,void 0!==e&&(this.width=e),void 0!==s&&(this.height=s)},EVWEB2.Camera=function(e,s,t,r,i,n,o,a,u,c,E,d,v,h,l,p,f){this.id="",this.sourceCamera=this,this.ctx="",this.name="Undefined",this.server=null,this.ptz=!1,this.ptzType=EVWEB2.ptzTypes.none,this.digitalPtzTypes=[],this.digitalPtzType=null,this.disabled=!0,this.video=!1,this.osd={position:"none",name:!1,time:!1,date:!1,timezone:!1},this.formats=[EVWEB2.cameraFormats.transcodedJpeg],this.resolution=null,this.quality=-1,this.frameRate=-1,this.config=new EVWEB2.CameraConfig(this),this.nativeDecodingFailed=!1,this.parentId=void 0!==s?s:"",this.rotation=0,this.streamFormats=f||[EVWEB2.streamFormat.native,EVWEB2.streamFormat.transcode];var m,V,B=50;void 0!==e&&(this.server=e),void 0!==s&&(this.id=s),void 0!==t&&(this.ctx=t),void 0!==r&&(this.name=r),void 0!==i&&(this.ptz=i),void 0!==u&&(this.ptzType=u),void 0!==n&&(this.disabled=n),void 0!==o&&(this.video=o),void 0!==a&&(void 0!==a.position&&(this.osd.position=a.position),void 0!==a.name&&(this.osd.name=a.name),void 0!==a.time&&(this.osd.time=a.time),void 0!==a.date&&(this.osd.date=a.date),void 0!==a.timezone&&(this.osd.timezone=a.timezone)),void 0!==c&&(this.digitalPtzTypes=c),void 0!==E&&(this.formats=E),void 0!==d&&(this.resolution=d),void 0!==v&&(this.quality=v),void 0!==h&&(this.frameRate=h),void 0!==l&&(this.parentId=l),void 0!==p&&(this.rotation=p),-1===$.inArray(EVWEB2.cameraFormats.transcodedJpeg,this.formats)&&(this.digitalPtzType=null,this.digitalPtzTypes=[]);var W=function(e){return void 0===e&&(null===EVWEB2.config.defaultStreamId&&(EVWEB2.config.defaultStreamId=EVWEB2.util.generateStreamId()),e=EVWEB2.config.defaultStreamId),e};this.supportsGetFrame=function(){if(void 0===m){var e=-1!==$.inArray(EVWEB2.cameraFormats.jpeg,this.formats),s=-1!==$.inArray(EVWEB2.cameraFormats.transcodedJpeg,this.formats);m=e||s}return m},this.supportsGetVideo=function(){if(void 0===V){var e,s,t=[EVWEB2.cameraFormats.mpeg1,EVWEB2.cameraFormats.mpeg2,EVWEB2.cameraFormats.h263,EVWEB2.cameraFormats.mpeg4,EVWEB2.cameraFormats.h264];for(V=!1,e=0,s=t.length;e<s;e++)if(-1!==$.inArray(t[e],this.formats))return V=!0}return V};this.getFrame=function(e,s,t,r,i){var n=this;if(this.sourceCamera!==this&&(n=this.sourceCamera),1===n.formats.length&&n.formats[0]===EVWEB2.cameraFormats.transcodedJpeg)return function(e,s,t,r,i,n){var o=e.server.service.url()+EVWEB2.urls.legacyGetFrame,a=["s="+e.server.sessionId,"camera="+e.id,"q="+r,"w="+s,"h="+t];return void 0!==i&&a.push("search_id="+i),void 0===n&&(null===EVWEB2.config.defaultStreamId&&(EVWEB2.config.defaultStreamId=EVWEB2.util.generateStreamId()),n=EVWEB2.config.defaultStreamId),a.push("stream="+n),o+="?"+a.join(";")+";",o+=(new Date).getTime()}(this,e,s,t,r,i);if(!n.supportsGetFrame())return"";var o=this.server.service.url()+EVWEB2.urls.video,a=["s="+this.server.sessionId,"camera="+this.id,"stream="+W(i)];void 0!==r&&a.push("search_id="+r);var u=!1,c=this.server.service.jpegForwarding;c.enabled&&-1!==$.inArray(EVWEB2.cameraFormats.jpeg,this.formats)&&(u=this.quality*(c.qualityThreshold/100)<t&&(this.resolution.width*(c.sizeThreshold/100)<e||this.resolution.height*(c.sizeThreshold/100)<s));var E=EVWEB2.cameraFormats.transcodedJpeg;return(u||-1===$.inArray(EVWEB2.cameraFormats.transcodedJpeg,this.formats))&&(E=EVWEB2.cameraFormats.jpeg),E!==EVWEB2.cameraFormats.jpeg&&(a.push("w="+e),a.push("h="+s),a.push("q="+t)),a.push("format="+E),o+="?"+a.join(";")+";",o+=(new Date).getTime()};this.getDownloadFrame=function(e,s,t,r){if(1===this.formats.length&&this.formats[0]===EVWEB2.cameraFormats.transcodedJpeg)return function(e,s,t,r,i){var n=e.server.service.url()+EVWEB2.urls.legacyGetFrame,o=["s="+e.server.sessionId,"camera="+e.id,"q="+t,"download="+s,"stream="+W(i)];return void 0!==r&&o.push("search_id="+r),n+="?"+o.join(";")+";",n+=(new Date).getTime()}(this,e,s,t,r);if(!this.supportsGetFrame())return"";var i=this.server.service.url()+EVWEB2.urls.video,n=["s="+this.server.sessionId,"camera="+this.id,"download="+e,"stream="+W(r)];void 0!==t&&n.push("search_id="+t);var o=!1,a=this.server.service.jpegForwarding;a.enabled&&-1!==$.inArray(EVWEB2.cameraFormats.jpeg,this.formats)&&(o=this.quality*(a.qualityThreshold/100)<s);var u=EVWEB2.cameraFormats.transcodedJpeg;return o?u=EVWEB2.cameraFormats.jpeg:n.push("q="+s),n.push("format="+u),i+="?"+n.join(";")+";",i+=(new Date).getTime()},this.getVideo=function(e,s,t,r,i,n,o,a){if(-1===$.inArray(e,this.formats))return"";if(1===this.formats.length&&this.formats[0]===EVWEB2.cameraFormats.transcodedJpeg)return"";void 0===a&&(a=!1);var u=this.server.service.url()+EVWEB2.urls.video,c=["s="+this.server.sessionId,"camera="+this.id,"format="+e,"stream="+W(t)];return void 0!==s&&c.push("search_id="+s),e===EVWEB2.cameraFormats.transcodedJpeg&&(c.push("w="+i),c.push("h="+n),c.push("q="+o)),void 0!==r&&c.push("download="+r),a&&c.push("multipart_encode=1"),u+="?"+c.join(";")+";",u+=(new Date).getTime()},this.getVideoStream=function(e,s,t,r,i){var n=this.server.service.url();n=0===n.indexOf("http://")?n.replace("http://","ws://"):n.replace("https://","wss://"),n+=EVWEB2.urls.video;var o=["s="+this.server.sessionId,"camera="+this.id,"format="+e,"stream="+W(s)];return e===EVWEB2.cameraFormats.transcodedJpeg&&(o.push("w="+t),o.push("h="+r),o.push("q="+i)),n+="?"+o.join("&"),new EVWEB2.VideoStream(n,e)},this.getSearchSnapshot=function(e,s,t,r,i){var n=["s="+this.server.sessionId,"camera="+this.id,"time="+EVWEB2.util.Date2IETF(e,!0),"format="+s];return s===EVWEB2.cameraFormats.transcodedJpeg&&this.server.service.jpegForwarding.enabled&&this.server.service.jpegForwarding.shouldForward(this,t,r,i)&&(s=EVWEB2.cameraFormats.jpeg),s===EVWEB2.cameraFormats.transcodedJpeg&&(t&&n.push("w="+t),r&&n.push("h="+r),i&&n.push("q="+i)),this.server.service.url()+EVWEB2.urls.searchSnapshot+"?"+n.join("&")},this.getPtzPresets=function(s){if(!this.ptz){var t=new EVWEB2.ResponseStatus(!1,"Camera does not support PTZ.");s(t)}var r=this,i=function(){var e=new EVWEB2.ResponseStatus(!1,"An error occurred.");s(e)},n={success:function(e){if(e===EVWEB2.errors.ptz&&i(),"string"==typeof e)try{e=JSON.parse(e)}catch(e){return void i()}var t=new EVWEB2.ResponseStatus(!0),n=$.map(e.Presets,function(e){return new EVWEB2.PtzPreset(e.id,e.name)});s(t,r,n)},error:i,url:e.service.url()+EVWEB2.urls.ptz,data:{s:this.server.sessionId,camera:this.id}};EVWEB2.ajax(n,e.service)},this.recallPtzPreset=function(e){if(!this.ptz)throw new Error("Camera does not support PTZ.");var s={s:this.server.sessionId,camera:this.id,preset:e};if(this.server.requiresResourceKey()){if(""===this.server.service.resourceKey)throw new Error("CSRF enforced, passthrough will not work.");s.key=this.server.service.resourceKey}var t=this.server.service;this.server.service.version(function(e,r){var i="2.0.0"===r,n={url:t.url()+EVWEB2.urls.ptz,type:i?"GET":"POST",dataType:"text",data:s};EVWEB2.ajax(n,t,!0)})},this.ptzMove=function(e){if(!this.ptz)throw new Error("Camera does not support PTZ.");var s={s:this.server.sessionId,camera:this.id,dir:e};if(this.server.requiresResourceKey()){if(""===this.server.service.resourceKey)throw new Error("CSRF enforced, passthrough will not work.");s.key=this.server.service.resourceKey}var t=this.server.service;this.server.service.version(function(e,r){var i="2.0.0"===r,n={url:t.url()+EVWEB2.urls.ptz,type:i?"GET":"POST",dataType:"text",data:s};EVWEB2.ajax(n,t,!0)})},this.setPtzSpeed=function(e){if(!this.ptz)throw new Error("Camera does not support PTZ.");B=e;var s={s:this.server.sessionId,camera:this.id,zpeed:e,tspeed:e,pspeed:e};if(this.server.requiresResourceKey()){if(""===this.server.service.resourceKey)throw new Error("CSRF enforced, passthrough will not work.");s.key=this.server.service.resourceKey}var t={url:this.server.service.url()+EVWEB2.urls.ptz,type:"POST",dataType:"text",data:s};EVWEB2.ajax(t,this.server.service,!0)},this.getPtzSpeed=function(){if(!this.ptz)throw new Error("Camera does not support PTZ.");return B},this.ptzCanMove=function(s,t){if(!this.ptz){var r=new EVWEB2.ResponseStatus(!1,"Camera does not support PTZ.");s(r)}if(this.ptzType!==EVWEB2.ptzTypes.standard){var i=function(){var e=new EVWEB2.ResponseStatus(!1,"An error occurred.");s(e)},n={success:function(e){if(e.success){var t=new EVWEB2.ResponseStatus(!0);s(t,e.canMove)}else i()},error:i,url:e.service.url()+EVWEB2.urls.digitalPtz,data:{s:this.server.sessionId,ptz:this.id,dir:t}};EVWEB2.ajax(n,e.service)}else{var o=new EVWEB2.ResponseStatus(!0);s(o,!0)}},this.cloneCamera=function(){var e,s=this.digitalPtzTypes.slice(0),t=this.formats.slice(0);null!==this.resolution&&(e=new EVWEB2.CameraResolution(this.resolution.width,this.resolution.height));var r=new EVWEB2.Camera(this.server,this.id,this.ctx,this.name,this.ptz,this.disabled,this.video,this.osd,this.ptzType,s,t,e,this.quality);return r.sourceCamera=this.sourceCamera,r.digitalPtzType=this.digitalPtzType,r};var g=0,w=0;this.createDigitalPtzCamera=function(s,t,r,i,n){if(0===this.digitalPtzTypes.length)throw new Error("Camera does not support digital PTZ.");if(-1===$.inArray(t,this.digitalPtzTypes))throw new Error("Camera does not support this type of digital PTZ.");var o=this.server.sessionId;void 0!==r&&(o=r);var a=this,u=function(){var e=new EVWEB2.ResponseStatus(!1,"An error occurred.");s(e)},c={success:function(e){if(e.success){var i=e.ptzId,n=new EVWEB2.ResponseStatus(!0),c=a.cloneCamera();c.id=i,c.ptz=!0,c.sourceCamera=a,c.digitalPtzType=t,c.ptzType=EVWEB2.ptzTypes.digital,c.formats=[EVWEB2.cameraFormats.transcodedJpeg],void 0!==r&&(c.server=$.extend({},a.server,{sessionId:o})),c.setPtzSpeed(50);var E=new EVWEB2.DigitalPtzRectangle(e.x,e.y,e.width,e.height);s(n,c,E)}else u()},error:u,url:e.service.url()+EVWEB2.urls.digitalPtz,data:{s:o,camera:this.id,type:t,cacheBreak:function(){var e=(new Date).getTime();return g===e?w++:(g=e,w=0),g.toString()+w.toString()}()}};void 0!==i&&void 0!==n&&(i.id?c.data.viewid=i.id:c.data.view=i.name,c.data.slot=n),EVWEB2.ajax(c,e.service)},this.getDigitalPtzRectangle=function(s){if(0===this.digitalPtzTypes.length)throw new Error("Camera does not support digital PTZ.");if(this.sourceCamera!==this){var t=this,r=function(){var e=new EVWEB2.ResponseStatus(!1,"An error occurred.");s(e)},i={success:function(e){if(e.success){var i=new EVWEB2.ResponseStatus(!0),n=new EVWEB2.DigitalPtzRectangle(e.x,e.y,e.width,e.height);s(i,t,n)}else r()},error:r,url:e.service.url()+EVWEB2.urls.digitalPtz,data:{s:this.server.sessionId,ptz:this.id}};EVWEB2.ajax(i,e.service)}else{var n=new EVWEB2.ResponseStatus(!1,"This camera is not a digital PTZ camera.");s(n)}},this.setDigitalPtzRectangle=function(e,s,t,r,i){if(0===this.digitalPtzTypes.length)throw new Error("Camera does not support digital PTZ.");if(this.sourceCamera!==this){var n=this,o=function(){if("function"==typeof e){var s=new EVWEB2.ResponseStatus(!1,"An error occurred.");e(s)}},a={s:this.server.sessionId,ptz:this.id,x:s,y:t,w:r,h:i};if(this.server.requiresResourceKey()){if(""===this.server.service.resourceKey)throw new Error("CSRF enforced, passthrough will not work.");a.key=this.server.service.resourceKey}var u={url:this.server.service.url()+EVWEB2.urls.digitalPtz,success:function(s){if("function"==typeof e)if(s.success)if(s.xssPost)void 0!==e&&n.getDigitalPtzRectangle(e);else{var t=new EVWEB2.ResponseStatus(!0),r=new EVWEB2.DigitalPtzRectangle(s.x,s.y,s.width,s.height);e(t,n,r)}else o()},error:o,type:"POST",data:a};EVWEB2.ajax(u,this.server.service,!0)}else if("function"==typeof e){var c=new EVWEB2.ResponseStatus(!1,"This camera is not a digital PTZ camera.");e(c)}},this.deleteDigitalPtzCamera=function(e){if(0===this.digitalPtzTypes.length)throw new Error("Camera does not support digital PTZ.");if(this.sourceCamera!==this){var s=this,t={s:this.server.sessionId,ptz:this.id,action:"delete"};if(this.server.requiresResourceKey()){if(""===this.server.service.resourceKey)throw new Error("CSRF enforced, passthrough will not work.");t.key=this.server.service.resourceKey}var r={success:function(t){if("function"==typeof e){if(!t.success){var r=new EVWEB2.ResponseStatus(!1,t.errorText);return void e(r)}var i=new EVWEB2.ResponseStatus(!0);e(i,s.sourceCamera)}},error:function(){if("function"==typeof e){var s=new EVWEB2.ResponseStatus(!1,"An error occurred.");e(s)}},url:this.server.service.url()+EVWEB2.urls.digitalPtz,type:"POST",data:t};EVWEB2.ajax(r,this.server.service,!0)}else if("function"==typeof e){var i=new EVWEB2.ResponseStatus(!1,"This camera is not a digital PTZ camera.");e(i)}},this.getThumbnailSearch=function(e,s,t,r){var i=this,n=i.server,o=n.service.url()+EVWEB2.urls.thumbnail,a={success:function(s){if(s.success){var t=new EVWEB2.ResponseStatus(!0);if("0"!==s.frames){var r=$.map(s.frames_timestamps,function(e,t){return new EVWEB2.ThumbnailSearchInfo(s.session_id,i,e,t)}),n=new EVWEB2.ThumbnailSearch(s.session_id,i,s.start,s.end,r);e(t,n)}else e(t,null)}else{var o=new EVWEB2.ResponseStatus(!1,s.errorText);e(o)}},error:function(){var s=new EVWEB2.ResponseStatus(!1,"An error occurred.");e(s)},url:o+="?"+["s="+n.sessionId,"camera="+i.id,"start="+EVWEB2.util.Date2IETF(s),"end="+EVWEB2.util.Date2IETF(t),"interval="+r].join(";"),data:{output:"json"}};EVWEB2.ajax(a,n.service)},this.setName=function(e,s){if("function"!=typeof e)throw new Error("Callback required");if(void 0!==s){var t=this,r={s:this.server.sessionId,camera:this.id,name:s},i={success:function(r){if(r.success){r.xssPost||(t.name=s);var i=new EVWEB2.ResponseStatus(!0);e(i,t)}else{var n=new EVWEB2.ResponseStatus(!1,r.errorText);e(n)}},error:function(){var s=new EVWEB2.ResponseStatus(!1,"An error occurred.");e(s)},url:this.server.service.url()+EVWEB2.urls.camera,data:r,type:"POST"};EVWEB2.ajax(i,this.server.service,!0)}else{var n=new EVWEB2.ResponseStatus(!1,"New name required");e(n)}},this.getThumbnailUrl=function(e){void 0===e&&(e=EVWEB2.cameraThumbnailSizes.size80x80);var s,t=this.server.service.url()+EVWEB2.urls.cachedThumbnail,r={s:this.server.sessionId,camera:this.id,size:e},i="";for(s in r)r.hasOwnProperty(s)&&(i+=(""===i?"":"&")+s+"="+r[s]);return t+"?"+i},this.getAssociations=function(e){var s=this,t={success:function(t){if(t.success){var r=new EVWEB2.ResponseStatus(!0);if(null!==t.association){var i=t.association,n=$.map(i.items,function(e){return new EVWEB2.AssociationItem(e.id,e.type,e.position,e.statusOnly,e.extra)}),o=new EVWEB2.FontInfo(i.fontName,i.fontSize,i.fontStyle,i.fontColor,i.fontFamily,i.fontWeight),a=new EVWEB2.Association(s.server,s,i.guid,n,i.label,i.overlayStyle,i.position,i.backgroundColor,i.opacity,o);e(r,a)}else e(r,null)}else{var u=new EVWEB2.ResponseStatus(!1,t.errorText);e(u)}},error:function(){var s=new EVWEB2.ResponseStatus(!1,"An error occurred.");e(s)},url:s.server.service.url()+EVWEB2.urls.associationsCamera,data:{s:s.server.sessionId,camera:s.parentId}};s.server.service.isXss()&&EVWEB2.util.updateRequestForXss(t),$.ajax(t)}},EVWEB2.getCameras=function(e,s){s.getCameras(e)}}(),EVWEB2.SystemHardwareInfo=function(e,s,t,r,i,n,o,a){this.serialNumber="",this.modelNumber="",this.motherboard="",this.bios="",this.processor="",this.totalMemory="",this.os="",this.runningSince=null,void 0!==e&&(this.serialNumber=e),void 0!==s&&(this.modelNumber=s),void 0!==t&&(this.motherboard=t),void 0!==r&&(this.bios=r),void 0!==i&&(this.processor=i),void 0!==n&&(this.totalMemory=n),void 0!==o&&(this.os=o),void 0!==a&&(this.runningSince=a)},EVWEB2.SystemConfig=function(e,s,t,r){this.server=null,this.systemName="",this.hardwareInfo=null,this.isUtf8=!1,void 0!==e&&(this.server=e),void 0!==s&&(this.systemName=s),void 0!==t&&(this.hardwareInfo=t),void 0!==r&&(this.isUtf8=r),this.setSystemName=function(e,s){var t=this.server,r={s:t.sessionId,systemName:s},i={url:t.service.url()+EVWEB2.urls.systemInfo,success:function(r){if(r.success){t.name=s;var i=new EVWEB2.ResponseStatus(!0);e(i,s)}else{var n=new EVWEB2.ResponseStatus(!1,r.errorText);e(n)}},error:function(){var s=new EVWEB2.ResponseStatus(!1,"An error occurred.");e(s)},type:"POST",data:r};EVWEB2.ajax(i,t.service,!0)},this.enableSystemUtf8=function(e){if(this.isUtf8){var s=new EVWEB2.ResponseStatus(!1,"UTF-8 is already enabled on this system.");e(s)}else{var t={s:this.server.sessionId,utf8Enabled:!0},r={url:this.server.service.url()+EVWEB2.urls.systemInfo,success:function(s){if(s.success){var t=new EVWEB2.ResponseStatus(!0);e(t)}else{var r=new EVWEB2.ResponseStatus(!1,s.errorText);e(r)}},error:function(){var s=new EVWEB2.ResponseStatus(!1,"An error occurred.");e(s)},type:"POST",data:t};EVWEB2.ajax(r,this.server.service,!0)}}},function(){"use strict";EVWEB2.VideoPushCapabilities={liveVideo:0,liveAudio:1,liveSerial:2,liveDigitalPtz:3,liveTours:4,liveCustomLayouts:5,liveFullScreen:6,liveMaps:7},EVWEB2.VideoPushApplications={web:0,mobile:1},EVWEB2.VideoPushDisplaySettings={fullScreen:0,hideToolbar:1,hideNavbar:2},EVWEB2.VideoPushMessageTypes={invalid:-1,displaySettings:0,liveViews:1,liveTours:2},EVWEB2.VideoPushStatuses={notSent:"",pending:"Pending",sent:"Sent"},EVWEB2.VideoPushTarget=function(e,s,t,r,i){this.id="",this.name="",this.servers=[],this.capabilities=[],this.maxPanels=0,void 0!==e&&(this.id=e),void 0!==s&&(this.name=s),void 0!==t&&(this.servers=t),void 0!==r&&(this.capabilities=r),void 0!==i&&(this.maxPanels=i)},EVWEB2.VideoPushMessageStatus=function(e,s){this.status=EVWEB2.VideoPushStatuses.notSent,this.appliedServers=[],void 0!==e&&(this.status=e),void 0!==s&&(this.appliedServers=s)},EVWEB2.VideoPushMessage=function(e,s,t,r){this.type=EVWEB2.VideoPushMessageTypes.invalid,this.target=null,this.sender="",this.content="",this.messageId="",this.servers=[],this.tourFolders=[],void 0!==e&&(this.target=e),void 0!==s&&(this.sender=s),void 0!==t&&(this.content=t,t instanceof EVWEB2.View?this.type=EVWEB2.VideoPushMessageTypes.liveViews:t instanceof EVWEB2.Tour?this.type=EVWEB2.VideoPushMessageTypes.liveTours:t instanceof Array&&(this.type=EVWEB2.VideoPushMessageTypes.displaySettings)),void 0!==r&&(this.tourFolders=r);var i=function(e,s){return $.grep(s,function(s){return s.id===e})[0]};this.generateContent=function(){var e="";if(this.type===EVWEB2.VideoPushMessageTypes.displaySettings)e=this.content;else if(this.type===EVWEB2.VideoPushMessageTypes.liveViews)e={layout:this.content.layout,items:$.map(this.content.items,function(e){return{slot:e.slotIndex,id:e.id,server:e.server,type:function(e){var s=EVWEB2.ViewSlotItemTypes.none;return e.type===EVWEB2.Camera?s=EVWEB2.ViewSlotItemTypes.camera:e.type===EVWEB2.Map?s=EVWEB2.ViewSlotItemTypes.group:e.type===EVWEB2.AudioDevice&&(s=EVWEB2.ViewSlotItemTypes.audio),s}(e)}})};else if(this.type===EVWEB2.VideoPushMessageTypes.liveTours){var s,t=[];for(null!==this.content.folder&&(s=i(this.content.folder.id,this.tourFolders)),void 0!==s&&t.push(s.name);void 0!==s&&s.id!==s.parentId;)s=i(s.parentId,this.tourFolders),t.unshift(s.name);e={name:this.content.name,folders:t}}return JSON.stringify(e)},this.getStatus=function(e){var s=this,t=this.target.servers[0].service,r=$.map(this.target.servers,function(e){return e.sessionId}),i={success:function(t){if(t.success){var r=$.map(t.applied,function(e){return $.grep(s.target.servers,function(s){return s.id.toString()===e.toString()})[0]}),i=new EVWEB2.VideoPushMessageStatus(t.status,r),n=new EVWEB2.ResponseStatus(!0);e(n,i)}else{var o=new EVWEB2.ResponseStatus(!1,t.errorText);e(o)}},error:function(){var s=new EVWEB2.ResponseStatus(!1,"An error occurred.");e(s)},url:t.url()+EVWEB2.urls.videopushMessage+"/"+this.messageId,traditional:!0,data:{s:r}};EVWEB2.ajax(i,t)}},EVWEB2.VideoPush=function(e){var s="";void 0!==e&&(s=e);var t="",r=[],i=[],n=0;EVWEB2.VideoPushApplications.web;this.getTargets=function(e,s){var t=s[0].service,r=$.map(s,function(e){return e.sessionId}),i={success:function(t){if(t.success){var r=$.map(t.targets,function(e){var t=$.map(e.sessionIds,function(e){return e.toString()}),r=$.grep(s,function(e){return-1!==$.inArray(e.id,t)});return new EVWEB2.VideoPushTarget(e.id,e.name,r,e.capabilities,e.maxPanels)}),i=new EVWEB2.ResponseStatus(!0);e(i,r)}else{var n=new EVWEB2.ResponseStatus(!1,t.errorText);e(n)}},error:function(){var s=new EVWEB2.ResponseStatus(!1,"An error occurred.");e(s)},url:t.url()+EVWEB2.urls.videopush,traditional:!0,data:{s:r}};EVWEB2.ajax(i,t)},this.updateClient=function(e,o,a,u,c,E){void 0===E&&(E=EVWEB2.VideoPushApplications.web);var d=o[0].service,v=$.map(o,function(e){return e.sessionId}),h={success:function(d){if(d.success){s=d.target.guid,r=o,t=a,i=u,n=c,E;var v=new EVWEB2.ResponseStatus(!0);e(v,s)}else{var h=new EVWEB2.ResponseStatus(!1,d.errorText);e(h)}},error:function(){var s=new EVWEB2.ResponseStatus(!1,"An error occurred.");e(s)},url:d.url()+EVWEB2.urls.videopush,type:"POST",traditional:!0,data:{s:v,name:a,maxPanels:c,capabilities:u}};E===EVWEB2.VideoPushApplications.mobile&&(h.data.mobile=1),""!==s&&(h.data.guid=s),EVWEB2.ajax(h,d)},this.sendMessage=function(e,t){if(""===s){var r=new EVWEB2.ResponseStatus(!1,"GUID not specified for client.");e(r)}if(0===t.target.servers.length){var i=new EVWEB2.ResponseStatus(!1,"No servers match the push target.");e(i)}var n=t.target.servers[0].service,o=$.map(t.target.servers,function(e){return e.sessionId}),a={success:function(s){if(s.success){t.messageId=s.messageId;var r=new EVWEB2.ResponseStatus(!0);e(r,t)}else{var i=new EVWEB2.ResponseStatus(!1,s.errorText);e(i)}},error:function(){var s=new EVWEB2.ResponseStatus(!1,"An error occurred.");e(s)},url:n.url()+EVWEB2.urls.videopush+"/"+s,type:"POST",traditional:!0,data:{s:o,targetId:t.target.id,type:t.type,content:t.generateContent()}};EVWEB2.ajax(a,n)},this.checkMessages=function(e,o){if(""===s){var a=new EVWEB2.ResponseStatus(!1,"GUID not specified for client.");e(a)}var u=o[0].service,c=$.map(o,function(e){return e.sessionId}),E={success:function(s){if(s.success){var a=new EVWEB2.VideoPushTarget("",t,r,i,n),u=$.map(s.events,function(e){var s,t,r=e.content;if(e.type===EVWEB2.VideoPushMessageTypes.displaySettings)s=r;else if(e.type===EVWEB2.VideoPushMessageTypes.liveViews){var i=$.map(r.items,function(e){var s=$.grep(o,function(s){return s.id.toString()===e.server.toString()})[0],t=null;return e.type===EVWEB2.ViewSlotItemTypes.camera?t=EVWEB2.Camera:e.type===EVWEB2.ViewSlotItemTypes.group?t=EVWEB2.Map:e.type===EVWEB2.ViewSlotItemTypes.audio&&(t=EVWEB2.AudioDevice),new EVWEB2.ViewSlotItem(e.id,s,t,e.slot,e.digitalPtzType)}),n=$.map(r.layout_info.slots,function(e){return new EVWEB2.LayoutSlot(e.y,e.x,e.width,e.height)}),u=new EVWEB2.Layout(void 0,r.layout_info.width,r.layout_info.height,r.layout_info.length,n),c=new EVWEB2.ViewFolder("0","","0");s=new EVWEB2.View(r.name,c,i,r.layout,u,void 0,void 0,void 0,r.id)}else if(e.type===EVWEB2.VideoPushMessageTypes.liveTours){var E;(t=$.map(r.folders,function(e,s){var t=s-1;return t<0&&(t=0),new EVWEB2.TourFolder(s.toString(),e,t.toString())})).length>0&&(E=t[t.length-1]);var d=$.map(r.views,function(e){return new EVWEB2.TourItem(e.index,e.dwell,e.view)});s=new EVWEB2.Tour(r.name,E,d,r.description)}var v=new EVWEB2.VideoPushMessage(a,e.sender,s,t);return v.type=e.type,v}),c=new EVWEB2.ResponseStatus(!0);e(c,u)}else{var E=new EVWEB2.ResponseStatus(!1,s.errorText);e(E)}},error:function(){var s=new EVWEB2.ResponseStatus(!1,"An error occurred.");e(s)},url:u.url()+EVWEB2.urls.videopush+"/"+s,type:"GET",traditional:!0,data:{s:c}};EVWEB2.ajax(E,u)}}}(),function(){"use strict";EVWEB2.ServerConfig=function(e){this.server=null,void 0!==e&&(this.server=e),this.getDevicesConfiguration=function(e){var s=this.server;if("function"!=typeof e)throw new Error("Callback required");var t={success:function(t){var r=t.devices,i=$.map(r,function(e){var t=$.map(e.cameras,function(e){return new EVWEB2.DeviceConfigCameraInfo(e.cameraId.toString(),e.parentCameraId.toString(),e.name,e.isPrimary)});return new EVWEB2.DeviceConfig(e.id,e.name,e.host,e.port,e.type,e.model,e.macAddress,e.firmware,e.enabled,e.isConnected,t,e.user,s,e.serial,e.videoStandard)}),n=new EVWEB2.ResponseStatus(!0);e(n,i,s)},error:function(){var s=new EVWEB2.ResponseStatus(!1,"An error occurred.");e(s)},url:s.service.url()+EVWEB2.urls.devices,data:{s:s.sessionId}};EVWEB2.ajax(t,s.service)},this.getDeviceTypes=function(e){var s=this.server;if("function"!=typeof e)throw new Error("Callback required");var t={success:function(s){var t=s.deviceTypes,r=$.map(t,function(e){return new EVWEB2.DeviceTypeInfo(e.name,e.defaultUser,e.defaultPassword,e.defaultPort)}),i=new EVWEB2.ResponseStatus(!0);e(i,r)},error:function(){var s=new EVWEB2.ResponseStatus(!1,"An error occurred.");e(s)},url:s.service.url()+EVWEB2.urls.deviceTypes,data:{s:s.sessionId}};EVWEB2.ajax(t,s.service)},this.addDevice=function(e,s,t){var r=this.server;if("function"!=typeof e)throw new Error("Callback required");var i={s:r.sessionId,host:s.hostName,port:s.port,user:s.username,enabled:s.enabled,deviceType:s.type};void 0!==t&&(i.password=t);var n={url:r.service.url()+EVWEB2.urls.devices,success:function(s){if(s.success){var t=new EVWEB2.ResponseStatus(!0);e(t)}else{var r=new EVWEB2.ResponseStatus(!1,s.errorText);e(r)}},error:function(){var s=new EVWEB2.ResponseStatus(!1,"An error occurred.");e(s)},type:"POST",data:i};EVWEB2.ajax(n,r.service,!0)},this.getArchiveTargets=function(e){if("function"!=typeof e)throw new Error("Callback required");var s=this.server,t={url:s.service.url()+EVWEB2.urls.archiveTargets,type:"GET",data:{s:s.sessionId},success:function(t){if(t.success){var r=[];t.archiveTargets.forEach(function(e){var t=new EVWEB2.ArchiveUploadConfig(e.upload.address,e.upload.hasBookmarks,e.upload.percentToUse,e.upload.username,e.upload.password,e.upload.mountPoint,e.upload.desiredContentAge,e.upload.expirationType,e.upload.expirationDuration),i=new EVWEB2.ArchiveSearchConfig(e.search.enabled,e.search.address,e.search.username,e.search.password),n=new EVWEB2.ArchiveTarget(s,e.id,e.enabled,e.type,t,i);r.push(n)}),e(new EVWEB2.ResponseStatus(!0),r)}else e(new EVWEB2.ResponseStatus(!1,t.errorText))},error:function(){e(new EVWEB2.ResponseStatus(!1,"An error occurred."))}};EVWEB2.ajax(t,s.service,!0)}}}(),function(){"use strict";EVWEB2.videoStandards={none:0,ntsc:1,pal:2,unknown:3},EVWEB2.DeviceConfigCameraInfo=function(e,s,t,r){this.id="",this.parentId="",this.name="",this.isPrimary=!1,void 0!==e&&(this.id=e),void 0!==s&&(this.parentId=s),void 0!==t&&(this.name=t),void 0!==r&&(this.isPrimary=r)},EVWEB2.DeviceTypeInfo=function(e,s,t,r){this.name="",this.username="",this.password="",this.port=0,void 0!==e&&(this.name=e),void 0!==s&&(this.username=s),void 0!==t&&(this.password=t),void 0!==r&&(this.port=r)},EVWEB2.DeviceConfig=function(e,s,t,r,i,n,o,a,u,c,E,d,v,h,l){this.name="",this.hostName="",this.port=0,this.username="",this.type="",this.id=0,this.enabled=!1,this.model="",this.macAddress="",this.serial="",this.firmware="",this.connectionStatus=!1,this.cameraInfo=[],this.server=null,this.videoStandard=EVWEB2.videoStandards.none,void 0!==s&&(this.name=s),void 0!==t&&(this.hostName=t),void 0!==r&&(this.port=r),void 0!==d&&(this.username=d),void 0!==i&&(this.type=i),void 0!==e&&(this.id=e),void 0!==u&&(this.enabled=Boolean(u)),void 0!==n&&(this.model=n),void 0!==o&&(this.macAddress=o),void 0!==a&&(this.firmware=a),void 0!==c&&(this.connectionStatus=c),void 0!==E&&(this.cameraInfo=E),void 0!==v&&(this.server=v),void 0!==h&&(this.serial=h),void 0!==l&&(this.videoStandard=l),this.deleteDevice=function(e){var s=this.server;if("function"!=typeof e)throw new Error("Callback required");var t={s:s.sessionId,id:this.id},r={success:function(s){if(s.success){var t=new EVWEB2.ResponseStatus(!0);e(t)}else{var r=new EVWEB2.ResponseStatus(!1,s.errorText);e(r)}},error:function(){var s=new EVWEB2.ResponseStatus(!1,"An error occurred.");e(s)},url:s.service.url()+EVWEB2.urls.devices,type:"DELETE",data:t};EVWEB2.ajax(r,s.service)},this.updateDevice=function(e,s){var t=this.server;if("function"!=typeof e)throw new Error("Callback required");var r={s:t.sessionId,id:this.id,host:this.hostName,port:this.port,user:this.username,enabled:this.enabled};void 0!==s&&(r.password=s);var i={success:function(s){if(s.success){var t=new EVWEB2.ResponseStatus(!0);e(t)}else{var r=new EVWEB2.ResponseStatus(!1,s.errorText);e(r)}},error:function(){var s=new EVWEB2.ResponseStatus(!1,"An error occurred.");e(s)},url:t.service.url()+EVWEB2.urls.devices,type:"PUT",data:r};EVWEB2.ajax(i,t.service)}}}(),function(){"use strict";EVWEB2.LiveUserPermissions=function(e,s,t,r,i,n,o,a,u,c,E,d){this.base=!1,this.groups=!1,this.maps=!1,this.views=!1,this.quickReplay=!1,this.ptz=!1,this.twoWayAudio=!1,this.eventMonitor=!1,this.saveImage=!1,this.printImage=!1,this.cameras=!1,this.videoPush=!1,(void 0===e||(this.base=e,this.base))&&(void 0!==s&&(this.groups=s),void 0!==t&&(this.maps=t),void 0!==r&&(this.views=r),void 0!==i&&(this.quickReplay=i),void 0!==n&&(this.ptz=n),void 0!==o&&(this.twoWayAudio=o),void 0!==a&&(this.eventMonitor=a),void 0!==u&&(this.saveImage=u),void 0!==c&&(this.printImage=c),void 0!==E&&(this.cameras=E),void 0!==d&&(this.videoPush=d))},EVWEB2.SearchUserPermissions=function(e,s,t,r,i,n,o,a,u,c,E,d){this.base=!1,this.groups=!1,this.maps=!1,this.views=!1,this.events=!1,this.saveImage=!1,this.printImage=!1,this.burnDisc=!1,this.exportVideo=!1,this.smartSearch=!1,this.cases=!1,this.cameras=!1,(void 0===e||(this.base=e,this.base))&&(void 0!==s&&(this.groups=s),void 0!==t&&(this.maps=t),void 0!==r&&(this.views=r),void 0!==i&&(this.events=i),void 0!==n&&(this.saveImage=n),void 0!==o&&(this.printImage=o),void 0!==a&&(this.burnDisc=a),void 0!==u&&(this.exportVideo=u),void 0!==c&&(this.smartSearch=c),void 0!==E&&(this.cases=E),void 0!==d&&(this.cameras=d))},EVWEB2.ConfigUserPermissions=function(e,s){this.userAdmin=!1,this.viewAdmin=!1,void 0!==e&&(this.userAdmin=e),void 0!==s&&(this.viewAdmin=s)},EVWEB2.UserPermissions=function(e,s,t,r){this.livePermissions=null,this.searchPermissions=null,this.configPermissions=null,this.accessLevel=EVWEB2.accessLevelType.unknown,void 0!==e&&(this.livePermissions=e),void 0!==s&&(this.searchPermissions=s),void 0!==t&&(this.configPermissions=t),void 0!==r&&(this.accessLevel=r)}}(),function(){"use strict";EVWEB2.accountTypes={local:0,ldap:1},EVWEB2.User=function(e,s,t,r,i,n){this.server=null,this.username="",this.groupName="",this.accountType=EVWEB2.accountTypes.local,this.isManaged=!1,void 0!==e&&(this.server=e),void 0!==s&&(this.username=s),void 0!==t&&(this.groupName=t),void 0!==r&&(this.accountType=r),r===EVWEB2.accountTypes.ldap&&void 0!==i&&(this.isOrphaned=i),void 0!==n&&(this.isManaged=n);var o=this.username;this.deleteUser=function(e){var s=this.server;if("function"!=typeof e)throw new Error("Callback required");var t={s:s.sessionId,user:this.username},r={success:function(s){if(s.success){var t=new EVWEB2.ResponseStatus(!0);e(t)}else{var r=new EVWEB2.ResponseStatus(!1,s.errorText);e(r)}},error:function(){var s=new EVWEB2.ResponseStatus(!1,"An error occurred.");e(s)},url:s.service.url()+EVWEB2.urls.users,type:"DELETE",data:t};EVWEB2.ajax(r,s.service)},this.update=function(e,s,t){var r=this.server,i=this;if("function"!=typeof e)throw new Error("Callback required");var n={s:r.sessionId,name:this.username,role:s.accessLevel,accountType:this.accountType};if(void 0!==s){var a=EVWEB2.util.internal.generatePermissionsBitmask(s.permissions);n.guid=s.guid,n.grpName=s.name,n.grpGroupPermission=a.group,n.grpUserPermission=a.user,n.grpAdminPermission=a.admin,n.grpCameras=s.customGroupPermissions.cameras.join(","),n.grpAudios=s.customGroupPermissions.audios.join(","),n.grpSerials=s.customGroupPermissions.serials.join(","),n.grpSoftTriggers=s.customGroupPermissions.softTriggers.join(",")}""!==o&&o!==this.username&&(n.originalName=o),void 0!==t&&""!==t&&(n.password=t);var u=s.getPriority(EVWEB2.groupPriorityTypes.ptz);void 0!==u&&(n.grpPtzPriority=u.value),void 0!==(u=s.getPriority(EVWEB2.groupPriorityTypes.twoWayAudio))&&(n.grpAudioPriority=u.value),void 0!==(u=s.getPriority(EVWEB2.groupPriorityTypes.client))&&(n.grpRemotePriority=u.value);var c={success:function(s){if(s.success){i.username!==o&&(o=i.username);var t=new EVWEB2.ResponseStatus(!0);e(t)}else{var r=new EVWEB2.ResponseStatus(!1,s.errorText);e(r)}},error:function(){var s=new EVWEB2.ResponseStatus(!1,"An error occurred.");e(s)},url:r.service.url()+EVWEB2.urls.users,type:"PUT",data:n};EVWEB2.ajax(c,r.service)}}}(),EVWEB2.groupPriorityTypes={none:0,ptz:1,twoWayAudio:2,client:3},EVWEB2.UserGroupPermissions=function(e){this.permissions=[],void 0!==e&&(this.permissions=e),this.hasPermission=function(e){return-1!==$.inArray(e,this.permissions)},this.hasAnyPermissions=function(e){var s,t=this.permissions;for(s=0;s<e.length;s++)if(-1!==$.inArray(e[s],t))return!0;return!1},this.hasAllPermissions=function(e){var s=this.permissions,t=!0;return $.each(e,function(e,r){t=-1!==$.inArray(r,s)&&t}),t}},EVWEB2.CustomGroupPermissions=function(e,s,t,r){this.cameras=[],this.audios=[],this.serials=[],this.softTriggers=[],void 0!==e&&(this.cameras=e),void 0!==s&&(this.audios=s),void 0!==t&&(this.serials=t),void 0!==r&&(this.softTriggers=r)},EVWEB2.UserGroupPriority=function(e,s){this.priority=EVWEB2.groupPriorityTypes.none,this.value=-1,void 0!==e&&(this.priority=e),void 0!==s&&(this.value=s)},EVWEB2.UserGroup=function(e,s,t,r,i,n,o){this.name="",this.accessLevel=EVWEB2.accessLevelType.unknown,this.permissions=null,this.priorities=[],this.guid="",this.customGroupPermissions=null,this.isManaged=!1,void 0!==e&&(this.name=e),void 0!==s&&(this.accessLevel=s),void 0!==t&&(this.permissions=t),void 0!==r&&(this.priorities=r),void 0!==i&&(this.guid=i),void 0!==n&&(this.customGroupPermissions=n),void 0!==o&&(this.isManaged=o),this.getPriority=function(e){for(var s=0;s<this.priorities.length;++s)if(this.priorities[s].priority===e)return this.priorities[s]},this.setPriority=function(e,s){var t=this.getPriority(e);void 0!==t?t.value=s:this.priorities.push(new EVWEB2.UserGroupPriority(e,s))}},function(){"use strict";EVWEB2.EventMonitorProfileTypes={Unknown:-1,Video:0,View:1},EVWEB2.EventMonitorLinkSourceTypes={None:0,SoftTrigger:1,TimeTrigger:2,InputTrigger:3,VideoLoss:4,VideoMotion:5,DisconnectDevice:6,SerialPort:7,SerialProfile:8,Health:9,Button:10,Analytics:11,Group:12,DisconnectVideo:13,DisconnectAudio:14,AutoConnection:15,Default:16,SecurityIntegration:17,SecurityIntegrationConnected:18,SerialPortConnection:19},EVWEB2.EventMonitorLinkTargetTypes={None:0,View:1,Sound:2,Tour:3,Video:4,Log:5,DigitalPreset:6,Audio:7},EVWEB2.EventMonitorLinkEvent=function(e,s,t){this.eventLink=null,this.sourceId="",this.extraId="",void 0!==e&&(this.eventLink=e),void 0!==s&&(this.sourceId=s),void 0!==t&&(this.extraId=t)},EVWEB2.EventMonitorLinkSource=function(e,s,t,r,i){this.server="",this.id="",this.type=EVWEB2.EventMonitorLinkSourceTypes.None,this.extraId="",this.any=!1,void 0!==e&&(this.server=e),void 0!==s&&(this.id=s),void 0!==t&&(this.type=t),void 0!==r&&(this.extraId=r),void 0!==i&&(this.any=i)},EVWEB2.EventMonitorLinkTarget=function(e,s,t,r,i){this.server="",this.value="",this.type=EVWEB2.EventMonitorLinkTargetTypes.None,this.extraId="",this.folders=[],void 0!==e&&(this.server=e),void 0!==s&&(this.value=s),void 0!==t&&(this.type=t),void 0!==r&&(this.extraId=r),void 0!==i&&(this.folders=i)},EVWEB2.EventMonitorLink=function(e,s,t,r,i,n,o,a,u){this.service=null,this.profile=null,this.guid="",this.source=null,this.target=null,this.priority=1,this.confirm=!1,this.timeout=0,this.message="",void 0!==e&&(this.service=e),void 0!==s&&(this.profile=s),void 0!==t&&(this.guid=t),void 0!==r&&(this.source=r),void 0!==i&&(this.target=i),void 0!==n&&(this.priority=n),void 0!==o&&(this.confirm=o),void 0!==a&&(this.timeout=a),void 0!==u&&(this.message=u),this.applyUpdate=function(e){var s={guid:this.guid,priority:this.priority,confirm:this.confirm,timeout:this.timeout,message:this.message};null!==this.source?(s.eventSourceId=this.source.id,s.eventSourceServer=this.source.server,s.eventSourceType=this.source.type,s.eventSourceExtra=this.source.extraId,s.eventSourceAny=this.source.any):(s.eventSourceServer=this.target.server,s.eventSourceType=EVWEB2.EventMonitorLinkSourceTypes.None),null!==this.target?(s.eventTargetId=this.target.value,s.eventTargetServer=this.target.server,s.eventTargetType=this.target.type,s.eventTargetExtra=this.target.extraId,s.eventTargetFolderName=this.target.folders):(s.eventTargetServer=this.source.server,s.eventTargetType=EVWEB2.EventMonitorLinkTargetTypes.None);var t={success:function(s){var t=new EVWEB2.ResponseStatus(s.success,s.errorText);e(t)},error:function(s){var t=new EVWEB2.ResponseStatus(!1,EVWEB2.util.getErrorText(s));e(t)},type:"PUT",url:this.service.url()+EVWEB2.urls.eventMonitoring+"/"+this.profile.name,traditional:!0,data:s};EVWEB2.ajax(t,this.service)}},EVWEB2.EventMonitorProfile=function(e,s,t,r,i,n,o){this.service=null,this.name="",this.type=EVWEB2.EventMonitorProfileTypes.unknown,this.description="",this.showEventsList=!1,this.showNewest=!1,this.events=[],void 0!==e&&(this.service=e),void 0!==s&&(this.name=s),void 0!==t&&(this.type=t),void 0!==r&&(this.description=r),void 0!==i&&(this.showEventsList=i),void 0!==n&&(this.showNewest=n),void 0!==o&&(this.events=o);var a=function(e){var s=[];return $.each(e,function(e,t){null!==t.source&&t.source.type!==EVWEB2.EventMonitorLinkSourceTypes.None&&-1===$.inArray(t.source.server,s)&&s.push(t.source.server),null!==t.target&&t.target.type!==EVWEB2.EventMonitorLinkTargetTypes.None&&-1===$.inArray(t.target.server,s)&&s.push(t.target.server)}),s};this.checkEventLinks=function(e,s){var t=this;void 0===s&&(s=3);var r={s:a(this.events),duration:s},i={success:function(s){var r=s.triggeredEvents.reduce(function(e,s){var r=$.grep(t.events,function(e){return e.guid===s.guid})[0];return r&&e.push(new EVWEB2.EventMonitorLinkEvent(r,s.id,s.extraId)),e},[]),i=new EVWEB2.ResponseStatus(s.success);e(i,r)},error:function(s){var t=new EVWEB2.ResponseStatus(!1,EVWEB2.util.getErrorText(s));e(t)},traditional:!0,url:this.service.url()+EVWEB2.urls.eventMonitoring+"/"+this.name,data:r};EVWEB2.ajax(i,this.service)},this.update=function(e){var s={name:this.name,description:this.description,type:this.type,showEventsList:this.showEventsList,showNewestEvent:this.showNewest,s:a(this.events)},t={success:function(s){var t=new EVWEB2.ResponseStatus(s.success,s.errorText);e(t)},error:function(s){var t=new EVWEB2.ResponseStatus(!1,EVWEB2.util.getErrorText(s));e(t)},type:"PUT",traditional:!0,url:this.service.url()+EVWEB2.urls.eventMonitoring,data:s};EVWEB2.ajax(t,this.service)},this.addLink=function(e,s){var t={eventConfirm:s.confirm,eventMessage:s.message,eventTimeout:s.timeout,eventPriority:s.priority};null!==s.source?(t.eventSourceId=s.source.id,t.eventSourceServer=s.source.server,t.eventSourceType=s.source.type,t.eventSourceExtra=s.source.extraId,t.eventSourceAny=s.source.any):(t.eventSourceServer=s.target.server,t.eventSourceType=EVWEB2.EventMonitorLinkSourceTypes.None),null!==s.target?(t.eventTargetValue=s.target.value,t.eventTargetServer=s.target.server,t.eventTargetType=s.target.type,t.eventTargetExtra=s.target.extraId,t.eventTargetFolders=s.target.folders):(t.eventTargetServer=s.source.server,t.eventTargetType=EVWEB2.EventMonitorLinkTargetTypes.None);var r={success:function(t){if(t.success){var r=t.event,i=r.source;s.source=new EVWEB2.EventMonitorLinkSource,null!==i&&(s.source=new EVWEB2.EventMonitorLinkSource(i.server,i.id,i.type,i.extra,i.any));var n=r.target;s.target=new EVWEB2.EventMonitorLinkTarget,null!==n&&(s.target=new EVWEB2.EventMonitorLinkTarget(n.server,n.value,n.type,n.extra,n.folders)),s.guid=r.guid,s.priority=r.priority,s.confirm=r.confirm,s.timeout=r.timeout,s.message=r.message;var o=new EVWEB2.ResponseStatus(t.success);e(o,s)}else e(new EVWEB2.ResponseStatus(t.success,t.errorText))},error:function(s){var t=new EVWEB2.ResponseStatus(!1,EVWEB2.util.getErrorText(s));e(t)},type:"POST",url:this.service.url()+EVWEB2.urls.eventMonitoring+"/"+this.name,data:t};EVWEB2.ajax(r,this.service)},this.removeLink=function(e,s){var t={s:a([s]),guid:s.guid},r={success:function(s){var t=new EVWEB2.ResponseStatus(s.success,s.errorText);e(t)},error:function(s){var t=new EVWEB2.ResponseStatus(!1,EVWEB2.util.getErrorText(s));e(t)},type:"DELETE",traditional:!0,url:this.service.url()+EVWEB2.urls.eventMonitoring+"/"+this.name,data:t};EVWEB2.ajax(r,this.service)},this.deleteProfile=function(e){var s={s:a(this.events),name:this.name},t={success:function(s){var t=new EVWEB2.ResponseStatus(s.success,s.errorText);e(t)},error:function(s){var t=new EVWEB2.ResponseStatus(!1,EVWEB2.util.getErrorText(s));e(t)},type:"DELETE",traditional:!0,url:this.service.url()+EVWEB2.urls.eventMonitoring,data:s};EVWEB2.ajax(t,this.service)},this.pushNotificationSubscribe=function(e,s,t){var r={id:s,profile:this.name,guid:t.guid},i={success:function(s){var t=new EVWEB2.ResponseStatus(s.success,s.errorText);e(t)},error:function(s){var t=new EVWEB2.ResponseStatus(!1,EVWEB2.util.getErrorText(s));e(t)},url:this.service.url()+EVWEB2.urls.eventMonitoringPush,type:"POST",data:r};EVWEB2.ajax(i,this.service)},this.pushNotificationUnsubscribe=function(e,s,t){var r={id:s,profile:this.name,guid:t.guid},i={success:function(s){var t=new EVWEB2.ResponseStatus(s.success,s.errorText);e(t)},error:function(s){var t=new EVWEB2.ResponseStatus(!1,EVWEB2.util.getErrorText(s));e(t)},url:this.service.url()+EVWEB2.urls.eventMonitoringPush,type:"DELETE",data:r};EVWEB2.ajax(i,this.service)}}}(),function(){"use strict";EVWEB2.PushNotificationClientType={APNS:0,GCM:1,MPNS:2},EVWEB2.PushNotification=function(e){this.service=null,void 0!==e&&(this.service=e),this.getPublicKey=function(e){var s={success:function(s){var t;if(!s.success)return t=new EVWEB2.ResponseStatus(s.success,s.errorText),void e(t);t=new EVWEB2.ResponseStatus(!0),e(t,s.key)},error:function(s){var t=new EVWEB2.ResponseStatus(!1,EVWEB2.util.getErrorText(s));e(t)},url:this.service.url()+EVWEB2.urls.pushNotification};EVWEB2.ajax(s,this.service)},this.registerClient=function(e,s,t,r){var i={type:s,token:t};void 0!==r&&(i.encrypted=r);var n={success:function(s){var t;if(!s.success)return t=new EVWEB2.ResponseStatus(s.success,s.errorText),void e(t);t=new EVWEB2.ResponseStatus(!0),e(t,s.id)},error:function(s){var t=new EVWEB2.ResponseStatus(!1,EVWEB2.util.getErrorText(s));e(t)},url:this.service.url()+EVWEB2.urls.pushNotification,type:"POST",data:i};EVWEB2.ajax(n,this.service)},this.updateClientToken=function(e,s,t,r){var i={id:s,newtoken:t};void 0!==r&&(i.encrypted=r);var n={success:function(s){var t;if(!s.success)return t=new EVWEB2.ResponseStatus(s.success,s.errorText),void e(t);t=new EVWEB2.ResponseStatus(!0),e(t,s.id)},error:function(s){var t=new EVWEB2.ResponseStatus(!1,EVWEB2.util.getErrorText(s));e(t)},url:this.service.url()+EVWEB2.urls.pushNotification,type:"PUT",data:i};EVWEB2.ajax(n,this.service)},this.unregisterClient=function(e,s){var t={id:s},r={success:function(s){var t=new EVWEB2.ResponseStatus(s.success,s.errorText);e(t)},error:function(s){var t=new EVWEB2.ResponseStatus(!1,EVWEB2.util.getErrorText(s));e(t)},url:this.service.url()+EVWEB2.urls.pushNotification,type:"DELETE",data:t};EVWEB2.ajax(r,this.service)}}}(),function(){"use strict";var e=1,s=3,t=4,r=5,i=6;EVWEB2.websocketErrorCodes={unknownTopic:-1,unknownSubscription:-2,disabled:-3,connectionLost:-4,sendFailed:-5,loginRequired:-6};var n=function(e,s){for(var t=e.rawTopicStr,r=e.idTypes,i=[],n=function(e){return function(e,s){for(var t=0;t<s.length;++t)if(e instanceof s[t])return!0;return!1}(e,[EVWEB2.Camera,EVWEB2.DeviceConfig,EVWEB2.Trigger])?e.id:e.toString()},o=0;o<r.length;++o)i.push(n(s[o]));return function(e,s){for(var t=e,r=s.length;r--;)t=t.replace(new RegExp("\\{"+r+"\\}","gm"),s[r]);return t}(t,i)};EVWEB2.pubSubTopic={server:{rawTopicStr:"nvr.config.server",idTypes:[]},serverStatus:{rawTopicStr:"nvr.status.server",idTypes:[]},devices:{rawTopicStr:"nvr.config.devices",idTypes:[]},cameraOsd:{rawTopicStr:"nvr.config.cameras.settings.osd",idTypes:[]},users:{rawTopicStr:"nvr.config.users",idTypes:[]},userGroups:{rawTopicStr:"nvr.config.userGroups",idTypes:[]},cameras:{rawTopicStr:"nvr.config.cameras",idTypes:[]},activeUsers:{rawTopicStr:"nvr.config.users.active",idTypes:[]},triggers:{rawTopicStr:"nvr.status.softtriggers",idTypes:[]},motion:{rawTopicStr:"nvr.status.camera.motion",idTypes:[]},loss:{rawTopicStr:"nvr.status.camera.loss",idTypes:[]},cameraConnection:{rawTopicStr:"nvr.status.camera.connection",idTypes:[]},deviceConnection:{rawTopicStr:"nvr.status.device.connection",idTypes:[]},plugins:{rawTopicStr:"nvr.config.plugins",idTypes:[]},avgFrameSize:{rawTopicStr:"nvr.video.camera.{0}.stats.avg_frame_size",idTypes:[EVWEB2.Camera]},videoH264:{rawTopicStr:"nvr.video.camera.{0}.native",idTypes:[EVWEB2.Camera]},videoJPEG:{rawTopicStr:"nvr.video.camera.{0}.jpeg",idTypes:[EVWEB2.Camera]},securityIntegrationDevices:{rawTopicStr:"nvr.config.securityintegrations.devices",idTypes:[]},securityIntegrationSensors:{rawTopicStr:"nvr.config.securityintegrations.sensors",idTypes:[]},securityIntegrationSensorStatus:{rawTopicStr:"nvr.status.securityintegrations.sensors",idTypes:[]},securityIntegrationDeviceConnection:{rawTopicStr:"nvr.status.securityintegrations.devices.connection",idTypes:[]},associations:{rawTopicStr:"nvr.config.associations",idTypes:[]}};var o=1,a=2,u=4,c=224,E=function(e,s,t,r){this.ack=!1,this.isBinary=!1,this.isBigEndian=!1,this.version=0,void 0!==e&&(this.ack=e),void 0!==s&&(this.isBinary=s),void 0!==t&&(this.isBigEndian=t),void 0!==r&&(this.version=r),this.bitmask=function(){var e=0;return e|=this.ack?o:0,e|=this.isBinary?u:0,e|=this.isBigEndian?a:0,e|=(7&this.version)<<5},this.setFromBitmask=function(e){this.ack=Boolean(e&o),this.isBinary=Boolean(e&u),this.isBigEndian=Boolean(e&a),this.version=(e&c)>>5}},d=function(e,s,t,r){this.requestId=e,this.topic=s,this.messageType=t,this.flags=r,this.marshal=function(){return{request:this.messageType,rid:this.requestId,topic:this.topic,flags:this.flags.bitmask(),subProtocol:0,subProtocolFlags:0}}},v=function(e,t){e.messageType=s,this.hdr=e,this.requestedSid="",void 0!==t&&""!==t&&(this.requestedSid=t),this.marshal=function(){var e={};return""!==this.requestedSid&&(e.requestedSID=this.requestedSid),{header:this.hdr.marshal(),payload:{options:e}}}};EVWEB2.JsonSerializer=function(){this.isBinary=!1,this.serialize=function(e){return JSON.stringify(e)},this.unserialize=function(e){return JSON.parse(e)}},EVWEB2.CompositeSerializer=function(){this.isBinary=!0;var e=new EVWEB2.JsonSerializer,s={0:e},t=function(t){var r=s[(24&t)>>3];return void 0===r?e:r};this.serialize=function(e){return(new function(){this.offset=0,this.writeString=function(e,s){for(var t=this.offset,r=0;r<s.length;++r,++t){var i=s.charCodeAt(r);e.setUint8(t,i)}this.offset=t},this.writeUUID=function(e,s){for(var t=uuid.parse(s),r=0;r<t.length;++r)e.setUint8(this.offset,t[r]),this.offset+=1},this.writeHeader=function(e,s,t,r){e.setUint8(this.offset++,s.request),e.setUint16(this.offset,s.flags),this.offset+=2,e.setUint8(this.offset++,0),e.setUint8(this.offset++,0),e.setUint8(this.offset++,0),this.writeUUID(e,s.rid);var i=s.topic.length;e.setUint16(this.offset,i),this.offset+=2,e.setUint32(this.offset,t),this.offset+=4,e.setUint32(this.offset,r),this.offset+=4,this.writeString(e,s.topic)},this.encode=function(e){var s=t(e.header.flags),r=s.serialize(e.payload),i=e.header,n="";void 0!==e.blob&&""!==e.blob&&(n=e.blob);var o=0,a=0;s.isBinary?(o=r.byteLength,a=n.byteLength):(o=r.length,a=n.length);var u=32+i.topic.length+o+a,c=new ArrayBuffer(u),E=new DataView(c);return this.writeHeader(E,i,o,a),s.isBinary||(this.writeString(E,r),this.writeString(E,n)),c}}).encode(e)},this.unserialize=function(e){return new function(e,s){this.view=e,this.offset=s||0,this.readString=function(e,s){for(var t="",r=e,i=e+s;r<i;++r){var n=this.view.getUint8(r);t+=String.fromCharCode(n),this.offset+=1}return t},this.readUUID=function(e){for(var s=new Array(16),t=e,r=e+16;t<r;++t)s[t-e]=this.view.getUint8(t);return this.offset+=16,uuid.unparse(s)},this.readHeader=function(){var s={request:0,rid:"",flags:0,topic:"",subProtocol:0,subProtocolFlags:0,dataLength:0,blobLength:0};s.request=e.getUint8(this.offset++),s.flags=e.getUint16(this.offset),this.offset+=2,s.subProtocol=e.getUint8(this.offset++),s.subProtocolFlags=e.getUint8(this.offset++),this.offset++,s.rid=this.readUUID(this.offset);var t=e.getUint16(this.offset);return this.offset+=2,s.dataLength=e.getUint32(this.offset),this.offset+=4,s.blobLength=e.getUint32(this.offset),this.offset+=4,s.topic=this.readString(this.offset,t),s},this.parse=function(){var s,r=this.readHeader(),i=t(r.flags);i.isBinary?(s=this.view.buffer.slice(this.offset,this.offset+r.dataLength),this.offset+=r.dataLength):s=this.readString(this.offset,r.dataLength);var n,o={header:r,payload:i.unserialize(s)};return r.blobLength>0&&(n=e.buffer.slice(this.offset,this.offset+r.blobLength),this.offset+=r.blobLength,o.payload.data.blob=n),delete o.header.blobLength,delete o.header.dataLength,o}}(new DataView(e)).parse()}};var h=function(e,s){for(var t=s.args,r=t[0],i=t[1],n=0;n<e.length;++n)e[n].externalCallback(e[n],r,i)},l={"nvr.status.softtriggers":function(e,s){for(var t=s.args,r=t[0],i=t[1],n=t[2],o=new EVWEB2.Trigger(e[0].server,r,i,n),a=0;a<e.length;++a)e[a].externalCallback(e[a],o)},"nvr.status.camera.motion":function(e,s){for(var t=s.args,r=t[0],i=t[1],n=0;n<e.length;++n)e[n].externalCallback(e[n],r,i)},"nvr.status.camera.loss":function(e,s){for(var t=s.args,r=t[0],i=t[1],n=0;n<e.length;++n)e[n].externalCallback(e[n],r,i)},"nvr.config.users.active":function(e,s){for(var t=s.args[0],r=$.map(t,function(e){return new EVWEB2.SystemUsageInfo(e.username,e.level,e.address,e.streams,e.audit,e.instanceName)}),i=0;i<e.length;++i)e[i].externalCallback(e[i],r)},"nvr.status.camera.connection":h,"nvr.status.device.connection":h,"nvr.config.cameras":function(e,s){for(var t=s.args[0],r=e[0].server,i=$.map(t,function(e){return function(e,s){var t,r=0!==e.disabled,i=0===e.state,n=1===e.ptz,o=EVWEB2.ptzTypes.none;return n&&(o=EVWEB2.ptzTypes.standard),void 0===e.id&&(e.id=EVWEB2.util.pidToCameraId(e.p,e.i,e.d,e.ctx)),void 0!==e.resolution&&(t=new EVWEB2.CameraResolution(e.resolution.width,e.resolution.height)),new EVWEB2.Camera(s,e.id,e.ctx,e.name,n,r,i,e.OSD,o,e.digitalPtz,e.formats,t,e.quality,e.frameRate)}(e,r)}),n=0;n<e.length;++n)e[n].externalCallback(e[n],i)},"nvr.config.users":function(e,s){for(var t=s.args[0],r=e[0].server,i=$.map(t,function(e){return new EVWEB2.User(r,e.name,e.groupName,e.accountType,e.isOrphaned)}),n=0;n<e.length;++n)e[n].externalCallback(e[n],i)},"nvr.config.userGroups":function(e,s){for(var t=s.args[0],r=$.map(t,function(e){var s=e.role,t=EVWEB2.util.internal.processUserGroupPermissions(e.permissions),r=$.map(e.priorities,function(e){return new EVWEB2.UserGroupPriority(e.priority,e.value)}),i=new EVWEB2.CustomGroupPermissions(e.cameras,e.audios,e.serials,e.softTriggers);return new EVWEB2.UserGroup(e.name,s,t,r,e.guid,i)}),i=0;i<e.length;++i)e[i].externalCallback(e[i],r)},"nvr.config.devices":function(e,s){for(var t=s.args[0],r=e[0].server,i=$.map(t,function(e){var s=$.map(e.cameras,function(e){return new EVWEB2.DeviceConfigCameraInfo(e.cameraId.toString(),e.parentCameraId.toString(),e.name,e.isPrimary)});return new EVWEB2.DeviceConfig(e.id,e.name,e.host,e.port,e.type,e.model,e.macAddress,e.firmware,e.enabled,e.isConnected,s,e.user,r,e.serial)}),n=0;n<e.length;++n)e[n].externalCallback(e[n],i)},"nvr.config.cameras.settings.osd":function(e,s){for(var t=s.args[0],r=$.map(t,function(e){return{osdInfo:EVWEB2.util.internal.formatOsdInfo(e.osdInfo),cameraId:e.cameraId}}),i=0;i<e.length;++i)e[i].externalCallback(e[i],r)},"nvr.config.plugins":function(e,s){for(var t=s.args[0],r=$.map(t,function(e){return new EVWEB2.SystemPluginInfo(e.name,e.filename,e.version,e.isOpen,e.openCode)}),i=0;i<e.length;++i)e[i].externalCallback(e[i],r)},"nvr.config.server":function(e,s){var t=s.args[0],r=t.id;void 0!==r&&(r=r.toString());var i,n,o,a=EVWEB2.util.internal.processServerDetails(t),u=EVWEB2.util.internal.processServerLicense(t);if(void 0!==t.group&&null!==t.group){var c=t.group,E=EVWEB2.util.internal.processUserGroupPermissions(c.permissions);i=new EVWEB2.CustomGroupPermissions(c.cameras,c.audios,c.serials,c.softTriggers),n=new EVWEB2.UserGroup(c.name,c.role,E,c.priorities,c.guid,i)}else n=EVWEB2.util.processServerPermissions(t);t.login||(o=n,n=void 0);for(var d=e[0].server.service,v=e[0].server.sessionId,h=new EVWEB2.Server(d,t.name,r,t.login,t.restricted,v,void 0,void 0,a,u,n,o),l=0;l<e.length;++l)e[l].externalCallback(e[l],h)},"nvr.status.server":function(e,s){for(var t=s.args[0],r=0;r<e.length;++r)e[r].externalCallback(e[r],t)},"nvr.video.camera.{0}.stats.avg_frame_size":function(e,s){for(var t=s.args,r=t[0].toString(),i=t[1],n=0;n<e.length;++n)e[n].externalCallback(e[n],r,i)},"nvr.video.camera.{0}.native":function(e,s){for(var t=s.args,r=t[0].toString(),i=t[1],n=EVWEB2.util.IETF2Date(t[2]),o=t[3],a=s.blob,u=0;u<e.length;++u)e[u].externalCallback(e[u],r,a,i,n,o)},"nvr.video.camera.{0}.jpeg":function(e,s){for(var t=s.args,r=t[0].toString(),i=EVWEB2.util.IETF2Date(t[1]),n=t[2],o=s.blob,a=new Blob([o],{type:"image/jpeg"}),u=0;u<e.length;++u)e[u].externalCallback(e[u],r,a,i,n)},"nvr.config.securityintegrations.devices":function(e,s){for(var t=e[0].server,r=s.args[0],i=$.map(r,function(e){return new EVWEB2.SecurityIntegrationsDevice(t,e.id,e.name,e.host,e.port,e.type,e.enabled,e.connectionStatus,e.firmware,e.serial,e.user,e.auth)}),n=0;n<e.length;++n)e[n].externalCallback(e[n],i)},"nvr.config.securityintegrations.sensors":function(e,s){for(var t=s.args[0],r=s.args[1],i=$.map(r,function(e){var s=e.statusTimestamp?EVWEB2.util.IETF2Date(e.statusTimestamp):void 0,t=e.persistedStatus?e.persistedStatus.map(function(e){return e.statusTimestamp=EVWEB2.util.IETF2Date(e.statusTimestamp),e}):void 0;return new EVWEB2.SecurityIntegrationsDeviceSensor(void 0,e.sensorId,e.name,e.type,e.direction,e.availableActions,e.inputs,e.defaultActionTimeout,e.maxActionTimeout,e.status,e.alarm,s,e.statusMessage,t)}),n=0;n<e.length;++n)e[n].externalCallback(e[n],t,i)},"nvr.status.securityintegrations.sensors":function(e,s){for(var t=s.args[0],r=0;r<e.length;++r)e[r].externalCallback(e[r],t)},"nvr.status.securityintegrations.devices.connection":function(e,s){for(var t=s.args[0],r=s.args[1],i=0;i<e.length;++i)e[i].externalCallback(e[i],t,r)},"nvr.config.associations":function(e,s){var t=s.args,r={};$.each(t[0],function(s,t){var i=$.map(t.items,function(e){return new EVWEB2.AssociationItem(e.id,e.type,e.position,e.statusOnly,e.extra)}),n=new EVWEB2.FontInfo(t.fontName,t.fontSize,t.fontStyle,t.fontColor,t.fontFamily,t.fontWeight),o=new EVWEB2.Association(e[0].server,void 0,t.guid,i,t.label,t.overlayStyle,t.position,t.backgroundColor,t.opacity,n);r[t.cameraId]=o});for(var i=0;i<e.length;++i)for(var n in r)if(r.hasOwnProperty(n)){var o=parseInt(n,10);e[i].externalCallback(e[i],o,r[o])}}},p=function(e,s,t,r,i,n,o){this.requestId=e,this.server=s,this.topic=t,this.internalCallback=r,this.externalCallback=i,this.onReply=n,this.acknowledge=!1,void 0!==o&&(this.acknowledge=o)};EVWEB2.Subscription=function(e,s,t,r){this.subscriptionId="",this.server=null,this.topic="",this.externalCallback=$.noop,this.isActive=!0,void 0!==e&&(this.subscriptionId=e),void 0!==s&&(this.server=s),void 0!==t&&(this.topic=t),void 0!==r&&(this.externalCallback=r)};var f=function(){return uuid.v4()},m=0,V=1,B=2;EVWEB2.WebsocketConfig=function(e,s,t){if(this.host="",this.port=0,this.sslPort=0,void 0!==e){var r=0,i=e.length;"http://"===e.slice(0,7)?r=7:"https://"===e.slice(0,8)&&(r=8),"/"===e.slice(-1)&&--i,this.host=e.slice(r,i),""===this.host&&(this.host=window.location.hostname)}void 0!==s&&(this.port=s),void 0!==t&&(this.sslPort=t),this.getUrl=function(){return"https:"===window.location.protocol?"wss://"+this.host+":"+this.sslPort:"ws://"+this.host+":"+this.port}},EVWEB2.connectionEvent={open:0,timedOut:1};var W=0;EVWEB2.WebSocketHandler=function(o){this.isLegacy=!1,this.service=null,this.serializer=new EVWEB2.CompositeSerializer;var a=this,u={},c={},h={},g=null,w=$.noop,S=!1,y=m,T=null,I=0,R=null,b=!1;void 0!==o&&(this.service=o);var x,P=function(e){EVWEB2.log("WebsocketHandler::onOpen"),S||(w(EVWEB2.connectionEvent.open),S=!0),y===B&&(I=0,function(){EVWEB2.log("Re-initializing currently active subscriptions");var e=$.extend(!0,{},c);c={},$.each(e,function(e,t){$.each(t.subscriptions,function(r,i){var n=f(),o=$.Deferred();u[n]=new p(n,i.server,e,t.fn,i.externalCallback,o,!0);var c=new d(n,e,s,new E(!0,a.serializer.isBinary)),h=new v(c,i.subscriptionId),l=a.serializer.serialize(h.marshal());try{g.send(l)}catch(e){EVWEB2.log("Error trying to resubscribe: "+e),delete u[n]}})})}()),y=V},k=function(s){var r=s.data,n=a.serializer.unserialize(r);switch(n.header.request){case t:if(void 0===u[n.header.rid])return;var o=u[n.header.rid];delete u[n.header.rid],void 0===c[n.header.topic]&&(c[n.header.topic]=new function(e,s){this.fn=e,this.topic=s,this.subscriptions=[]}(o.internalCallback,n.header.topic));var E=new EVWEB2.Subscription(n.payload.subscriptionId,o.server,n.header.topic,o.externalCallback);c[n.header.topic].subscriptions.push(E),o.onReply.resolve(E);break;case e:var d=c[n.header.topic];if(void 0===d||0===d.subscriptions.length)return;d.fn(d.subscriptions,n.payload.data);break;case i:if(void 0===h[n.header.rid])return;var v=h[n.header.rid];delete h[n.header.rid],v.subscription.isActive=!1,v.onAcknowledge.resolve(v.subscription)}},C=function(e){EVWEB2.log("WebsocketHandler::onError: "+e.reason)},A=function(e){var s=e.getUrl();EVWEB2.log("Initializing WebSocket: "+s),(g=new WebSocket(s)).onopen=P,g.onmessage=k,g.onclose=x,g.onerror=C,g.binaryType="arraybuffer"};x=function(e){if(EVWEB2.log("WebsocketHandler::onClose: reason="+e.reason+", code="+e.code+", wasClean="+e.wasClean),y=B,!b){var s=function(){var e=Math.min(I,19.7),s=Math.pow(2,e)-1;return.0125*Math.floor(Math.random()*s)}();EVWEB2.log("Reconnect attempts: "+I+", reconnecting in "+s),I+=1,R=setTimeout(function(){A(T)},s)}},this.getConfig=function(e){if("function"!=typeof e)throw new Error("Callback required");var s=this,t={success:function(t){var r=new EVWEB2.ResponseStatus(t.success,t.errorText),i=s.service.hostUrl;"/"!==i.substr(i.length-1)&&(i=i.slice(0,i.length-1));var n=new EVWEB2.WebsocketConfig(i,t.port,t.sslPort);e(r,n)},error:function(){var s=new EVWEB2.ResponseStatus(!1,"An error occurred.");e(s)},url:s.service.url()+EVWEB2.urls.brokerConfig,data:{}};s.service.isXss()&&EVWEB2.util.updateRequestForXss(t,s.service),$.ajax(t)};var F=function(){void 0!==g&&g.readyState===W&&(b=!0,null!==R&&(clearTimeout(R),R=null),w(EVWEB2.connectionEvent.timedOut))};this.init=function(e,s,t){"function"==typeof e&&(w=e),void 0!==t&&setTimeout(F,t),A(T=s)},this.subscribe=function(e,t,r,i,o){var a,c=$.Deferred();if(null===g)return a=new EVWEB2.ResponseStatus(!1,"WebSocket support is not enabled.",EVWEB2.websocketErrorCodes.disabled),c.reject(a,e,t,r),c.promise();if(y===B)return a=new EVWEB2.ResponseStatus(!1,"Subscribe failed. Connection lost.",EVWEB2.websocketErrorCodes.connectionLost),c.reject(a,e,t,r),c.promise();if(void 0===e)return a=new EVWEB2.ResponseStatus(!1,"Trying to subscribe to unknown EVWEB2.pubSubTopic: "+e,EVWEB2.websocketErrorCodes.unknownTopic),c.reject(a,e,t,r),c.promise();if(!t.isPassthroughServer()&&!t.isLoggedIn())return a=new EVWEB2.ResponseStatus(!1,"Subscribe failed. Server login required.",EVWEB2.websocketErrorCodes.loginRequired),c.reject(a,e,t,r),c.promise();var h=e.rawTopicStr,m=l[h],V=f(),W=h+"."+t.sessionId;void 0!==o&&o.length>0&&(W=n(e,o)+"."+t.sessionId);var w=!1;void 0!==i&&(w=void 0!==i.acknowledge&&i.acknowledge),u[V]=new p(V,t,W,m,r,c,w);var S=new E(w,this.serializer.isBinary),T=new d(V,W,s,S),I=new v(T),R=this.serializer.serialize(I.marshal());try{g.send(R)}catch(s){return EVWEB2.log("subscribe failed: "+s.message),a=new EVWEB2.ResponseStatus(!1,"Subscribe failed. Unable to send server request.",EVWEB2.websocketErrorCodes.sendFailed),c.reject(a,e,t,r),c.promise()}return c.promise()},this.unsubscribe=function(e,s){void 0===s&&(s=!0);var t,i=$.Deferred(),n=c[e.topic];if(void 0===n)return t=new EVWEB2.ResponseStatus(!1,"unsubscribe failed, no active subscriptions found for topic: "+e.topic,EVWEB2.websocketErrorCodes.unknownTopic),i.reject(t),i.promise();if(y===B)return t=new EVWEB2.ResponseStatus(!1,"unsubscribe failed, not connected",EVWEB2.websocketErrorCodes.connectionLost),i.reject(t),i.promise();var o=-1;if(0===$.grep(n.subscriptions,function(s,t){if(s.subscriptionId===e.subscriptionId)return o=t,!0}).length)return t=new EVWEB2.ResponseStatus(!1,"unsubscribe failed, unknown subscription ID: "+e.subscriptionId,EVWEB2.websocketErrorCodes.unknownSubscription),i.reject(t),i.promise();if(n.subscriptions.splice(o,1),0===n.subscriptions.length){var u=f(),v=new E(s,a.serializer.isBinary),l=new function(e,s){e.messageType=r,this.hdr=e,this.subscriptionId=s,this.marshal=function(){return{header:this.hdr.marshal(),payload:{subscriptionId:this.subscriptionId}}}}(new d(u,n.topic,r,v),e.subscriptionId),p=a.serializer.serialize(l.marshal());try{g.send(p)}catch(e){return EVWEB2.log("unsubscribe failed: "+e.message),t=new EVWEB2.ResponseStatus(!1,"unsubscribe failed, unable to send server request",EVWEB2.websocketErrorCodes.sendFailed),i.reject(t),i.promise()}delete c[e.topic],h[u]=new function(e,s){this.subscription=e,this.onAcknowledge=s}(e,i)}else e.isActive=!1,i.resolve(e);return i.promise()}}}(),function(){"use strict";var e={};e[EVWEB2.pubSubTopic.server.rawTopicStr]={fn:function(s,t,r){var i=function(i,n){if(!i.success)return EVWEB2.log("Legacy subscription failed:",r,i),void s();e[r].data=n;var o=$.grep(n,function(e){return e.id===t.server.id})[0];void 0===o&&EVWEB2.log("Target server removed from list:",r,i),t.externalCallback(t,o),s()};void 0===e[r].data?t.server.service.getServers(i):i(new EVWEB2.ResponseStatus(!0),e[r].data)}},e[EVWEB2.pubSubTopic.serverStatus.rawTopicStr]={fn:function(s,t,r){var i=function(i,n){if(!i.success)return EVWEB2.log("Legacy subscription failed:",r,i),void s();void 0===e[r].data&&(e[r].data=[]),e[r].data.push(n),t.externalCallback(t,n.serverStatus),s()};if(void 0!==e[r].data){var n=$.grep(e[r].data,function(e){return e.server.id===t.server.id})[0];if(void 0!==n)return void i(new EVWEB2.ResponseStatus(!0),n)}t.server.isLoggedIn()||t.server.isPassthroughServer()?t.server.getServerStatus(i):s()}},e[EVWEB2.pubSubTopic.devices.rawTopicStr]={fn:function(s,t,r){var i=function(i,n){if(!i.success)return EVWEB2.log("Legacy subscription failed:",r,i),void s();$.each(n,function(e,s){s.server=t.server}),void 0===e[r].data&&(e[r].data=[]),e[r].data.push({server:t.server,devices:n}),t.externalCallback(t,n),s()};if(void 0!==e[r].data){var n=$.grep(e[r].data,function(e){return e.server.id===t.server.id})[0];if(void 0!==n)return void i(new EVWEB2.ResponseStatus(!0),n.devices)}t.server.configuration.getDevicesConfiguration(i)}},e[EVWEB2.pubSubTopic.cameraOsd.rawTopicStr]={fn:function(s,t,r){var i=function(i,n){if(!i.success)return EVWEB2.log("Legacy subscription failed:",r,i),void s();var o=$.map(n,function(e){return{osdInfo:EVWEB2.util.internal.formatOsdInfo(e.osdInfo),cameraId:e.cameraId}});void 0===e[r].data&&(e[r].data=[]),e[r].data.push({server:t.server,osdInfos:o}),t.externalCallback(t,o),s()};if(void 0!==e[r].data){var n=$.grep(e[r].data,function(e){return e.server.id===t.server.id})[0];if(void 0!==n)return t.externalCallback(t,n.osdInfos),void s()}var o={s:t.server.sessionId},a={success:function(e){i(new EVWEB2.ResponseStatus(!0),e.camera)},error:function(){i(new EVWEB2.ResponseStatus(!1))},url:t.server.service.url()+EVWEB2.urls.legacyWebsocketCamerasOsd,data:o,type:"GET"};$.ajax(a)}},e[EVWEB2.pubSubTopic.users.rawTopicStr]={fn:function(s,t,r){var i=function(i,n){if(!i.success)return EVWEB2.log("Legacy subscription failed:",r,i),void s();$.each(n,function(e,s){s.server=t.server}),void 0===e[r].data&&(e[r].data=[]),e[r].data.push({server:t.server,users:n}),t.externalCallback(t,n),s()};if(void 0!==e[r].data){var n=$.grep(e[r].data,function(e){return e.server.id===t.server.id})[0];if(void 0!==n)return void i(new EVWEB2.ResponseStatus(!0),n.users)}t.server.getUsers(i)}},e[EVWEB2.pubSubTopic.userGroups.rawTopicStr]={fn:function(s,t,r){var i=function(i,n){if(!i.success)return EVWEB2.log("Legacy subscription failed:",r,i),void s();void 0===e[r].data&&(e[r].data=[]),e[r].data.push({server:t.server,groups:n}),t.externalCallback(t,n),s()};if(void 0!==e[r].data){var n=$.grep(e[r].data,function(e){return e.server.id===t.server.id})[0];if(void 0!==n)return void i(new EVWEB2.ResponseStatus(!0),n.groups)}t.server.getUserGroups(i)}},e[EVWEB2.pubSubTopic.cameras.rawTopicStr]={fn:function(s,t,r){var i=function(i,n){if(!i.success)return EVWEB2.log("Legacy subscription failed:",r,i),void s();$.each(n,function(e,s){s.server=t.server}),void 0===e[r].data&&(e[r].data=[]),e[r].data.push({server:t.server,cameras:n}),t.externalCallback(t,n),s()};if(void 0!==e[r].data){var n=$.grep(e[r].data,function(e){return e.server.id===t.server.id})[0];if(void 0!==n)return void i(new EVWEB2.ResponseStatus(!0),n.cameras)}t.server.getCameras(i)}},e[EVWEB2.pubSubTopic.activeUsers.rawTopicStr]={fn:function(s,t,r){var i=function(i,n){if(!i.success)return EVWEB2.log("Legacy subscription failed:",r,i),void s();void 0===e[r].data&&(e[r].data=[]),e[r].data.push({server:t.server,usageInfo:n}),t.externalCallback(t,n),s()};if(void 0!==e[r].data){var n=$.grep(e[r].data,function(e){return e.server.id===t.server.id})[0];if(void 0!==n)return void i(new EVWEB2.ResponseStatus(!0),n.usageInfo)}t.server.getSystemUsageInfo(i)}},e[EVWEB2.pubSubTopic.triggers.rawTopicStr]={data:[],store:[],fn:function(s,t,r){if(void 0!==e[r].data){var i=$.grep(e[r].data,function(e){return e.server.id===t.server.id})[0];if(void 0!==i)return $.each(i.triggers,function(e,s){t.externalCallback(t,s)}),void s()}EVWEB2.getTriggers(function(i,n){if(!i.success)return EVWEB2.log("Legacy subscription failed:",r,i),void s();var o=e[r].store,a=$.grep(o,function(e){return e.server.id===t.server.id})[0];void 0===a&&(a={server:t.server,triggers:n},o.push(a));var u=$.grep(n,function(e){var s=$.grep(a.triggers,function(s){return s.id===e.id})[0];if(void 0===s||s.state!==e.state||s.name!==e.name)return e});a.triggers=n,$.each(u,function(e,s){t.externalCallback(t,s)}),void 0===e[r].data&&(e[r].data=[]),e[r].data.push({server:t.server,triggers:u}),s()},t.server)}},e[EVWEB2.pubSubTopic.motion.rawTopicStr]={data:[],store:[],fn:function(s,t,r){var i=function(i,n){if(!i.success)return EVWEB2.log("Legacy subscription failed:",r,i),void s();var o=e[r].store,a=$.grep(o,function(e){return e.server.id===t.server.id})[0];void 0===a&&(a={server:t.server,cameras:n},o.push(a));var u=$.grep(n,function(e){var s=$.grep(a.cameras,function(s){return s.id===e.id})[0];if(void 0===s||s.status.motion!==e.status.motion)return e});a.cameras=n,$.each(u,function(e,s){t.externalCallback(t,s.id,s.status.motion)}),void 0===e[r].data&&(e[r].data=[]),e[r].data.push({server:t.server,cameras:n}),s()};if(void 0!==e[r].data){var n=$.grep(e[r].data,function(e){return e.server.id===t.server.id})[0];if(void 0!==n)return $.each(n.cameras,function(e,s){t.externalCallback(t,s.id,s.status.motion)}),void s()}var o={s:t.server.sessionId},a={success:function(e){i(new EVWEB2.ResponseStatus(!0),e.camera)},error:function(){i(new EVWEB2.ResponseStatus(!1))},url:t.server.service.url()+EVWEB2.urls.legacyWebsocketStatus,data:o,type:"GET"};$.ajax(a)}},e[EVWEB2.pubSubTopic.loss.rawTopicStr]={data:[],store:[],fn:function(s,t,r){var i=function(i,n){if(!i.success)return EVWEB2.log("Legacy subscription failed:",r,i),void s();var o=e[r].store,a=$.grep(o,function(e){return e.server.id===t.server.id})[0];void 0===a&&(a={server:t.server,cameras:n},o.push(a));var u=$.grep(n,function(e){var s=$.grep(a.cameras,function(s){return s.id===e.id})[0];if(void 0===s||s.status.loss!==e.status.loss)return e});a.cameras=n,$.each(u,function(e,s){t.externalCallback(t,s.id,s.status.loss)}),void 0===e[r].data&&(e[r].data=[]),e[r].data.push({server:t.server,cameras:n}),s()};if(void 0!==e[r].data){var n=$.grep(e[r].data,function(e){return e.server.id===t.server.id})[0];if(void 0!==n)return $.each(n.cameras,function(e,s){t.externalCallback(t,s.id,s.status.loss)}),void s()}var o={s:t.server.sessionId},a={success:function(e){i(new EVWEB2.ResponseStatus(!0),e.camera)},error:function(){i(new EVWEB2.ResponseStatus(!1))},url:t.server.service.url()+EVWEB2.urls.legacyWebsocketStatus,data:o,type:"GET"};$.ajax(a)}},e[EVWEB2.pubSubTopic.plugins.rawTopicStr]={fn:function(s,t,r){var i=function(i,n){if(!i.success)return EVWEB2.log("Legacy subscription failed:",r,i),void s();void 0===e[r].data&&(e[r].data=[]),e[r].data.push({server:t.server,pluginsList:n}),t.externalCallback(t,n),s()};if(void 0!==e[r].data){var n=$.grep(e[r].data,function(e){return e.server.id===t.server.id})[0];if(void 0!==n)return void i(new EVWEB2.ResponseStatus(!0),n.pluginsList)}t.server.getSystemPluginInfo(i)}},e[EVWEB2.pubSubTopic.deviceConnection.rawTopicStr]={data:[],store:[],fn:function(s,t,r){if(void 0!==e[r].data){var i=$.grep(e[r].data,function(e){return e.server.id===t.server.id})[0];if(void 0!==i)return $.each(i.devices,function(e,s){t.externalCallback(t,s.id,s.connectionStatus)}),void s()}t.server.configuration.getDevicesConfiguration(function(i,n){if(!i.success)return EVWEB2.log("Legacy subscription failed:",r,i),void s();var o=e[r].store,a=$.grep(o,function(e){return e.server.id===t.server.id})[0];void 0===a&&(a={server:t.server,devices:n},o.push(a));var u=$.grep(n,function(e){var s=$.grep(a.devices,function(s){return s.id===e.id})[0];if(void 0===s||s.connectionStatus!==e.connectionStatus)return e});a.devices=n,$.each(u,function(e,s){t.externalCallback(t,s.id,s.connectionStatus)}),void 0===e[r].data&&(e[r].data=[]),e[r].data.push({server:t.server,devices:u}),s()})}},e[EVWEB2.pubSubTopic.cameraConnection.rawTopicStr]={data:[],store:[],fn:function(s,t,r){if(void 0!==e[r].data){var i=$.grep(e[r].data,function(e){return e.server.id===t.server.id})[0];if(void 0!==i)return $.each(i.cameras,function(e,s){t.externalCallback(t,s.id,s.connectionStatus)}),void s()}t.server.configuration.getDevicesConfiguration(function(i,n){if(!i.success)return EVWEB2.log("Legacy subscription failed:",r,i),void s();var o=e[r].store,a=$.grep(o,function(e){return e.server.id===t.server.id})[0];void 0===a&&(a={server:t.server,cameras:n},o.push(a));var u=$.grep(n,function(e){var s=$.grep(a.cameras,function(s){return s.id===e.id})[0];if(void 0===s||s.connectionStatus!==e.connectionStatus)return e});a.cameras=n,$.each(u,function(e,s){t.externalCallback(t,s.id,s.connectionStatus)}),void 0===e[r].data&&(e[r].data=[]),e[r].data.push({server:t.server,cameras:u}),s()})}},e[EVWEB2.pubSubTopic.avgFrameSize.rawTopicStr]={fn:function(s,t,r,i,n){var o=n[0],a=function(i,n){if(!i.success)return EVWEB2.log("Legacy subscription failed:",r,i),void s();void 0===e[r].data&&(e[r].data=[]),e[r].data.push({server:t.server,cameraId:o.id,frameSize:n}),t.externalCallback(t,o.id,n),s()};if(void 0!==e[r].data){var u=$.grep(e[r].data,function(e){return e.server.id===t.server.id&&e.cameraId===o.id})[0];if(void 0!==u)return void a(new EVWEB2.ResponseStatus(!0),u.frameSize,u.cameraId)}o.config.getAverageFrameSize(a)}},e[EVWEB2.pubSubTopic.securityIntegrationDevices.rawTopicStr]={store:[],fn:function(s,t,r){var i=function(i,n){if(!i.success)return EVWEB2.log("Legacy subscription failed:",r,i),void s();var o=e[r].store,a=$.grep(o,function(e){return e.server.id===t.server.id})[0];void 0===a?(a={server:t.server,devices:n},o.push(a)):a.devices=n,void 0===e[r].data&&(e[r].data=[]),e[r].data.push({server:t.server,devices:n}),t.externalCallback(t,n),s()};if(void 0!==e[r].data){var n=$.grep(e[r].data,function(e){return e.server.id===t.server.id})[0];if(void 0!==n)return void i(new EVWEB2.ResponseStatus(!0),n.devices)}t.server.getSecurityIntegrationsDevices(i)}},e[EVWEB2.pubSubTopic.securityIntegrationSensors.rawTopicStr]={fn:function(s,t,r){var i=function(i,n){if(!i.success)return EVWEB2.log("Legacy subscription failed:",r,i),void s();if(void 0===e[r].data&&(e[r].data=[]),e[r].data.push({server:t.server,sensors:n}),n.length>0){var o=n[0].device.id;t.externalCallback(t,o,n)}s()};if(void 0!==e[r].data){var n=$.grep(e[r].data,function(e){return e.server.id===t.server.id})[0];if(void 0!==n)return void i(new EVWEB2.ResponseStatus(!0),n.sensors)}var o=function(e,t){e.success?$.each(t,function(e,s){s.getSensors(i)}):s()},a=$.grep(e[EVWEB2.pubSubTopic.securityIntegrationDevices.rawTopicStr].store,function(e){return e.server.id===t.server.id})[0];void 0===a?t.server.getSecurityIntegrationsDevices(o):o(new EVWEB2.ResponseStatus(!0),a.devices)}},e[EVWEB2.pubSubTopic.securityIntegrationSensorStatus.rawTopicStr]={fn:function(s,t,r){var i=function(i,n){if(!i.success)return EVWEB2.log("Legacy subscription failed:",r,i),void s();void 0===e[r].data&&(e[r].data=[]),e[r].data.push({server:t.server,sensors:n});var o=$.map(n,function(e){return{server:t.server,deviceId:e.device.id,sensorId:e.id,status:e.status,alarm:e.alarm,statusMessage:e.statusMessage,statusTimestamp:EVWEB2.util.Date2IETF(e.statusTimestamp)}});$.each(o,function(e,s){t.externalCallback(t,s)}),s()};if(void 0!==e[r].data){var n=$.grep(e[r].data,function(e){return e.server.id===t.server.id})[0];if(void 0!==n)return void i(new EVWEB2.ResponseStatus(!0),n.sensors)}var o=function(e,t){e.success?$.each(t,function(e,s){s.getSensors(i)}):s()},a=$.grep(e[EVWEB2.pubSubTopic.securityIntegrationDevices.rawTopicStr].store,function(e){return e.server.id===t.server.id})[0];void 0===a?t.server.getSecurityIntegrationsDevices(o):o(new EVWEB2.ResponseStatus(!0),a.devices)}},e[EVWEB2.pubSubTopic.securityIntegrationDeviceConnection.rawTopicStr]={fn:function(s,t,r){var i=function(i,n){if(!i.success)return EVWEB2.log("Legacy subscription failed:",r,i),void s();void 0===e[r].data&&(e[r].data=[]),e[r].data.push({server:t.server,devices:n}),$.each(n,function(e,s){t.externalCallback(t,s.id,s.connectionStatus)}),s()};if(void 0!==e[r].data){var n=$.grep(e[r].data,function(e){return e.server.id===t.server.id})[0];if(void 0!==n)return void i(new EVWEB2.ResponseStatus(!0),n.devices)}var o=$.grep(e[EVWEB2.pubSubTopic.securityIntegrationDevices.rawTopicStr].store,function(e){return e.server.id===t.server.id})[0];void 0===o?t.server.getSecurityIntegrationsDevices(i):i(new EVWEB2.ResponseStatus(!0),o.devices)}},e[EVWEB2.pubSubTopic.associations.rawTopicStr]={fn:function(s,t,r){var i=function(e){for(var s in e)if(e.hasOwnProperty(s)){var r=parseInt(s,10);t.externalCallback(t,r,e[r])}},n=function(n,o){if(!n.success)return EVWEB2.log("Legacy subscription failed:",r,n),void s();var a={};$.each(o,function(e,s){var r=$.map(s.items,function(e){return new EVWEB2.AssociationItem(e.id,e.type,e.position,e.statusOnly,e.extra)}),i=new EVWEB2.FontInfo(s.fontName,s.fontSize,s.fontStyle,s.fontColor,s.fontFamily,s.fontWeight),n=new EVWEB2.Association(t.server,void 0,s.guid,r,s.label,s.overlayStyle,s.position,s.backgroundColor,s.opacity,i);a[s.cameraId]=n}),void 0===e[r].data&&(e[r].data=[]),e[r].data.push({server:t.server,associationsByCameraId:a}),i(a),s()};if(void 0!==e[r].data){var o=$.grep(e[r].data,function(e){return e.server.id===t.server.id})[0];if(void 0!==o)return i(o.associationsByCameraId),void s()}var a={s:t.server.sessionId},u={success:function(e){n(new EVWEB2.ResponseStatus(!0),e.associations)},error:function(){n(new EVWEB2.ResponseStatus(!1))},url:t.server.service.url()+EVWEB2.urls.associations,data:a,type:"GET"};$.ajax(u)}};var s=function(e,s){for(var t=e.rawTopicStr,r=e.idTypes,i=[],n=function(e){return function(e,s){for(var t=0;t<s.length;++t)if(e instanceof s[t])return!0;return!1}(e,[EVWEB2.Camera,EVWEB2.DeviceConfig,EVWEB2.Trigger])?e.id:e.toString()},o=0;o<r.length;++o)i.push(n(s[o]));return function(e,s){for(var t=e,r=s.length;r--;)t=t.replace(new RegExp("\\{"+r+"\\}","gm"),s[r]);return t}(t,i)};EVWEB2.LegacyWebSocketHandler=function(t){this.isLegacy=!0,this.service=null;var r=null,i=[];void 0!==t&&(this.service=t);var n=function(){var s;for(s in e)e.hasOwnProperty(s)&&void 0!==e[s].data&&delete e[s].data;var t=0,o=function(){var s=i[t];if(void 0===s)return clearTimeout(r),void(r=setTimeout(n,3e3));var a=s.subscription,u=e[s.topic];t++,void 0===u?o():u.fn(o,a,s.topic,s.options,s.ids)};o()};this.getConfig=function(e){if("function"!=typeof e)throw new Error("Callback required");var s=this,t={success:function(t){var r=new EVWEB2.ResponseStatus(t.success,t.errorText),i=s.service.hostUrl;"/"!==i.substr(i.length-1)&&(i=i.slice(0,i.length-1));var n=new EVWEB2.WebsocketConfig(i,t.port);e(r,n)},error:function(){var s=new EVWEB2.ResponseStatus(!1,"An error occurred.");e(s)},url:s.service.url()+EVWEB2.urls.brokerConfig,data:{}};s.service.isXss()&&EVWEB2.util.updateRequestForXss(t,s.service),$.ajax(t)},this.init=function(e){e()},this.subscribe=function(e,t,o,a,u){var c,E=$.Deferred();if(void 0===e)return c=new EVWEB2.ResponseStatus(!1,"Trying to subscribe to unknown EVWEB2.pubSubTopic: "+e,EVWEB2.websocketErrorCodes.unknownTopic),E.reject(c,e,t,o),E.promise();var d=uuid.v4(),v=e.rawTopicStr,h=v+"."+t.sessionId;void 0!==u&&u.length>0&&(h=s(e,u)+"."+t.sessionId);var l=new EVWEB2.Subscription(d,t,h,o);return i.push({subscription:l,topic:v,options:a,ids:u}),null===r&&(r=setTimeout(n,3e3)),E.resolve(l),E.promise()},this.unsubscribe=function(e){var s,t=$.Deferred(),n=$.grep(i,function(s){return s.subscription===e})[0];if(void 0===n)return s=new EVWEB2.ResponseStatus(!1,"unsubscribe failed, no active subscriptions found for topic: "+e.topic,EVWEB2.websocketErrorCodes.unknownTopic),t.reject(s),t.promise();var o=$.inArray(n,i);return-1!==o&&i.splice(o,1),0===i.length&&null!==r&&(clearTimeout(r),r=null),t.resolve(e),t.promise()}},void 0!==window.WebSocket&&void 0!==window.DataView&&void 0!==window.ArrayBuffer||(EVWEB2.WebSocketHandler=EVWEB2.LegacyWebSocketHandler)}(),function(){"use strict";EVWEB2.bookmarkItemTypes={camera:0,audio:1,serial:2,event:3},EVWEB2.BookmarkItem=function(e,s,t){this.server=e,this.id=s,this.type=t},EVWEB2.Bookmark=function(e,s,t,r,i,n,o,a){this.name=e,this.guid=s,this.start=t,this.end=r,this.items=i,this.description="",this.size=0,this.caseId=null,void 0!==n&&(this.description=n),void 0!==o&&(this.size=o),void 0!==a&&(this.caseId=a),this.update=function(e){var s=this,t={s:$.map(s.items,function(e){return e.server.sessionId}),guid:s.guid,name:s.name,description:s.description,start:EVWEB2.util.Date2IETF(s.start),end:EVWEB2.util.Date2IETF(s.end)};null!==s.caseId&&(t.case=s.caseId);var r={success:function(t){if(t.success){s.name=t.bookmark.name,s.description=t.bookmark.description,s.start=EVWEB2.util.IETF2Date(t.bookmark.start),s.end=EVWEB2.util.IETF2Date(t.bookmark.end);var r=new EVWEB2.ResponseStatus(!0);e(r,s)}else{var i=new EVWEB2.ResponseStatus(!1,t.errorText);e(i)}},error:function(s){var t=new EVWEB2.ResponseStatus(!1,EVWEB2.util.getErrorText(s));e(t)},url:s.items[0].server.service.url()+EVWEB2.urls.bookmark,type:"PUT",data:t,traditional:!0};s.items[0].server.service.isXss()&&EVWEB2.util.updateRequestForXss(r,s.items[0].server.service),$.ajax(r)},this.deleteBookmark=function(e){var s={s:$.map(this.items,function(e){return e.server.sessionId}),guid:this.guid};null!==this.caseId&&(s.case=this.caseId);var t={success:function(s){if(s.success){var t=new EVWEB2.ResponseStatus(!0);e(t)}else{var r=new EVWEB2.ResponseStatus(!1,s.errorText);e(r)}},error:function(s){var t=new EVWEB2.ResponseStatus(!1,EVWEB2.util.getErrorText(s));e(t)},url:this.items[0].server.service.url()+EVWEB2.urls.bookmark,type:"DELETE",data:s,traditional:!0};this.items[0].server.service.isXss()&&EVWEB2.util.updateRequestForXss(t,this.items[0].server.service),$.ajax(t)},this.addItem=function(e,s){var t=this,r={s:$.map(t.items,function(e){return e.server.sessionId}),guid:t.guid,id:s.id,type:s.type,sessionId:s.server.sessionId};null!==t.caseId&&(r.case=t.caseId);var i={success:function(r){if(r.success){t.items.push(s);var i=new EVWEB2.ResponseStatus(!0);e(i,t)}else{var n=new EVWEB2.ResponseStatus(!1,r.errorText);e(n)}},error:function(s){var t=new EVWEB2.ResponseStatus(!1,EVWEB2.util.getErrorText(s));e(t)},url:s.server.service.url()+EVWEB2.urls.bookmarkItems,type:"POST",data:r,traditional:!0};s.server.service.isXss()&&EVWEB2.util.updateRequestForXss(i,s.server.service),$.ajax(i)},this.deleteItem=function(e,s){var t=this,r=$.grep(t.items,function(e){return e.id===s.id&&e.type===s.type&&e.server===s.server})[0];if(void 0!==r){var i={s:r.server.sessionId,guid:t.guid,id:r.id,type:r.type};null!==t.caseId&&(i.case=t.caseId);var n={success:function(s){if(s.success){var i=$.inArray(r,t.items);-1!==i&&t.items.splice(i,1);var n=new EVWEB2.ResponseStatus(!0);e(n,t)}else{var o=new EVWEB2.ResponseStatus(!1,s.errorText);e(o)}},error:function(s){var t=new EVWEB2.ResponseStatus(!1,EVWEB2.util.getErrorText(s));e(t)},url:r.server.service.url()+EVWEB2.urls.bookmarkItems,type:"DELETE",data:i};s.server.service.isXss()&&EVWEB2.util.updateRequestForXss(n,r.server.service),$.ajax(n)}else{var o=new EVWEB2.ResponseStatus(!1,"Item not removed from bookmark.");e(o)}}},EVWEB2.Case=function(e,s,t,r,i){this.servers=e,this.guid=s,this.name=t,this.description="",this.count=0,void 0!==r&&(this.description=r),void 0!==i&&(this.count=i),this.update=function(e){var s=this,t={s:$.map(s.servers,function(e){return e.sessionId}),guid:s.guid,name:s.name,description:s.description},r={success:function(t){if(t.success){var r=t.case;s.servers=$.grep(s.servers,function(e){return-1!==$.inArray(e.sessionId.toString(),r.servers)}),s.guid=r.guid,s.name=r.name,s.description=r.description,s.count=r.bookmarks;var i=new EVWEB2.ResponseStatus(!0);e(i,s)}else{var n=new EVWEB2.ResponseStatus(!1,t.errorText);e(n)}},error:function(s){var t=new EVWEB2.ResponseStatus(!1,EVWEB2.util.getErrorText(s));e(t)},url:s.servers[0].service.url()+EVWEB2.urls.bookmarkCases,type:"PUT",data:t,traditional:!0};s.servers[0].service.isXss()&&EVWEB2.util.updateRequestForXss(r,s.servers[0].service),$.ajax(r)},this.deleteCase=function(e){var s={s:$.map(this.servers,function(e){return e.sessionId}),guid:this.guid},t={success:function(s){if(s.success){var t=new EVWEB2.ResponseStatus(!0);e(t)}else{var r=new EVWEB2.ResponseStatus(!1,s.errorText);e(r)}},error:function(s){var t=new EVWEB2.ResponseStatus(!1,EVWEB2.util.getErrorText(s));e(t)},url:this.servers[0].service.url()+EVWEB2.urls.bookmarkCases,type:"DELETE",data:s,traditional:!0};this.servers[0].service.isXss()&&EVWEB2.util.updateRequestForXss(t,this.servers[0].service),$.ajax(t)},this.getBookmarks=function(e){var s=this,t={s:$.map(s.servers,function(e){return e.sessionId}),guid:s.guid},r={success:function(t){if(t.success){var r={};$.each(s.servers,function(e,s){r[s.sessionId]=s});var i=$.map(t.bookmarks,function(e){var s=$.map(e.items,function(e){return new EVWEB2.BookmarkItem(r[e.server],e.id,e.type)}),t=EVWEB2.util.IETF2Date(e.start),i=EVWEB2.util.IETF2Date(e.end);return new EVWEB2.Bookmark(e.name,e.guid,t,i,s,e.description,e.size,e.case)}),n=new EVWEB2.ResponseStatus(!0);e(n,i)}else{var o=new EVWEB2.ResponseStatus(!1,t.errorText);e(o)}},error:function(s){var t=new EVWEB2.ResponseStatus(!1,EVWEB2.util.getErrorText(s));e(t)},url:s.servers[0].service.url()+EVWEB2.urls.bookmark,type:"GET",data:t,traditional:!0};s.servers[0].service.isXss()&&EVWEB2.util.updateRequestForXss(r,s.servers[0].service),$.ajax(r)}}}(),function(){"use strict";EVWEB2.SerialPortUses={Unused:0,POS:1,PTZ:2,ATM:3,AccessControl:4,Internal:5},EVWEB2.SerialIpTypes={TCP:0,HTTP:1,TcpListener:2,UDP:3},EVWEB2.SerialPortParity={None:0,Odd:1,Even:2},EVWEB2.SerialPortFlowControl={None:0,Software:1,Hardware:2},EVWEB2.SerialDeviceTypes={Unknown:0,Uart:1,Ip:2},EVWEB2.SerialProfileMarkerTypes={Standard:0,XML:1},EVWEB2.SerialProfileRuleFieldPositions={Before:0,After:1},EVWEB2.SerialProfileRuleOperatorTypes={Unknown:0,Equal:1,NotEqual:2,GreaterOrEqual:3,LessOrEqual:4,GreaterThan:5,LessThan:6,Contains:7,NotContains:8},EVWEB2.ServerSerialFunctionality=function(e,s,t,r,i){this.advancedLineEnding=!1,this.sotMarkers=!1,this.xmlFormatting=!1,this.replace=!1,this.rules=!1,void 0!==e&&(this.advancedLineEnding=e),void 0!==s&&(this.sotMarkers=s),void 0!==t&&(this.xmlFormatting=t),void 0!==r&&(this.replace=r),void 0!==i&&(this.rules=i)},EVWEB2.ServerSerialSupport=function(e,s,t,r,i,n){this.server=e,this.supports=s,this.numUart=0,this.numIp=0,this.uses=[],this.ipTypes=[],void 0!==t&&(this.numUart=t),void 0!==r&&(this.numIp=r),void 0!==i&&(this.uses=i),void 0!==n&&(this.ipTypes=n)},EVWEB2.UartSerialDeviceConnectionInfo=function(e,s,t,r,i,n){this.port=e,this.baudRate=4800,this.dataBits=8,this.stopBits=1,this.parity=EVWEB2.SerialPortParity.None,this.flowControl=EVWEB2.SerialPortFlowControl.None,void 0!==s&&(this.baudRate=s),void 0!==t&&(this.dataBits=t),void 0!==r&&(this.stopBits=r),void 0!==i&&(this.parity=i),void 0!==n&&(this.flowControl=n)},EVWEB2.IpSerialDeviceConnectionInfo=function(e,s,t,r){this.address=e,this.type=EVWEB2.SerialIpTypes.TCP,this.ipPort=0,this.remotePort=0,void 0!==s&&(this.type=s),void 0!==t&&(this.ipPort=t),void 0!==r&&(this.remotePort=r)},EVWEB2.SerialDeviceLineInfo=function(e,s,t){this.maxLineLength=80,this.lineEnding="",this.timeout=0,void 0!==e&&(this.maxLineLength=e),void 0!==s&&(this.lineEnding=s),void 0!==t&&(this.timeout=t)},EVWEB2.SerialStoredData=function(e,s,t){this.data="",this.start=null,this.end=null,void 0!==e&&(this.data=e),void 0!==s&&(this.start=s),void 0!==t&&(this.end=t)},EVWEB2.SerialDevice=function(e,s,t,r,i,n,o,a){this.server=e,this.id=s,this.name=t,this.connectionInfo=r,this.lineInfo=i,this.use=EVWEB2.SerialPortUses.Unused,this.type=EVWEB2.SerialDeviceTypes.Unknown,this.profile=null;var u=null;void 0!==n&&(this.use=n),void 0!==o&&(this.type=o),void 0!==a&&(this.profile=a),this.getData=function(e,s){void 0!==s&&(u=s);var t={s:this.server.sessionId,serial:this.id};null!==u&&(t.stream=u);var r={success:function(s){if(s.success){var t=new EVWEB2.ResponseStatus(!0);null===u&&(u=s.stream),e(t,s.data)}else{var r=new EVWEB2.ResponseStatus(!1,s.errorText);e(r)}},error:function(){var s=new EVWEB2.ResponseStatus(!1,"An error occurred.");e(s)},url:this.server.service.url()+EVWEB2.urls.serialData,data:t};this.server.service.isXss()&&EVWEB2.util.updateRequestForXss(r),$.ajax(r)},this.getStoredData=function(e,s){var t={s:s,serial:this.id},r={success:function(s){if(s.success){var t=new EVWEB2.ResponseStatus(!0),r=$.map(s.stored,function(e){return new EVWEB2.SerialStoredData(e.data,EVWEB2.util.IETF2Date(e.start),EVWEB2.util.IETF2Date(e.end))});e(t,r,s.complete)}else{var i=new EVWEB2.ResponseStatus(!1,s.errorText);e(i)}},error:function(){var s=new EVWEB2.ResponseStatus(!1,"An error occurred.");e(s)},url:this.server.service.url()+EVWEB2.urls.serialStoredData,data:t};this.server.service.isXss()&&EVWEB2.util.updateRequestForXss(r),$.ajax(r)}},EVWEB2.SerialCaseSensitivity=function(e,s,t,r,i){this.transmissionMarkers=!1,this.keywords=!1,this.masks=!1,this.replacements=!1,this.rules=!1,void 0!==e&&(this.transmissionMarkers=e),void 0!==s&&(this.keywords=s),void 0!==t&&(this.masks=t),void 0!==r&&(this.replacements=r),void 0!==i&&(this.rules=i)},EVWEB2.SerialProfileMarkers=function(e,s,t){this.type=EVWEB2.SerialProfileMarkerTypes.Standard,this.start="",this.end="",void 0!==e&&(this.type=e),void 0!==s&&(this.start=s),void 0!==t&&(this.end=t)},EVWEB2.SerialProfileKeyword=function(e,s,t,r){this.profile=e,this.id=s,this.match="",this.enabled=!1,void 0!==t&&(this.match=t),void 0!==r&&(this.enabled=r)},EVWEB2.SerialProfileLineMask=function(e,s,t,r){this.profile=e,this.match="",this.live=!1,this.search=!1,void 0!==s&&(this.match=s),void 0!==t&&(this.live=t),void 0!==r&&(this.search=r)},EVWEB2.SerialProfileReplacement=function(e,s,t,r,i){this.profile=e,this.match="",this.replace="",this.live=!1,this.search=!1,void 0!==s&&(this.match=s),void 0!==t&&(this.replace=t),void 0!==r&&(this.live=r),void 0!==i&&(this.search=i)},EVWEB2.SerialProfileRule=function(e,s,t,r){this.profile=e,this.id=s,this.name=t,this.patterns=[],void 0!==r&&(this.patterns=r)},EVWEB2.SerialProfileRulePattern=function(e,s,t,r,i){this.id=e,this.position=EVWEB2.SerialProfileRuleFieldPositions.Before,this.field="",this.op=EVWEB2.SerialProfileRuleOperatorTypes.Equal,this.value="",void 0!==s&&(this.position=s),void 0!==t&&(this.field=t),void 0!==r&&(this.op=r),void 0!==i&&(this.value=i)},EVWEB2.SerialProfile=function(e,s,t,r,i,n,o){this.server=e,this.id=s,this.name=t,this.fontInfo=r,this.caseSensitivity=i,this.markers=n,this.retention=87840,void 0!==o&&(this.retention=o),this.getKeywords=function(e){var s=this,t={success:function(t){if(t.success){var r=new EVWEB2.ResponseStatus(!0),i=$.map(t.keywords,function(e){return new EVWEB2.SerialProfileKeyword(s,e.id,e.match,e.enabled)});e(r,i)}else{var n=new EVWEB2.ResponseStatus(!1,t.errorText);e(n)}},error:function(){var s=new EVWEB2.ResponseStatus(!1,"An error occurred.");e(s)},url:s.server.service.url()+EVWEB2.urls.serialProfileKeywords,data:{s:s.server.sessionId,profile:s.id}};s.server.service.isXss()&&EVWEB2.util.updateRequestForXss(t),$.ajax(t)},this.getLineMasks=function(e){var s=this,t={success:function(t){if(t.success){var r=new EVWEB2.ResponseStatus(!0),i=$.map(t.masks,function(e){return new EVWEB2.SerialProfileLineMask(s,e.match,e.live,e.search)});e(r,i)}else{var n=new EVWEB2.ResponseStatus(!1,t.errorText);e(n)}},error:function(){var s=new EVWEB2.ResponseStatus(!1,"An error occurred.");e(s)},url:s.server.service.url()+EVWEB2.urls.serialProfileLineMasks,data:{s:s.server.sessionId,profile:s.id}};s.server.service.isXss()&&EVWEB2.util.updateRequestForXss(t),$.ajax(t)},this.getReplacements=function(e){var s=this,t={success:function(t){if(t.success){var r=new EVWEB2.ResponseStatus(!0),i=$.map(t.replacements,function(e){return new EVWEB2.SerialProfileReplacement(s,e.match,e.replace,e.live,e.search)});e(r,i)}else{var n=new EVWEB2.ResponseStatus(!1,t.errorText);e(n)}},error:function(){var s=new EVWEB2.ResponseStatus(!1,"An error occurred.");e(s)},url:s.server.service.url()+EVWEB2.urls.serialProfileReplacements,data:{s:s.server.sessionId,profile:s.id}};s.server.service.isXss()&&EVWEB2.util.updateRequestForXss(t),$.ajax(t)},this.getRules=function(e){var s=this,t={success:function(t){if(t.success){var r=new EVWEB2.ResponseStatus(!0),i=$.map(t.rules,function(e){var t=$.map(e.patterns,function(e){return new EVWEB2.SerialProfileRulePattern(e.id,e.fieldPosition,e.field,e.op,e.value)});return new EVWEB2.SerialProfileRule(s,e.id,e.name,t)});e(r,i)}else{var n=new EVWEB2.ResponseStatus(!1,t.errorText);e(n)}},error:function(){var s=new EVWEB2.ResponseStatus(!1,"An error occurred.");e(s)},url:s.server.service.url()+EVWEB2.urls.serialProfileRules,data:{s:s.server.sessionId,profile:s.id}};s.server.service.isXss()&&EVWEB2.util.updateRequestForXss(t),$.ajax(t)}}}(),function(){"use strict";EVWEB2.EventType={unknown:0,videoMotion:1,videoLoss:2,inputTrigger:3,serialPort:4,serialProfile:5,buttonInput:6,deviceFailure:7,deviceTemperature:8,deviceFan:9,devicePowerSupply:10,storage:11,subscriptionExpiration:12,videoThrottling:13,systemVoltage:14,systemTemperature:15,systemFan:16,archiveConnection:17,archiveTask:18,recordContentAge:19,archiveContentAge:20,ipCameraConnection:21,softTrigger:22,timeTrigger:23,analytics:24,outboundConnection:25,securityIntegrationConnection:26,securityIntegrationAlert:27,securityIntegrationAlarm:28,serialPortConnection:29},EVWEB2.EventItemType={unknown:0,camera:1,audio:2,inputTrigger:3,serialKeyword:4,serialProfile:5,analyticsRule:6,securityIntegrationSensor:7},EVWEB2.EventExtraInfo=function(e,s,t){this.server=e,this.id=s,this.type=t},EVWEB2.Event=function(e,s,t,r,i){this.server=e,this.type=s,this.time=t,this.deviceId=null,this.extraInfo=null,void 0!==r&&(this.deviceId=r),void 0!==i&&(this.extraInfo=i)}}(),function(){"use strict";EVWEB2.archiveTargetType={none:0,smb:1,nfs:2,iscsi:3,cloud:4},EVWEB2.archiveExpirationType={none:0,atLeast:1,atMost:2},EVWEB2.ArchiveTarget=function(e,s,t,r,i,n){this.server=e||null,this.id=s||0,this.enabled=t||!1,this.type=r||EVWEB2.archiveTargetType.none,this.upload=i||null,this.search=n||null},EVWEB2.ArchiveUploadConfig=function(e,s,t,r,i,n,o,a,u){this.address=e||"",this.hasBookmarks=s||!1,this.percentToUse=t||0,this.username=r,this.password=i,this.mountPoint=n,this.desiredContentAge=o,this.expirationType=a||EVWEB2.archiveExpirationType.none,this.expirationDuration=u},EVWEB2.ArchiveSearchConfig=function(e,s,t,r){this.enabled=e||!1,this.address=s||"",this.username=t||"",this.password=r||""}}(),function(){"use strict";EVWEB2.VideoStream=function(e,s){this.url=e,this.format=s,this._conn=null,this._decoder=new TextDecoder,this.start=function(e,s){if(!this._conn){this._conn=new WebSocket(this.url),this._conn.binaryType="arraybuffer";var t=this;this._conn.onmessage=function(s){var r,i=new Uint8Array(s.data);t.format===EVWEB2.cameraFormats.h264?r=t._readSeiHead(i):(r=t._readBinaryHead(i),i=i.subarray(29)),e(new EVWEB2.VideoFrame(r.time,r.flags,r.isIframe,i))},this._conn.onerror=s,this._conn.onclose=s}},this.stop=function(){this._conn&&(this._conn.onmessage=null,this._conn.onerror=null,this._conn.onclose=null,this._conn.close(),this._conn=null)},this._readSeiHead=function(e){for(var s=new Uint8Array(47),t=5,r=0;t<e.length&&(0!==e[t]||0!==e[t+1]||0!==e[t+2]||1!==e[t+3]);++t,++r)0===e[t]&&0===e[t+1]&&3===e[t+2]?(s[r]=e[t],s[r+1]=e[t+1],t+=2,++r):s[r]=e[t];return{time:new Date(this._decoder.decode(s.subarray(18,42))),flags:s[42]<<24|s[43]<<16|s[44]<<8|s[45],isIframe:1===s[46]}},this._readBinaryHead=function(e){return{time:new Date(this._decoder.decode(e.subarray(0,24))),flags:e[24]<<24|e[25]<<16|e[26]<<8|e[27],isIframe:1===e[28]}}},EVWEB2.VideoFrame=function(e,s,t,r){this.time=e,this.flags=s,this.isIframe=t,this.data=r}}(),function(){"use strict";EVWEB2.analyticRuleSourceType={unknown:0,camera:1,audio:2},EVWEB2.AssociatedCameraSource=function(e){this.id=e},EVWEB2.AssociatedAudioSource=function(e){this.id=e},EVWEB2.AnalyticRule=function(e,s,t,r,i,n,o,a){this.server=e||null,this.id=s||0,this.deviceId=t||0,this.sourceId=r||null,this.name=i||"",this.osdConfig=n||null,this.metadataEnabled=o||!1,this.metadataTemplates=a||[],this.pushNotificationSubscribe=function(e,s){EVWEB2.ajax({url:this.server.service.url()+EVWEB2.urls.analyticRulePush,type:"POST",data:{s:this.server.sessionId,clientId:s,deviceId:this.deviceId,ruleId:this.id},success:function(s){e(new EVWEB2.ResponseStatus(s.success))},error:function(s){e(new EVWEB2.ResponseStatus(!1,EVWEB2.util.getErrorText(s)))}},this.server.service)},this.pushNotificationUnsubscribe=function(e,s){EVWEB2.ajax({url:this.server.service.url()+EVWEB2.urls.analyticRulePush,type:"DELETE",data:{s:this.server.sessionId,clientId:s,deviceId:this.deviceId,ruleId:this.id},success:function(s){e(new EVWEB2.ResponseStatus(s.success))},error:function(s){e(new EVWEB2.ResponseStatus(!1,EVWEB2.util.getErrorText(s)))}},this.server.service)}},EVWEB2.AnalyticRuleOSDConfig=function(e,s){this.backgroundColor=e||[0,0,0,0],this.borderColor=s||[0,0,0,0]}}(),function(){"use strict";EVWEB2.eventMetadataValueType={unknown:0,number:1,string:2,wkt:3},EVWEB2.EventMetadataTemplate=function(e,s){this.key=e||"",this.valueType=s||EVWEB2.eventMetadataValueType.unknown}}()}})});